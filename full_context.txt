Project Context Scan

--- PROJECT STRUCTURE ---
./
    .env.example
    API_GUIDE.md
    BACKEND_ARCHITECTURE.md
    FRONTEND_ARCHITECTURE.md
    full_context.txt
    inventory.py
    backend/
        .env
        check_models.py
        config.py
        database.py
        export_openapi.py
        iot_simulator.py
        main.py
        models.py
        prompts.py
        requirements.txt
        reset_admin.py
        security.py
        services/
            analytics.py
            clients.py
            inventory.py
            kitchen.py
            logistics.py
            storage.py
            vision.py
            __init__.py
    frontend_next/
        components.json
        next.config.mjs
        package.json
        postcss.config.mjs
        tsconfig.json
        tsconfig.tsbuildinfo
        app/
            globals.css
            layout.tsx
            page.tsx
        components/
            role-selector.tsx
            theme-provider.tsx
            common/
                inventory-list.tsx
            kitchen/
                cooking-production.tsx
                dashboard-overview.tsx
                expiry-alerts.tsx
                iot-monitoring.tsx
                kitchen-dashboard-overview.tsx
                kitchen-dashboard.tsx
                kitchen-inbox.tsx
                kitchen-location.tsx
                kitchen-order-history.tsx
                kitchen-sidebar.tsx
                menu-recommendation.tsx
                scan-food-qc.tsx
                supplier-search-order.tsx
                supply-overview.tsx
            shared/
                error-boundary.tsx
                loading-spinner.tsx
            ui/
                accordion.tsx
                alert-dialog.tsx
                alert.tsx
                aspect-ratio.tsx
                avatar.tsx
                badge.tsx
                breadcrumb.tsx
                button-group.tsx
                button.tsx
                calendar.tsx
                card.tsx
                carousel.tsx
                chart.tsx
                checkbox.tsx
                collapsible.tsx
                command.tsx
                context-menu.tsx
                dialog.tsx
                drawer.tsx
                dropdown-menu.tsx
                empty.tsx
                field.tsx
                form.tsx
                hover-card.tsx
                input-group.tsx
                input-otp.tsx
                input.tsx
                item.tsx
                kbd.tsx
                label.tsx
                menubar.tsx
                navigation-menu.tsx
                pagination.tsx
                popover.tsx
                progress.tsx
                radio-group.tsx
                resizable.tsx
                scroll-area.tsx
                select.tsx
                separator.tsx
                sheet.tsx
                sidebar.tsx
                skeleton.tsx
                slider.tsx
                sonner.tsx
                spinner.tsx
                switch.tsx
                table.tsx
                tabs.tsx
                textarea.tsx
                toast.tsx
                toaster.tsx
                toggle-group.tsx
                toggle.tsx
                tooltip.tsx
                use-mobile.tsx
                use-toast.ts
            vendor/
                connection-status.tsx
                inventory-health.tsx
                inventory-upload.tsx
                kitchen-search.tsx
                order-list.tsx
                quick-insights.tsx
                sppg-search.tsx
                vendor-dashboard.tsx
                vendor-inventory-overview.tsx
                vendor-navbar.tsx
                vendor-sidebar.tsx
        hooks/
            use-location.ts
            use-mobile.ts
            use-toast.ts
        lib/
            api.ts
            utils.ts
        styles/
            globals.css
    frontend_streamlit/
        Home.py
        pages/
            1_upload.py
            2_dashboard_sppg.py
            3_pesanan_masuk.py
            4_dapur_produksi.py
            requirements.txt
    scripts/
        API_IoT.py


--- FILE CONTENTS ---

==================================================
FILENAME: .\inventory.py
==================================================
from datetime import datetime, timedelta
from database import supabase
from .logistics import haversine_distance
from .kitchen import generate_menu_recommendation

# Global Cache untuk Resep Penyelamatan (Reset saat restart server)
_RESCUE_MENU_CACHE = {"hash": "", "menu": None}

def calculate_expiry_date(days: int) -> str:
    """
    Menghitung tanggal kadaluarsa berdasarkan jumlah hari dari sekarang.
    Output: YYYY-MM-DD
    """
    expiry_date = datetime.now() + timedelta(days=days)
    return expiry_date.strftime("%Y-%m-%d")

def check_expiry_and_notify():
    """
    Cek barang yang mau busuk (expiry_days <= 7).
    Mengambil data kontak Vendor dari tabel 'users' untuk notifikasi.
    """
    print("üîî Checking expiry for notifications...")
    
    # 1. Ambil data stok yang mau busuk (Warning H-7)
    response = supabase.table("supplies").select("*").lte("expiry_days", 7).execute()
    expiring_items = response.data
    
    if not expiring_items:
        return {"status": "no_risk", "messages": []}
        
    notifications = []
    
    # --- LOGIC 1: NOTIFIKASI KE UMKM (VENDOR) ---
    # Kelompokkan item berdasarkan user_id (Vendor Pemilik)
    vendor_groups = {}
    for item in expiring_items:
        uid = item.get("user_id")
        
        # Jika data lama (tidak ada user_id), skip
        if not uid:
            continue
            
        if uid not in vendor_groups:
            vendor_groups[uid] = []
        vendor_groups[uid].append(item)
        
    # Lokasi SPPG (Monas - Jakarta Pusat)
    sppg_lat = -6.175392
    sppg_long = 106.827153
    
    # Loop setiap Vendor untuk kirim notifikasi personal
    for uid, items in vendor_groups.items():
        # 1. Ambil Data User (Vendor) dari Database
        try:
            user_res = supabase.table("users").select("full_name, phone_number, latitude, longitude").eq("id", uid).single().execute()
            vendor_user = user_res.data
        except Exception as e:
            print(f"‚ö†Ô∏è Gagal ambil data user {uid}: {e}")
            continue

        if not vendor_user:
            continue

        # 2. Siapkan Data Pesan
        vendor_name = vendor_user.get('full_name', 'Mitra Vendor')
        phone = vendor_user.get('phone_number', '-')
        item_names = ", ".join([f"{i['item_name']} ({i['quantity']} {i['unit']})" for i in items])
        
        # Hitung jarak vendor ke SPPG (Jika vendor punya GPS)
        v_lat = vendor_user.get('latitude')
        v_long = vendor_user.get('longitude')
        
        dist_info = ""
        if v_lat and v_long:
            dist = haversine_distance(v_lat, v_long, sppg_lat, sppg_long)
            dist_info = f"Lokasi SPPG terdekat berjarak {dist:.1f} km dari titik Anda."
        else:
            dist_info = "Segera tawarkan ke SPPG terdekat."
            
        # 3. Format Pesan WhatsApp
        msg = {
            "to": f"{vendor_name} ({phone})",
            "role": "Vendor (UMKM)",
            "type": "WARNING",
            "message": (
                f"‚ö†Ô∏è Halo {vendor_name}!\n"
                f"Stok berikut akan segera kadaluarsa: {item_names}.\n"
                f"{dist_info}\n"
                f"Saran: Diskonkan sekarang atau donasikan ke Dapur Umum sebelum rugi total!"
            )
        }
        notifications.append(msg)
        
    # --- LOGIC 2: NOTIFIKASI KE SPPG (KITCHEN) ---
    # SPPG butuh solusi (Resep Penyelamatan) dari SEMUA bahan yang mau busuk
    all_expiring_names = sorted([i['item_name'] for i in expiring_items])
    
    if not all_expiring_names:
         # Jika tidak ada item valid, return yang sudah ada
         return {
            "status": "success", 
            "data": notifications,
            "expiring_items": expiring_items,
            "rescue_menu": None
        }

    items_hash = ",".join(all_expiring_names)
    
    global _RESCUE_MENU_CACHE
    
    # Cek Cache: Jika daftar bahannya sama persis, jangan tanya AI lagi (Hemat Biaya)
    if _RESCUE_MENU_CACHE["hash"] == items_hash and _RESCUE_MENU_CACHE["menu"]:
        print("‚ö° Using Cached Rescue Menu (Saving AI Tokens)")
        rescue_menu = _RESCUE_MENU_CACHE["menu"]
    else:
        print("ü§ñ Generating New Rescue Menu via AI...")
        # Minta AI buatkan resep penyelamatan
        rescue_menu_data = generate_menu_recommendation(all_expiring_names)
        
        # Normalisasi struktur data dari AI (kadang return list, kadang dict)
        if isinstance(rescue_menu_data, dict) and "recommendations" in rescue_menu_data:
             rescue_menu = rescue_menu_data["recommendations"][0]
        elif isinstance(rescue_menu_data, list) and len(rescue_menu_data) > 0:
            rescue_menu = rescue_menu_data[0]
        elif isinstance(rescue_menu_data, dict) and "menu_name" in rescue_menu_data:
             rescue_menu = rescue_menu_data
        else:
            print(f"‚ö†Ô∏è Invalid Rescue Menu Data: {rescue_menu_data}")
            rescue_menu = None
            
        # Simpan ke cache
        if rescue_menu:
            _RESCUE_MENU_CACHE = {"hash": items_hash, "menu": rescue_menu}
    
    if rescue_menu:
        menu_name = rescue_menu.get("menu_name", "Tumis Campur Darurat")
        
        # Format pesan WhatsApp untuk Kitchen Admin
        ingredients_str = "\n".join([f"- {i}" for i in rescue_menu.get("ingredients_needed", [])])
        steps_str = "\n".join([f"{idx+1}. {step}" for idx, step in enumerate(rescue_menu.get("cooking_steps", []))])
        
        nut = rescue_menu.get("nutrition", {})
        nutrition_str = f"Kalori: {nut.get('calories', '-')}, Protein: {nut.get('protein', '-')}"
        
        message_body = f"""üö® ALERTA DAPUR: Bahan-bahan berikut hampir expired: {', '.join(all_expiring_names)}!
        
REKOMENDASI AI: Masak '{menu_name}' hari ini untuk menyelamatkan stok!

üõí Bahan Diperlukan:
{ingredients_str}

üë®‚Äçüç≥ Cara Masak:
{steps_str}

üìä Estimasi Nutrisi: {nutrition_str}
Reasoning AI: {rescue_menu.get('reason')}"""

        msg_sppg = {
            "to": "Admin Kitchen SPPG (Broadcast)",
            "role": "SPPG (Kitchen)",
            "type": "URGENT + RECIPE",
            "message": message_body
        }
        notifications.append(msg_sppg)
    
    # Return data terstruktur untuk ditampilkan di Frontend (ExpiryAlerts component)
    return {
        "status": "success", 
        "data": notifications,
        "expiring_items": expiring_items,
        "rescue_menu": rescue_menu
    }

==================================================
FILENAME: .\backend\check_models.py
==================================================
from services.clients import kolosal_client

try:
    models = kolosal_client.models.list()
    print("Available models:")
    for model in models.data:
        print(f"- {model.id}")
except Exception as e:
    print(f"Error listing models: {e}")


==================================================
FILENAME: .\backend\config.py
==================================================


==================================================
FILENAME: .\backend\database.py
==================================================
import os
from supabase import create_client, Client
from dotenv import load_dotenv
from pathlib import Path

# Load env dari folder backend
load_dotenv(Path(__file__).parent / ".env")

url: str = os.getenv("SUPABASE_URL")
key: str = os.getenv("SUPABASE_KEY")

if not url or not key:
    raise ValueError("‚ùå SUPABASE_URL atau SUPABASE_KEY belum diisi di .env!")

# Bikin client global biar bisa dipanggil di mana aja
supabase: Client = create_client(url, key)

==================================================
FILENAME: .\backend\export_openapi.py
==================================================
import json
import os
import sys

# Add current directory to sys.path so we can import main
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from main import app

def export_openapi():
    """
    Export the OpenAPI schema to a JSON file.
    This file can be used by frontend tools (like orval or openapi-typescript)
    to auto-generate strict TypeScript types.
    """
    print("üîÑ Generating OpenAPI Schema...")
    
    openapi_data = app.openapi()
    
    output_path = os.path.join(os.path.dirname(os.path.abspath(__file__)), "openapi.json")
    
    with open(output_path, "w") as f:
        json.dump(openapi_data, f, indent=2)
        
    print(f"‚úÖ Schema exported to: {output_path}")

if __name__ == "__main__":
    export_openapi()


==================================================
FILENAME: .\backend\iot_simulator.py
==================================================
import requests
import time
import random
import json
from datetime import datetime

# Konfigurasi
API_URL = "http://localhost:8000/api/iot/log"
DEVICE_ID = "SENSOR-GUDANG-01"

def generate_data():
    """
    Generate dummy data suhu & kelembaban yang realistis.
    Suhu gudang makanan biasanya dijaga dingin (20-25 derajat).
    """
    # Random float antara 20.0 s/d 25.0
    temp = round(random.uniform(20.0, 25.0), 1)
    
    # Random humidity 50% s/d 70%
    humidity = round(random.uniform(50.0, 70.0), 1)
    
    return {
        "temperature": temp,
        "humidity": humidity,
        "device_id": DEVICE_ID
    }

def run_simulator():
    print(f"üöÄ IoT Simulator Started for {DEVICE_ID}")
    print(f"üì° Sending data to {API_URL} every 5 seconds...")
    print("Press Ctrl+C to stop.\n")

    try:
        while True:
            data = generate_data()
            
            try:
                # Kirim POST Request ke Backend
                response = requests.post(API_URL, json=data)
                
                timestamp = datetime.now().strftime("%H:%M:%S")
                
                if response.status_code == 200:
                    print(f"[{timestamp}] ‚úÖ Sent: Temp={data['temperature']}¬∞C, Hum={data['humidity']}%")
                else:
                    print(f"[{timestamp}] ‚ùå Failed: {response.status_code} - {response.text}")
                    
            except requests.exceptions.ConnectionError:
                print(f"‚ö†Ô∏è  Connection Error: Is the Backend running at {API_URL}?")
            except Exception as e:
                print(f"‚ùå Error: {e}")

            # Tunggu 5 detik sebelum kirim lagi
            time.sleep(5)
            
    except KeyboardInterrupt:
        print("\nüõë Simulator Stopped.")

if __name__ == "__main__":
    run_simulator()


==================================================
FILENAME: .\backend\main.py
==================================================
import traceback
from typing import List, Optional
from datetime import datetime

from fastapi import FastAPI, UploadFile, File, HTTPException, Request, Depends, status
from fastapi.middleware.cors import CORSMiddleware
from fastapi.concurrency import run_in_threadpool

# --- RATE LIMITER ---
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded

# --- TAMBAHAN PENTING (DARI MAIN_OLD) ---
from pydantic import BaseModel 

# --- DATABASE & MODELS ---
from database import supabase
from models import (
    SupplyItem, MenuRequest, OrderRequest, OrderStatusUpdate, 
    CookRequest, IoTLogRequest, UserRegister, UserLogin, Token
)

# --- SECURITY ---
# Pastikan file security.py sudah dibuat di folder yang sama
from security import (
    get_password_hash, 
    verify_password, 
    create_access_token, 
    get_current_user
)

from google.oauth2 import id_token
from google.auth.transport import requests as google_requests
import os

# --- SERVICES ---
from services.vision import analyze_market_inventory, analyze_cooked_meal
from services.kitchen import generate_menu_recommendation, cook_meal
from services.logistics import search_suppliers, search_nearest_sppg
from services.inventory import calculate_expiry_date, check_expiry_and_notify
from services.storage import upload_image_to_supabase
from services.analytics import get_kitchen_analytics, get_vendor_analytics

# 1. Setup Limiter (Kunci berdasarkan IP Address)
limiter = Limiter(key_func=get_remote_address)

app = FastAPI(title="Bekal Bangsa API", version="1.0.0")

# 2. Pasang Limiter & CORS
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"], # Allow all untuk kemudahan demo/hackathon
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
def read_root():
    return {"status": "Backend Bekal Bangsa Ready üöÄ", "auth_mode": "JWT Enabled"}

# ==========================================
# üîê BAGIAN 1: OTENTIKASI (AUTH)
# ==========================================

@app.post("/api/auth/register", response_model=Token)
@limiter.limit("5/minute")
async def register(request: Request, user: UserRegister):
    """
    Mendaftarkan user baru (Vendor/Kitchen) ke database Supabase.
    """
    # 1. Cek apakah email/username sudah ada
    existing = supabase.table("users").select("id")\
        .or_(f"email.eq.{user.email},username.eq.{user.username}")\
        .execute()
    
    if existing.data:
        raise HTTPException(status_code=400, detail="Email atau Username sudah terdaftar")

    # 2. Hash Password
    hashed_pw = get_password_hash(user.password)

    # 3. Siapkan data user (Default lokasi Monas untuk demo jika kosong)
    user_data = {
        "full_name": user.full_name,
        "email": user.email,
        "username": user.username,
        "password": hashed_pw,
        "role": user.role,
        "phone_number": user.phone_number,
        "address": user.address,
        "latitude": -6.175392, # Default demo location
        "longitude": 106.827153
    }
    
    try:
        # 4. Insert ke DB
        res = supabase.table("users").insert(user_data).execute()
        new_user = res.data[0]
        
        # 5. Auto Login (Generate Token)
        access_token = create_access_token(data={"sub": str(new_user['id']), "role": new_user['role']})
        
        return {
            "access_token": access_token, 
            "token_type": "bearer",
            "user": {
                "id": new_user['id'],
                "full_name": new_user['full_name'],
                "role": new_user['role']
            }
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Gagal register: {str(e)}")

@app.post("/api/auth/login", response_model=Token)
@limiter.limit("10/minute")
async def login(request: Request, creds: UserLogin):
    """
    Login dengan Username ATAU Email.
    """
    try:
        # Cari user di DB
        res = supabase.table("users").select("*")\
            .or_(f"email.eq.{creds.username_or_email},username.eq.{creds.username_or_email}")\
            .execute()
        
        user = res.data[0] if res.data else None

        # Verifikasi Password
        if not user or not verify_password(creds.password, user['password']):
            raise HTTPException(status_code=401, detail="Username atau Password salah")

        # Generate Token JWT
        token = create_access_token(data={"sub": str(user['id']), "role": user['role']})
        
        return {
            "access_token": token, 
            "token_type": "bearer",
            "user": {
                "id": user['id'],
                "full_name": user['full_name'],
                "role": user['role'],
                "address": user.get('address'),
                "latitude": user.get('latitude'),
                "longitude": user.get('longitude')
            }
        }
    except Exception as e:
        # Tangkap error lain biar server gak crash
        print(f"Login Error: {e}")
        if isinstance(e, HTTPException): raise e
        raise HTTPException(status_code=500, detail="Internal Server Error saat Login")

# ==========================================
# üì¶ BAGIAN 2: FITUR VENDOR (PROTECTED)
# ==========================================

@app.post("/api/supplies")
@limiter.limit("20/minute")
async def create_supplies(
    request: Request, 
    items: List[SupplyItem], 
    current_user: dict = Depends(get_current_user) # <--- WAJIB LOGIN
):
    """
    Upload stok dagangan. 
    Hanya user dengan role 'vendor' yang boleh akses.
    Data otomatis diberi label milik user yang login.
    """
    if current_user["role"] != "vendor":
        raise HTTPException(status_code=403, detail="Akses ditolak: Hanya Vendor bisa upload stok")

    try:
        # Ambil info lengkap user (buat field owner_name & location di tabel supplies)
        user_info_res = supabase.table("users").select("*").eq("id", current_user["user_id"]).single().execute()
        user_info = user_info_res.data

        data_to_insert = []
        for item in items:
            # Hitung tanggal expiry otomatis jika user tidak isi manual
            final_expiry = item.expiry_date
            if not final_expiry and item.expiry_days:
                final_expiry = calculate_expiry_date(item.expiry_days)
            
            data_to_insert.append({
                "item_name": item.name,
                "quantity": item.qty,
                "unit": item.unit,
                "quality_status": item.freshness,
                "expiry_days": item.expiry_days,
                "expiry_date": final_expiry,
                "photo_url": item.photo_url,
                "ai_notes": item.note,
                
                # --- PENTING: RELASI KE USER ---
                "user_id": current_user["user_id"], # Link ID Foreign Key
                
                # Denormalisasi data (opsional, biar query gampang)
                "owner_name": user_info.get('full_name', 'Vendor'), 
                "location": user_info.get('address', 'Pasar Tradisional'),
                "latitude": item.latitude or user_info.get('latitude'),
                "longitude": item.longitude or user_info.get('longitude')
            })
        
        response = supabase.table("supplies").insert(data_to_insert).execute()
        return {"status": "success", "count": len(items), "data": response.data}
    
    except Exception as e:
        traceback.print_exc()
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/supplies/vendor")
async def get_my_supplies(request: Request, current_user: dict = Depends(get_current_user)):
    """
    Dashboard Vendor: Hanya menampilkan barang milik user yang sedang login.
    """
    if current_user["role"] != "vendor":
        raise HTTPException(status_code=403, detail="Akses ditolak")
        
    try:
        # Filter: user_id == ID Login
        response = supabase.table("supplies").select("*")\
            .eq("user_id", current_user["user_id"])\
            .order("created_at", desc=True).execute()
        return {"supplies": response.data}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/orders/umkm")
async def get_incoming_orders(request: Request, current_user: dict = Depends(get_current_user)):
    """
    Vendor melihat pesanan masuk (order yang membeli barang miliknya).
    """
    if current_user["role"] != "vendor":
        raise HTTPException(status_code=403, detail="Akses ditolak")

    try:
        # 1. Cari ID semua barang milik vendor ini
        my_supplies = supabase.table("supplies").select("id").eq("user_id", current_user["user_id"]).execute()
        my_supply_ids = [s['id'] for s in my_supplies.data]
        
        if not my_supply_ids:
            return {"orders": []}

        # 2. Cari Order yang supply_id-nya ada di list barang saya
        # Menggunakan join supplies(*) untuk ambil nama barang
        orders = supabase.table("orders")\
            .select("*, supplies(item_name, unit)")\
            .in_("supply_id", my_supply_ids)\
            .order("created_at", desc=True)\
            .execute()
            
        return {"orders": orders.data}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.put("/api/orders/{order_id}")
async def update_order_status(order_id: int, update: OrderStatusUpdate, current_user: dict = Depends(get_current_user)):
    """
    Vendor menerima/menolak pesanan.
    """
    if current_user["role"] != "vendor":
        raise HTTPException(status_code=403, detail="Akses ditolak")
    
    try:
        # Idealnya cek dulu apakah order ini milik vendor, tapi untuk demo langsung update aja
        response = supabase.table("orders").update({"status": update.status}).eq("id", order_id).execute()
        return {"status": "success", "data": response.data}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

# ==========================================
# üç≥ BAGIAN 3: FITUR KITCHEN (PROTECTED)
# ==========================================

@app.post("/api/orders")
@limiter.limit("20/minute")
async def create_order(
    request: Request, 
    order: OrderRequest, 
    current_user: dict = Depends(get_current_user)
):
    """
    Kitchen membuat pesanan ke Vendor.
    """
    if current_user["role"] != "kitchen":
        raise HTTPException(status_code=403, detail="Hanya Kitchen bisa memesan")

    try:
        # Ambil nama kitchen buat dipasang di order
        user_res = supabase.table("users").select("full_name").eq("id", current_user["user_id"]).single().execute()
        kitchen_name = user_res.data['full_name']

        # Cari tahu siapa penjualnya (Seller ID) berdasarkan supply_id
        supply_res = supabase.table("supplies").select("user_id").eq("id", order.supply_id).single().execute()
        seller_id = supply_res.data['user_id'] if supply_res.data else None

        data = {
            "supply_id": order.supply_id,
            "qty_ordered": order.qty_ordered,
            "status": "pending",
            
            # Info Pembeli & Penjual
            "buyer_id": current_user["user_id"],
            "buyer_name": kitchen_name, 
            "seller_id": seller_id
        }
        
        response = supabase.table("orders").insert(data).execute()
        return {"status": "success", "data": response.data}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

# --- TAMBAHAN BARU: RIWAYAT BELANJA KITCHEN ---
@app.get("/api/orders/kitchen")
async def get_my_orders(request: Request, current_user: dict = Depends(get_current_user)):
    """
    Melihat riwayat pesanan yang dibuat oleh Kitchen ini.
    """
    if current_user["role"] != "kitchen":
        raise HTTPException(status_code=403, detail="Akses ditolak")

    try:
        # Ambil orders dimana buyer_id = user yang login
        # Join dengan supplies untuk dapat nama barang
        orders = supabase.table("orders")\
            .select("*, supplies(item_name, unit)")\
            .eq("buyer_id", current_user["user_id"])\
            .order("created_at", desc=True)\
            .execute()
            
        return {"orders": orders.data}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/kitchen/cook")
async def cook_meal_endpoint(request: Request, req_data: CookRequest, current_user: dict = Depends(get_current_user)):
    """
    Mencatat produksi makanan & mengurangi stok.
    """
    if current_user["role"] != "kitchen":
        raise HTTPException(status_code=403, detail="Akses ditolak")
        
    try:
        # Panggil logic service
        result = cook_meal(req_data.menu_name, req_data.qty_produced, req_data.ingredients_ids)
        if "error" in result:
             raise HTTPException(status_code=500, detail=result["error"])
        return result
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/kitchen/meals")
async def get_cooked_meals(request: Request):
    """
    Ambil riwayat masakan yang sudah diproduksi (untuk monitoring expiry).
    """
    try:
        response = supabase.table("meal_productions").select("*").order("created_at", desc=True).execute()
        return response.data
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

# ==========================================
# ü§ñ BAGIAN 4: FITUR PUBLIK & AI
# ==========================================

@app.post("/api/analyze")
@limiter.limit("10/minute")
async def analyze_image(request: Request, file: UploadFile = File(...)):
    """
    AI Vision: Analisis Stok Mentah.
    Rate Limit: 10x / menit per IP.
    """
    try:
        image_bytes = await file.read()
        # Jalankan di threadpool biar tidak blocking
        result = await run_in_threadpool(analyze_market_inventory, image_bytes)
        return result
    except Exception as e:
        traceback.print_exc()
        raise HTTPException(status_code=500, detail=f"AI Error: {str(e)}")

@app.post("/api/kitchen/scan-meal")
@app.post("/api/kitchen/scan-food") # Alias untuk endpoint yang sama
@limiter.limit("10/minute")
async def scan_meal(request: Request, file: UploadFile = File(...)):
    """
    AI Vision: QC Makanan Matang.
    """
    try:
        image_bytes = await file.read()
        result = await run_in_threadpool(analyze_cooked_meal, image_bytes)
        return result
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/upload")
@limiter.limit("30/minute")
async def upload_file_endpoint(request: Request, file: UploadFile = File(...)):
    """
    Upload gambar ke Supabase Storage.
    """
    try:
        url = await upload_image_to_supabase(file)
        if not url:
            raise HTTPException(status_code=500, detail="Gagal upload ke Storage")
        return {"url": url}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/recommend-menu")
@limiter.limit("10/minute")
async def recommend_menu_endpoint(request: Request, request_data: MenuRequest):
    """
    AI Text: Rekomendasi Menu dari Stok.
    """
    result = await run_in_threadpool(generate_menu_recommendation, request_data.ingredients)
    if "error" in result:
        raise HTTPException(status_code=500, detail=result["error"])
    return result

# ==========================================
# üåç BAGIAN 5: DASHBOARD & PENCARIAN
# ==========================================

@app.get("/api/supplies")
async def get_all_supplies(request: Request, skip: int = 0, limit: int = 100):
    """
    Melihat semua stok di pasar (Katalog Belanja Kitchen).
    Tidak perlu login biar Kitchen bisa browsing dulu.
    """
    try:
        response = supabase.table("supplies").select("*")\
            .order("created_at", desc=True)\
            .range(skip, skip + limit - 1)\
            .execute()
        return response.data
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/suppliers/search")
async def find_suppliers(request: Request, q: str, lat: float = -6.175392, long: float = 106.827153):
    """
    Cari supplier berdasarkan keyword & lokasi terdekat.
    """
    results = search_suppliers(q, lat, long)
    if isinstance(results, dict) and "error" in results:
        raise HTTPException(status_code=500, detail=results["error"])
    return {"status": "success", "count": len(results), "data": results}

@app.get("/api/sppg/search")
async def find_nearest_sppg(request: Request, lat: float, long: float):
    """
    Vendor mencari lokasi Kitchen/SPPG terdekat.
    """
    results = search_nearest_sppg(lat, long)
    return {"status": "success", "data": results}

# --- ANALYTICS ---
@app.get("/api/analytics/kitchen")
async def kitchen_analytics_endpoint(request: Request):
    result = get_kitchen_analytics()
    if "error" in result: raise HTTPException(status_code=500, detail=result["error"])
    return result

@app.get("/api/analytics/vendor")
async def vendor_analytics_endpoint(request: Request):
    result = get_vendor_analytics()
    if "error" in result: raise HTTPException(status_code=500, detail=result["error"])
    return result

# ==========================================
# üì° BAGIAN 6: IOT & NOTIFIKASI
# ==========================================

@app.post("/api/iot/log")
@limiter.limit("120/minute")
async def log_iot_data(request: Request, data: IoTLogRequest):
    try:
        payload = {
            "temperature": data.temperature,
            "humidity": data.humidity,
            "device_id": data.device_id
        }
        response = supabase.table("storage_logs").insert(payload).execute()
        return {"status": "success", "data": response.data}
    except Exception as e:
        return {"status": "error", "detail": str(e)}

@app.get("/api/iot/logs")
async def get_iot_logs(request: Request):
    try:
        response = supabase.table("storage_logs").select("*").order("created_at", desc=True).limit(50).execute()
        return {"logs": response.data} # Wrap in object for frontend consistency
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/notifications/trigger")
def trigger_expiry_notifications(request: Request):
    """
    Cron job untuk cek barang mau busuk.
    """
    try:
        return check_expiry_and_notify()
    except Exception as e:
        traceback.print_exc()
        raise HTTPException(status_code=500, detail=str(e))

# ==========================================
# üåç GOOGLE LOGIN MODEL
# ==========================================

class GoogleLoginRequest(BaseModel):
    token: str
    role: str = "vendor" # Default role jika user baru

@app.post("/api/auth/google", response_model=Token)
async def google_login(data: GoogleLoginRequest):
    """
    Tukar Google Token dengan App Token (JWT).
    Jika user belum ada di DB, otomatis REGISTER.
    """
    token = data.token
    client_id = os.getenv("GOOGLE_CLIENT_ID")
    
    try:
        # 1. Verifikasi Token ke Server Google
        id_info = id_token.verify_oauth2_token(token, google_requests.Request(), client_id)
        
        # Ambil data profil dari Google
        email = id_info['email']
        name = id_info.get('name', 'Google User')
        google_sub = id_info['sub'] # ID unik Google user
        
        # 2. Cek apakah user sudah ada di Database
        res = supabase.table("users").select("*").eq("email", email).execute()
        user = res.data[0] if res.data else None
        
        if not user:
            # 3. Jika belum ada, AUTO REGISTER
            new_user_data = {
                "full_name": name,
                "email": email,
                "username": email.split("@")[0], # Pakai nama depan email sbg username
                "password": get_password_hash(f"GOOGLE_{google_sub}"), # Password dummy acak yg kuat
                "role": data.role, # Role diambil dari pilihan user di frontend
                "latitude": -6.175392, # Default
                "longitude": 106.827153
            }
            insert_res = supabase.table("users").insert(new_user_data).execute()
            user = insert_res.data[0]
            
        # 4. Generate Token Aplikasi (Sama seperti login biasa)
        access_token = create_access_token(data={"sub": str(user['id']), "role": user['role']})
        
        return {
            "access_token": access_token,
            "token_type": "bearer",
            "user": {
                "id": user['id'],
                "full_name": user['full_name'],
                "role": user['role'],
                "address": user.get('address'),
                "latitude": user.get('latitude'),
                "longitude": user.get('longitude')
            }
        }
        
    except ValueError as e:
        # Token tidak valid
        raise HTTPException(status_code=401, detail="Token Google tidak valid")
    except Exception as e:
        print(f"Google Login Error: {e}")
        raise HTTPException(status_code=500, detail=str(e))

==================================================
FILENAME: .\backend\models.py
==================================================
from pydantic import BaseModel
from typing import Optional, List

# ==========================================
# üîê 1. AUTH MODELS (OTENTIKASI)
# ==========================================

class UserRegister(BaseModel):
    full_name: str
    email: str
    username: str
    password: str
    role: str # 'vendor' atau 'kitchen'
    phone_number: Optional[str] = None
    address: Optional[str] = None

class UserLogin(BaseModel):
    username_or_email: str
    password: str

class Token(BaseModel):
    access_token: str
    token_type: str
    user: dict

class GoogleLoginRequest(BaseModel):
    token: str
    role: str = "vendor" # Default role jika user baru

# ==========================================
# üì¶ 2. SUPPLY CHAIN MODELS (STOK)
# ==========================================

class SupplyItem(BaseModel):
    # Field Wajib (dari AI/Input User)
    name: str           # Contoh: "Bawang Merah"
    qty: int            # Contoh: 5
    unit: str           # Contoh: "Pcs"
    freshness: str      # Contoh: "Sangat Segar"
    expiry_days: int    # Contoh: 14
    
    # Field Optional (Default Value)
    note: Optional[str] = None      # Alasan AI
    
    # Field ini akan diisi otomatis oleh Backend berdasarkan Token Login
    owner_name: Optional[str] = None  
    location: Optional[str] = None 
    
    # Field Lokasi (GPS)
    latitude: Optional[float] = None
    longitude: Optional[float] = None
    
    # Field Tambahan (Update Produksi)
    photo_url: Optional[str] = None     # Link Foto Bukti
    expiry_date: Optional[str] = None   # Tanggal Pasti (YYYY-MM-DD)

# ==========================================
# üçΩÔ∏è 3. KITCHEN & ORDER MODELS (TRANSAKSI)
# ==========================================

class MenuRequest(BaseModel):
    ingredients: List[str] # Contoh: ["Bayam", "Tahu"]

class OrderRequest(BaseModel):
    supply_id: int
    qty_ordered: int
    # Buyer name diambil otomatis dari Token Login
    buyer_name: Optional[str] = None 

class OrderStatusUpdate(BaseModel):
    status: str # 'confirmed', 'completed', 'pending'

class CookRequest(BaseModel):
    menu_name: str
    qty_produced: int
    ingredients_ids: List[int] # ID barang di gudang yang dipakai
    
class MealAnalysisRequest(BaseModel):
    # Model dummy untuk dokumentasi, implementasi pakai UploadFile di main.py
    pass 

# ==========================================
# üì° 4. IOT & SMART STORAGE MODELS
# ==========================================

class IoTLogRequest(BaseModel):
    temperature: float
    humidity: float
    device_id: str = "SENSOR-01"

==================================================
FILENAME: .\backend\prompts.py
==================================================
def get_inventory_analysis_prompt():
    return """
    Kamu adalah AI Inventory Cerdas untuk pedagang pasar tradisional Indonesia.
    Tugasmu adalah melihat gambar stok dagangan dan mengekstrak data logistik.

    Lakukan langkah berpikir ini:
    1. IDENTIFIKASI: Barang apa ini? (Gunakan nama lokal Indonesia, misal: Bawang Merah, Cabe Rawit).
    2. HITUNG (COUNTING): 
       - Hitung jumlah objek yang terlihat dengan teliti.
       - Jika barangnya satuan (seperti Bawang, Telur, Buah), hitung per butir/pcs.
       - Jika barangnya dalam wadah (seperti Beras dalam karung), hitung wadahnya.
       - Jika bertumpuk sangat banyak (seperti cabe sekilo), berikan estimasi "1" dengan satuan "Tumpukan/Kg".
    3. QUALITY CHECK: Lihat warna, tekstur, dan kulit. Apakah segar? Ada busuk?
    4. EXPIRY PREDICTION: Estimasi sisa hari layak konsumsi di suhu ruang.

    Output HANYA JSON raw (tanpa markdown ```json):
    {
        "items": [
            {
                "name": "Nama Barang",
                "qty": (integer),
                "unit": "Pcs/Ikat/Karung/Kg",
                "freshness": "Sangat Segar/Cukup/Layum/Busuk",
                "expiry_days": (integer sisa hari),
                "visual_reasoning": "Penjelasan singkat kenapa dinilai segitu"
            }
        ]
    }
    """

def get_menu_recommendation_prompt(ingredients_text):
    return f"""
    Kamu adalah Ahli Gizi dan Koki untuk program Makan Bergizi Gratis (MBG).
    STOK BAHAN TERSEDIA di gudang: {ingredients_text}.

    Tugasmu:
    1. Rancang Menu Makan Siang **Terbaik** untuk anak sekolah, berdasarkan bahan yang tersedia (meskipun menu hanya terdiri dari satu komponen, itu tidak masalah).
    2. Sesuaikan hidangan berdasarkan bahan, jangan memaksakan bahan untuk membuat hidangan yang aneh. Hidangan bisa berupa makanan gurih/asin, bisa manis/dessert, bisa kudapan, bisa minuman.
    contoh: bahan hanya semangka, maka menu adalah jus semangka bukan nasi goreng semangka
    3. Kepatuhan: Menu harus memenuhi syarat **Murah, Bergizi, Praktis, dan Lokal**.

    Output HANYA dalam format JSON raw (tanpa markdown ```json):
    {{
        "recommendations": [
            {{
                "menu_name": "Nama Menu Final (Contoh: Potongan Semangka Saja)",
                "description": "Deskripsi singkat tentang menu ini.",
                "ingredients": ["List bahan yang digunakan dari stok", "termasuk buah/penutup"],
                "ingredients_needed": [
                    "Sebutkan BAHAN dan KUANTITAS spesifik (Contoh: Ayam 5 kg)",
                    "Contoh: Beras 10 kg"
                ],
                "cooking_steps": [
                    "Langkah 1: Siapkan...",
                    "Langkah 2: Proses memasak...",
                    "Langkah 3: Sajikan..."
                ],
                "nutrition": {{
                    "calories": "Estimasi Kalori (misal: 500 kcal)",
                    "protein": "Estimasi Protein (misal: 20g)",
                    "carbs": "Estimasi Karbohidrat",
                    "fats": "Estimasi Lemak"
                }},
                "reason": "Jelaskan kenapa menu ini cocok."
            }}
        ]
    }}
    """
    
def get_cooked_meal_analysis_prompt():
    return """
    Kamu adalah Ahli Keamanan Pangan & Gizi.
    Analisis foto makanan matang (Lunch Box/Piring) ini.
    
    Tugas:
    1. Deteksi menu apa ini.
    2. SAFETY CHECK: Apakah terlihat basi? (Lendir, warna aneh, jamur, bau).
    3. NUTRITION: Estimasi kalori & nutrisi makro sepiring ini.
    
    PENTING: 
    - ANALISIS GAMBAR YANG DIBERIKAN, jangan asal copy contoh
    - is_safe: true jika makanan AMAN, false jika ADA TANDA-TANDA PEMBUSUKAN
    - spoilage_signs: isi dengan tanda pembusukan yang terlihat (jika ada), kosongkan [] jika aman
    - Nilai nutrition_estimate harus ANGKA saja (contoh: "650", bukan "650-750 kkal")
    - Gunakan key "fats" bukan "fat"
    - JANGAN tambahkan field seperti "fiber", "detail_analysis", dll
    
    Output HANYA JSON dengan format ini:
    {
        "menu_name": "Nama menu berdasarkan analisis gambar",
        "is_safe": true atau false (ANALISIS GAMBAR!),
        "spoilage_signs": ["tanda1", "tanda2"] atau [] jika aman,
        "nutrition_estimate": {
            "calories": "estimasi angka",
            "protein": "estimasi angka",
            "carbs": "estimasi angka",
            "fats": "estimasi angka"
        },
        "visual_quality": "Deskripsi kualitas visual"
    }
    """

def get_meal_expiry_prompt(menu_name):
    return f"""
    Kamu adalah Ahli Keamanan Pangan & Higiene Sanitasi.
    
    Tugas: Analisis keamanan pangan untuk menu masakan matang: "{menu_name}".
    Berikan estimasi umur simpan (Shelf Life) dalam DUA kondisi, tips penyimpanan, DAN estimasi nutrisi per porsi.
    
    Output HANYA JSON raw (tanpa markdown):
    {{
        "room_temp_hours": (integer, estimasi tahan berapa jam di suhu ruang/kelas),
        "fridge_hours": (integer, estimasi tahan berapa jam jika masuk kulkas/chiller),
        "risk_factor": "Rendah/Sedang/Tinggi (Misal: Tinggi karena bersantan)",
        "storage_tips": "Saran singkat, padat, teknis (Misal: 'Jangan tutup wadah saat panas', 'Pisahkan kuah dan isi')",
        "nutrition": {{
            "calories": "Estimasi Kalori (misal: 500 kcal)",
            "protein": "Estimasi Protein (misal: 20g)",
            "carbs": "Estimasi Karbohidrat",
            "fats": "Estimasi Lemak"
        }}
    }}
    """



==================================================
FILENAME: .\backend\reset_admin.py
==================================================
# backend/reset_admin.py
from database import supabase
from security import get_password_hash

# 1. Buat Hash yang VALID di komputer ini
password_baru = "123456"
hash_baru = get_password_hash(password_baru)

print(f"Generating hash for '{password_baru}'...")
print(f"New Hash: {hash_baru}")

# 2. Update User 'bu_susi' dengan hash ini
try:
    response = supabase.table("users").update({"password": hash_baru}).eq("username", "bu_susi").execute()
    print("‚úÖ Berhasil reset password Bu Susi!")
    print(response.data)
except Exception as e:
    print(f"‚ùå Gagal update: {e}")

try:
    response = supabase.table("users").update({"password": hash_baru}).eq("username", "pak_asep").execute()
    print("‚úÖ Berhasil reset password Bu Susi!")
    print(response.data)
except Exception as e:
    print(f"‚ùå Gagal update: {e}")

# 3. Update User 'admin_pusat' (Kitchen) sekalian
try:
    supabase.table("users").update({"password": hash_baru}).eq("username", "sppg_pusat").execute()
    print("‚úÖ Berhasil reset password Admin Pusat!")
except Exception as e:
    print(f"‚ùå Gagal update kitchen: {e}")

try:
    supabase.table("users").update({"password": hash_baru}).eq("username", "sppg_selatan").execute()
    print("‚úÖ Berhasil reset password Admin Pusat!")
except Exception as e:
    print(f"‚ùå Gagal update kitchen: {e}")

==================================================
FILENAME: .\backend\security.py
==================================================
from datetime import datetime, timedelta
from typing import Optional
from jose import JWTError, jwt
from passlib.context import CryptContext
from fastapi.security import OAuth2PasswordBearer
from fastapi import Depends, HTTPException, status
from database import supabase

SECRET_KEY = "RAHASIA_NEGARA_BEKAL_BANGSA_GANTI_INI"
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 60 * 24 # 1 Hari

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/auth/login")

def verify_password(plain_password, hashed_password):
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password):
    return pwd_context.hash(password)

def create_access_token(data: dict):
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt

# Dependency untuk mendapatkan user yang sedang login di setiap endpoint
async def get_current_user(token: str = Depends(oauth2_scheme)):
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="Could not validate credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id: str = payload.get("sub")
        role: str = payload.get("role")
        if user_id is None:
            raise credentials_exception
    except JWTError:
        raise credentials_exception
        
    # Opsional: Cek ke DB jika ingin validasi real-time (tapi nambah latensi)
    return {"user_id": int(user_id), "role": role}

==================================================
FILENAME: .\backend\services\analytics.py
==================================================
from .clients import supabase
from collections import defaultdict
from datetime import datetime, timedelta

def get_kitchen_analytics():
    """
    Aggregates data for SPPG Dashboard (Streamlit Style).
    1. Composition (Pie): Item Name vs Quantity
    2. Quality (Bar): Item Name vs Quantity (colored by status?) - Simplified to just Quantity per Item for now, or stacked if possible.
    3. Metrics: Total Items, Total Qty, Warning Count
    """
    try:
        # Fetch all supplies
        response = supabase.table("supplies").select("*").execute()
        items = response.data
        
        if not items:
            return {
                "metrics": {"total_items": 0, "total_qty": 0, "warning_count": 0},
                "composition": [],
                "quality": []
            }

        # 1. Metrics
        total_items = len(items)
        total_qty = sum(item['quantity'] for item in items)
        # Warning count: expiry_days <= 3
        warning_count = sum(1 for item in items if item.get('expiry_days', 0) <= 3)

        # 2. Composition (Pie Chart Data)
        # Group by item_name
        composition_map = defaultdict(int)
        for item in items:
            composition_map[item['item_name']] += item['quantity']
        
        composition_data = [
            {"name": name, "value": qty} 
            for name, qty in composition_map.items()
        ]
        # Sort by value desc
        composition_data.sort(key=lambda x: x['value'], reverse=True)

        # 3. Quality/Quantity (Bar Chart Data)
        # For simplicity in Recharts, we'll just show the same grouped data but maybe add status info if needed.
        # Streamlit used: x='item_name', y='quantity', color='quality_status'
        # To do this in Recharts, we need data like: { name: "Bayam", fresh: 10, warning: 5, critical: 0 }
        
        quality_map = defaultdict(lambda: {"fresh": 0, "warning": 0, "critical": 0})
        
        for item in items:
            name = item['item_name']
            days = item.get('expiry_days', 0)
            qty = item['quantity']
            
            if days <= 2:
                quality_map[name]["critical"] += qty
            elif days <= 5:
                quality_map[name]["warning"] += qty
            else:
                quality_map[name]["fresh"] += qty
                
        quality_data = []
        for name, counts in quality_map.items():
            quality_data.append({
                "name": name,
                "fresh": counts["fresh"],
                "warning": counts["warning"],
                "critical": counts["critical"],
                "total": counts["fresh"] + counts["warning"] + counts["critical"]
            })
            
        quality_data.sort(key=lambda x: x['total'], reverse=True)

        return {
            "metrics": {
                "total_items": total_items,
                "total_qty": total_qty,
                "warning_count": warning_count
            },
            "composition": composition_data, # For Pie Chart
            "quality": quality_data          # For Stacked Bar Chart
        }

    except Exception as e:
        print(f"Error getting kitchen analytics: {e}")
        return {"error": str(e)}

def get_vendor_analytics():
    """
    Aggregates data for Vendor Dashboard.
    1. Inventory Health: Count Fresh/Warning/Expired
    2. Expiry Risk: Pie Chart
    3. Top Sales: Bar Chart (from Orders)
    """
    try:
        # --- Inventory Health & Expiry Risk ---
        response = supabase.table("supplies").select("*").execute()
        items = response.data
        
        fresh = 0
        warning = 0
        expired = 0
        
        for item in items:
            days = item.get('expiry_days', 0)
            if days <= 0: # Assuming 0 or less is expired/critical for this chart
                expired += 1
            elif days <= 5:
                warning += 1
            else:
                fresh += 1
                
        inventory_health = {
            "fresh": fresh,
            "warning": warning,
            "expired": expired
        }
        
        expiry_risk_data = [
            {"name": "Aman", "value": fresh, "fill": "#10B981"},
            {"name": "Peringatan", "value": warning, "fill": "#F59E0B"},
            {"name": "Kadaluwarsa", "value": expired, "fill": "#EF4444"}
        ]

        # --- Top Sales ---
        # Fetch orders
        orders_resp = supabase.table("orders").select("*, supplies(item_name)").execute()
        orders = orders_resp.data
        
        sales_map = defaultdict(int)
        if orders:
            for order in orders:
                # Try to get name from joined supply, fallback to supply_name if stored, or ID
                name = "Unknown"
                if order.get('supplies'):
                     name = order['supplies'].get('item_name', 'Unknown')
                elif order.get('supply_name'):
                     name = order['supply_name']
                
                sales_map[name] += order['qty_ordered']
        
        sales_data = [
            {"name": name, "value": qty}
            for name, qty in sales_map.items()
        ]
        sales_data.sort(key=lambda x: x['value'], reverse=True)
        sales_data = sales_data[:5] # Top 5

        return {
            "inventory_health": inventory_health,
            "expiry_risk": expiry_risk_data,
            "top_sales": sales_data
        }

    except Exception as e:
        print(f"Error getting vendor analytics: {e}")
        return {"error": str(e)}


==================================================
FILENAME: .\backend\services\clients.py
==================================================
import os
from pathlib import Path
from dotenv import load_dotenv
from openai import OpenAI
from database import supabase

# Explicitly load .env from the backend directory (parent of services)
load_dotenv(Path(__file__).parent.parent / ".env")

# --- SETUP CLIENTS ---
kolosal_client = OpenAI(
    api_key=os.getenv("KOLOSAL_API_KEY"),
    base_url=os.getenv("KOLOSAL_BASE_URL")
)


==================================================
FILENAME: .\backend\services\inventory.py
==================================================
from datetime import datetime, timedelta
from database import supabase
from .logistics import haversine_distance
from .kitchen import generate_menu_recommendation

# Global Cache untuk Resep Penyelamatan (Reset saat restart server)
_RESCUE_MENU_CACHE = {"hash": "", "menu": None}

def calculate_expiry_date(days: int) -> str:
    """
    Menghitung tanggal kadaluarsa berdasarkan jumlah hari dari sekarang.
    Output: YYYY-MM-DD
    """
    expiry_date = datetime.now() + timedelta(days=days)
    return expiry_date.strftime("%Y-%m-%d")

def check_expiry_and_notify():
    """
    Cek barang yang mau busuk (expiry_days <= 7).
    Mengambil data kontak Vendor dari tabel 'users' untuk notifikasi.
    """
    print("üîî Checking expiry for notifications...")
    
    # 1. Ambil data stok yang mau busuk (Warning H-7)
    response = supabase.table("supplies").select("*").lte("expiry_days", 7).execute()
    expiring_items = response.data
    
    if not expiring_items:
        return {"status": "no_risk", "messages": []}
        
    notifications = []
    
    # --- LOGIC 1: NOTIFIKASI KE UMKM (VENDOR) ---
    # Kelompokkan item berdasarkan user_id (Vendor Pemilik)
    vendor_groups = {}
    for item in expiring_items:
        uid = item.get("user_id")
        
        # Jika data lama (tidak ada user_id), skip
        if not uid:
            continue
            
        if uid not in vendor_groups:
            vendor_groups[uid] = []
        vendor_groups[uid].append(item)
        
    # Lokasi SPPG (Monas - Jakarta Pusat)
    sppg_lat = -6.175392
    sppg_long = 106.827153
    
    # Loop setiap Vendor untuk kirim notifikasi personal
    for uid, items in vendor_groups.items():
        # 1. Ambil Data User (Vendor) dari Database
        try:
            user_res = supabase.table("users").select("full_name, phone_number, latitude, longitude").eq("id", uid).single().execute()
            vendor_user = user_res.data
        except Exception as e:
            print(f"‚ö†Ô∏è Gagal ambil data user {uid}: {e}")
            continue

        if not vendor_user:
            continue

        # 2. Siapkan Data Pesan
        vendor_name = vendor_user.get('full_name', 'Mitra Vendor')
        phone = vendor_user.get('phone_number', '-')
        item_names = ", ".join([f"{i['item_name']} ({i['quantity']} {i['unit']})" for i in items])
        
        # Hitung jarak vendor ke SPPG (Jika vendor punya GPS)
        v_lat = vendor_user.get('latitude')
        v_long = vendor_user.get('longitude')
        
        dist_info = ""
        if v_lat and v_long:
            dist = haversine_distance(v_lat, v_long, sppg_lat, sppg_long)
            dist_info = f"Lokasi SPPG terdekat berjarak {dist:.1f} km dari titik Anda."
        else:
            dist_info = "Segera tawarkan ke SPPG terdekat."
            
        # 3. Format Pesan WhatsApp
        msg = {
            "to": f"{vendor_name} ({phone})",
            "role": "Vendor (UMKM)",
            "type": "WARNING",
            "message": (
                f"‚ö†Ô∏è Halo {vendor_name}!\n"
                f"Stok berikut akan segera kadaluarsa: {item_names}.\n"
                f"{dist_info}\n"
                f"Saran: Diskonkan sekarang atau donasikan ke Dapur Umum sebelum rugi total!"
            )
        }
        notifications.append(msg)
        
    # --- LOGIC 2: NOTIFIKASI KE SPPG (KITCHEN) ---
    # SPPG butuh solusi (Resep Penyelamatan) dari SEMUA bahan yang mau busuk
    all_expiring_names = sorted([i['item_name'] for i in expiring_items])
    
    if not all_expiring_names:
         # Jika tidak ada item valid, return yang sudah ada
         return {
            "status": "success", 
            "data": notifications,
            "expiring_items": expiring_items,
            "rescue_menu": None
        }

    items_hash = ",".join(all_expiring_names)
    
    global _RESCUE_MENU_CACHE
    
    # Cek Cache: Jika daftar bahannya sama persis, jangan tanya AI lagi (Hemat Biaya)
    if _RESCUE_MENU_CACHE["hash"] == items_hash and _RESCUE_MENU_CACHE["menu"]:
        print("‚ö° Using Cached Rescue Menu (Saving AI Tokens)")
        rescue_menu = _RESCUE_MENU_CACHE["menu"]
    else:
        print("ü§ñ Generating New Rescue Menu via AI...")
        # Minta AI buatkan resep penyelamatan
        rescue_menu_data = generate_menu_recommendation(all_expiring_names)
        
        # Normalisasi struktur data dari AI (kadang return list, kadang dict)
        if isinstance(rescue_menu_data, dict) and "recommendations" in rescue_menu_data:
             rescue_menu = rescue_menu_data["recommendations"][0]
        elif isinstance(rescue_menu_data, list) and len(rescue_menu_data) > 0:
            rescue_menu = rescue_menu_data[0]
        elif isinstance(rescue_menu_data, dict) and "menu_name" in rescue_menu_data:
             rescue_menu = rescue_menu_data
        else:
            print(f"‚ö†Ô∏è Invalid Rescue Menu Data: {rescue_menu_data}")
            rescue_menu = None
            
        # Simpan ke cache
        if rescue_menu:
            _RESCUE_MENU_CACHE = {"hash": items_hash, "menu": rescue_menu}
    
    if rescue_menu:
        menu_name = rescue_menu.get("menu_name", "Tumis Campur Darurat")
        
        # Format pesan WhatsApp untuk Kitchen Admin
        ingredients_str = "\n".join([f"- {i}" for i in rescue_menu.get("ingredients_needed", [])])
        steps_str = "\n".join([f"{idx+1}. {step}" for idx, step in enumerate(rescue_menu.get("cooking_steps", []))])
        
        nut = rescue_menu.get("nutrition", {})
        nutrition_str = f"Kalori: {nut.get('calories', '-')}, Protein: {nut.get('protein', '-')}"
        
        message_body = f"""üö® ALERTA DAPUR: Bahan-bahan berikut hampir expired: {', '.join(all_expiring_names)}!
        
REKOMENDASI AI: Masak '{menu_name}' hari ini untuk menyelamatkan stok!

üõí Bahan Diperlukan:
{ingredients_str}

üë®‚Äçüç≥ Cara Masak:
{steps_str}

üìä Estimasi Nutrisi: {nutrition_str}
Reasoning AI: {rescue_menu.get('reason')}"""

        msg_sppg = {
            "to": "Admin Kitchen SPPG (Broadcast)",
            "role": "SPPG (Kitchen)",
            "type": "URGENT + RECIPE",
            "message": message_body
        }
        notifications.append(msg_sppg)
    
    # Return data terstruktur untuk ditampilkan di Frontend (ExpiryAlerts component)
    return {
        "status": "success", 
        "data": notifications,
        "expiring_items": expiring_items,
        "rescue_menu": rescue_menu
    }

==================================================
FILENAME: .\backend\services\kitchen.py
==================================================
import json
from datetime import datetime, timedelta
from .clients import kolosal_client, supabase
from prompts import (
    get_menu_recommendation_prompt,
    get_meal_expiry_prompt
)

def generate_menu_recommendation(ingredients_list):
    """
    Fungsi untuk minta ide menu ke Claude berdasarkan stok
    """
    print(f"üë®‚Äçüç≥ Mengirim request menu ke Claude untuk: {ingredients_list}")
    
    ingredients_text = ", ".join(ingredients_list)
    
    # Prompt Menu
    prompt = get_menu_recommendation_prompt(ingredients_text)
    
    try:
        response = kolosal_client.chat.completions.create(
            model="Claude Sonnet 4.5",
            messages=[{"role": "user", "content": prompt}],
            max_tokens=1500
        )
        
        content = response.choices[0].message.content
        print(f"ü§ñ Raw AI Response: {content}") # Debug print
        
        # Robust JSON Extraction
        import re
        json_match = re.search(r'\{.*\}|\[.*\]', content, re.DOTALL)
        if json_match:
            cleaned_content = json_match.group(0)
            return json.loads(cleaned_content)
        else:
            # Fallback if no JSON found
            return {"error": "AI did not return valid JSON", "raw": content}
        
    except Exception as e:
        print(f"‚ùå Error Menu AI: {e}")
        return {"error": f"Gagal membuat menu: {str(e)}"}

def calculate_meal_expiry(menu_name: str) -> dict:
    """
    Tanya Claude: Analisis umur simpan & Tips penyimpanan.
    Output: Dictionary lengkap (bukan cuma int).
    """
    print(f"üïí Analisis Safety Food untuk: {menu_name}")
    
    prompt = get_meal_expiry_prompt(menu_name)
    
    try:
        response = kolosal_client.chat.completions.create(
            model="Claude Sonnet 4.5",
            messages=[{"role": "user", "content": prompt}],
            max_tokens=300,
            temperature=0.2
        )
        
        content = response.choices[0].message.content
        cleaned_content = content.replace("```json", "").replace("```", "").strip()
        data = json.loads(cleaned_content)
        
        print(f"‚úÖ Analisis Selesai: {data.get('risk_factor')}")
        return data

    except Exception as e:
        print(f"‚ö†Ô∏è Gagal hitung expiry: {e}")
        # Default fallback yang aman
        return {
            "room_temp_hours": 4,
            "fridge_hours": 12,
            "risk_factor": "Unknown",
            "storage_tips": "Segera konsumsi. Simpan di tempat sejuk dan tertutup.",
            "nutrition": {"calories": "N/A", "protein": "N/A", "carbs": "N/A", "fats": "N/A"}
        }

def cook_meal(menu_name: str, qty_produced: int, ingredients_ids: list):
    """
    Catat produksi masakan:
    1. Kurangi stok bahan baku (deduct stock).
    2. Estimasi nutrisi menu tersebut pakai AI.
    """
    print(f"üç≥ Memasak {menu_name} ({qty_produced} porsi)...")
    
    # 1. Kurangi Stok (Simulasi: Hapus item dari DB)
    # Idealnya kurangi qty, tapi untuk hackathon kita hapus row biar visual
    if ingredients_ids:
        try:
            supabase.table("supplies").delete().in_("id", ingredients_ids).execute()
            print(f"‚úÖ Bahan baku {ingredients_ids} telah digunakan.")
        except Exception as e:
            print(f"‚ùå Gagal update stok: {e}")
            return {"error": "Gagal update stok"}
            
    # 2. Estimasi Nutrisi & Safety pakai AI (Reuse calculate_meal_expiry)
    # Ini lebih efisien karena satu kali panggil dapet expiry + nutrition
    analysis_result = calculate_meal_expiry(menu_name)
    
    # Ambil data nutrisi dari hasil analisis
    nutrition_data = analysis_result.get("nutrition", {"calories": "N/A", "protein": "N/A"})

    # 3. Simpan ke meal_productions
    hours_room = analysis_result.get("room_temp_hours", 4)
    hours_fridge = analysis_result.get("fridge_hours", 12)
    tips_raw = analysis_result.get("storage_tips", "Simpan dengan baik.")
    formatted_tips = f"{tips_raw} (Tahan {hours_fridge} jam jika masuk kulkas)"
    
    data_production = {
        "menu_name": menu_name,
        "qty_produced": qty_produced,
        "expiry_datetime": (datetime.now() + timedelta(hours=hours_room)).isoformat(),
        "status": "fresh",
        "storage_tips": formatted_tips
    }
    
    try:
        supabase.table("meal_productions").insert(data_production).execute()
    except Exception as e:
        print(f"‚ö†Ô∏è Gagal simpan log produksi: {e}")

    return {
        "status": "success",
        "message": f"Berhasil memproduksi {qty_produced} porsi {menu_name}",
        "nutrition_estimate": nutrition_data,
        "safety_analysis": analysis_result
    }

def mark_meal_as_served(meal_id: int):
    """
    Tandai masakan sebagai 'served' (Telah Disajikan).
    Status ini menghentikan monitoring expiry.
    """
    print(f"üçΩÔ∏è Marking meal {meal_id} as served...")
    try:
        response = supabase.table("meal_productions").update({"status": "served"}).eq("id", meal_id).execute()
        return {"status": "success", "data": response.data}
    except Exception as e:
        print(f"‚ùå Gagal update status served: {e}")
        return {"error": str(e)}


==================================================
FILENAME: .\backend\services\logistics.py
==================================================
import math
import random
from .clients import supabase

# --- DATA SPPG (HARDCODED NETWORK) ---
SPPG_LOCATIONS = [
    {"id": 1, "name": "SPPG Jakarta Pusat (Monas)", "address": "Jl. Medan Merdeka Barat, Gambir", "lat": -6.175392, "long": 106.827153, "phone": "0812-3456-7890"},
    {"id": 2, "name": "SPPG Jakarta Selatan (Blok M)", "address": "Jl. Melawai Raya, Kebayoran Baru", "lat": -6.244223, "long": 106.801782, "phone": "0812-9876-5432"},
    {"id": 3, "name": "SPPG Jakarta Barat (Grogol)", "address": "Jl. Kyai Tapa, Grogol Petamburan", "lat": -6.167570, "long": 106.790960, "phone": "0812-1122-3344"},
    {"id": 4, "name": "SPPG Jakarta Timur (Jatinegara)", "address": "Jl. Matraman Raya, Jatinegara", "lat": -6.215116, "long": 106.870434, "phone": "0812-5566-7788"},
    {"id": 5, "name": "SPPG Jakarta Utara (Kelapa Gading)", "address": "Jl. Boulevard Raya, Kelapa Gading", "lat": -6.162331, "long": 106.900220, "phone": "0812-9988-7766"}
]

def haversine_distance(lat1, lon1, lat2, lon2):
    """
    Hitung jarak antara dua titik koordinat (km)
    """
    R = 6371  # Radius bumi dalam km
    dlat = math.radians(lat2 - lat1)
    dlon = math.radians(lon2 - lon1)
    a = math.sin(dlat / 2) * math.sin(dlat / 2) + math.cos(math.radians(lat1)) \
        * math.cos(math.radians(lat2)) * math.sin(dlon / 2) * math.sin(dlon / 2)
    c = 2 * math.atan2(math.sqrt(a), math.sqrt(1 - a))
    return R * c

def search_suppliers(keyword: str, user_lat: float = -6.175392, user_long: float = 106.827153):
    """
    Cari supplier dan urutkan berdasarkan JARAK TERDEKAT.
    Default User Location: Monas (Jakarta Pusat).
    """
    print(f"üîç Mencari supplier '{keyword}' dekat {user_lat}, {user_long}")
    
    try:
        # 1. Ambil data dari DB (Filter nama dulu)
        response = supabase.table("supplies")\
            .select("*")\
            .ilike("item_name", f"%{keyword}%")\
            .execute()
            
        items = response.data
        
        # 2. Inject Dummy Location & Hitung Jarak
        # (Karena data DB belum ada lat/long beneran, kita simulasi di sini biar demo lancar)
        
        results_with_distance = []
        for item in items:
            # 1. Coba ambil Real GPS dari Database
            item_lat = item.get('latitude')
            item_long = item.get('longitude')
            
            # 2. Fallback ke Simulasi jika data GPS kosong (None)
            if item_lat is None or item_long is None:
                # Simulasi koordinat random sekitar Jakarta (¬± 0.05 derajat)
                item_lat = -6.175392 + random.uniform(-0.05, 0.05)
                item_long = 106.827153 + random.uniform(-0.05, 0.05)
            
            dist = haversine_distance(user_lat, user_long, item_lat, item_long)
            
            # Tambahkan info jarak ke item
            item['distance_km'] = round(dist, 1)
            item['location_lat'] = item_lat
            item['location_long'] = item_long
            
            results_with_distance.append(item)
            
        # 3. Urutkan berdasarkan jarak terdekat (Ascending)
        results_with_distance.sort(key=lambda x: x['distance_km'])
        
        return results_with_distance
        
    except Exception as e:
        print(f"‚ùå Error DB Search: {e}")
        return {"error": "Gagal mencari data"}

def search_nearest_sppg(user_lat: float, user_long: float):
    """
    Cari SPPG terdekat dari lokasi user (Vendor).
    """
    results = []
    for sppg in SPPG_LOCATIONS:
        dist = haversine_distance(user_lat, user_long, sppg['lat'], sppg['long'])
        sppg_copy = sppg.copy()
        sppg_copy['distance_km'] = round(dist, 2)
        results.append(sppg_copy)
    
    # Urutkan dari yang terdekat
    results.sort(key=lambda x: x['distance_km'])
    return results


==================================================
FILENAME: .\backend\services\storage.py
==================================================
import time
from fastapi import UploadFile
from .clients import supabase

async def upload_image_to_supabase(file: UploadFile) -> str:
    """
    Upload file gambar ke Supabase Storage dan kembalikan URL publiknya.
    """
    try:
        # 1. Baca file bytes
        file_bytes = await file.read()
        
        # 2. Generate nama file unik (timestamp_filename)
        timestamp = int(time.time())
        filename = f"{timestamp}_{file.filename}"
        
        # 3. Upload ke Supabase Storage (Bucket: 'supply-photos')
        # Pastikan bucket 'supply-photos' sudah dibuat di Supabase Dashboard!
        bucket_name = "supply-photos"
        
        response = supabase.storage.from_(bucket_name).upload(
            path=filename,
            file=file_bytes,
            file_options={"content-type": file.content_type}
        )
        
        # 4. Ambil Public URL
        public_url = supabase.storage.from_(bucket_name).get_public_url(filename)
        
        return public_url
        
    except Exception as e:
        print(f"‚ùå Error Upload Supabase: {e}")
        # Jangan raise error biar flow gak putus, tapi return None atau string kosong
        # Nanti di main.py bisa dicek
        return None


==================================================
FILENAME: .\backend\services\vision.py
==================================================
import base64
import json
from .clients import kolosal_client
from prompts import (
    get_inventory_analysis_prompt,
    get_cooked_meal_analysis_prompt
)

from PIL import Image
import io

def resize_image(image_bytes, max_size=(1024, 1024)):
    """Resize image to avoid huge payloads"""
    try:
        # Check if image_bytes is valid
        if not image_bytes or len(image_bytes) == 0:
            print(f"‚ùå Image bytes is empty or None")
            return None
            
        print(f"üì¶ Image size before resize: {len(image_bytes)} bytes")
        image = Image.open(io.BytesIO(image_bytes))
        
        # Convert to RGB if RGBA (PNG)
        if image.mode == 'RGBA':
            image = image.convert('RGB')
            
        image.thumbnail(max_size, Image.Resampling.LANCZOS)
        
        buffer = io.BytesIO()
        image.save(buffer, format="JPEG", quality=85)
        resized = buffer.getvalue()
        print(f"‚úÖ Image resized: {len(resized)} bytes")
        return resized
    except Exception as e:
        print(f"‚ö†Ô∏è Resize failed ({type(e).__name__}: {e}), using original image")
        print(f"üì¶ Original image size: {len(image_bytes) if image_bytes else 0} bytes")
        return image_bytes

def encode_image_to_base64(image_bytes):
    """Helper buat ubah bytes gambar jadi string base64"""
    # Resize dulu sebelum encode!
    resized_bytes = resize_image(image_bytes)
    return base64.b64encode(resized_bytes).decode('utf-8')

def analyze_market_inventory(image_bytes):
    """
    Claude untuk Deteksi Jenis, Hitung Jumlah, Cek Kualitas.
    """
    
    print("‚ú® Mengirim gambar ke Claude Sonnet 4.5 (All-in-One Analysis)...")
    
    # 1. Siapkan Gambar (Base64 dengan Resize)
    base64_image = encode_image_to_base64(image_bytes)

    # 2. Prompt Claude
    prompt_text = get_inventory_analysis_prompt()

    try:
        # 3. Panggil API Colossal
        response = kolosal_client.chat.completions.create(
            model="Claude Sonnet 4.5", # Pastikan nama model sesuai instruksi Colossal
            messages=[
                {
                    "role": "user",
                    "content": [
                        {"type": "text", "text": prompt_text},
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": f"data:image/jpeg;base64,{base64_image}"
                            }
                        }
                    ]
                }
            ],
            max_tokens=1000,
            temperature=0.1 # Penting! Rendah biar dia teliti ngitung (gak kreatif/halu)
        )
        
        # 4. Parsing Hasil
        content = response.choices[0].message.content
        print(f"ü§ñ Claude Raw Response: {content[:100]}...") # Debug dikit

        # Bersihin markdown kalau ada
        cleaned_content = content.replace("```json", "").replace("```", "").strip()
        parsed_data = json.loads(cleaned_content)
        
        # 5. Format Return
        final_data = []
        for item in parsed_data.get("items", []):
            final_data.append({
                "name": item.get("name"),
                "qty": item.get("qty"),
                "unit": item.get("unit"),
                "freshness": item.get("freshness"),
                "expiry_days": item.get("expiry_days"),
                "note": item.get("visual_reasoning") # Bonus: alesan AI-nya
            })
            
        return {"status": "success", "items": final_data}

    except json.JSONDecodeError:
        print("‚ùå Error: Claude tidak mengembalikan JSON valid.")
        return {"error": "AI Error (Invalid JSON)"}
    except Exception as e:
        print(f"‚ùå Error API: {e}")
        return {"error": f"Gagal analisis: {str(e)}"}

def analyze_cooked_meal(image_bytes):
    """
    VISI KOMPUTER UNTUK MAKANAN JADI (QC FINAL)
    Cek basi/tidak, estimasi gizi visual.
    """
    import re
    
    print("üç± Menganalisis Makanan Jadi...")
    base64_image = encode_image_to_base64(image_bytes)
    
    prompt_text = get_cooked_meal_analysis_prompt()
    
    try:
        response = kolosal_client.chat.completions.create(
            model="Claude Sonnet 4.5",
            messages=[
                {
                    "role": "user",
                    "content": [
                        {"type": "text", "text": prompt_text},
                        {"type": "image_url", "image_url": {"url": f"data:image/jpeg;base64,{base64_image}"}}
                    ]
                }
            ],
            max_tokens=600
        )
        content = response.choices[0].message.content
        print(f"ü§ñ Claude Raw Response (Cooked Meal): {content[:200]}...")
        
        # Clean markdown
        cleaned_content = content.replace("```json", "").replace("```", "").strip()
        
        # Try to extract just the main JSON object (ignore extra fields)
        # Find the first { and try to find the matching }
        try:
            parsed_data = json.loads(cleaned_content)
        except json.JSONDecodeError:
            # If full parse fails, try to extract just what we need
            print("‚ö†Ô∏è Full JSON parse failed, attempting partial extraction...")
            parsed_data = {}
            
            # Extract menu_name
            menu_match = re.search(r'"menu_name"\s*:\s*"([^"]+)"', cleaned_content)
            if menu_match:
                parsed_data["menu_name"] = menu_match.group(1)
            
            # Extract is_safe
            safe_match = re.search(r'"is_safe"\s*:\s*(true|false)', cleaned_content)
            if safe_match:
                parsed_data["is_safe"] = safe_match.group(1) == "true"
            
            # Extract visual_quality
            quality_match = re.search(r'"visual_quality"\s*:\s*"([^"]+)"', cleaned_content)
            if quality_match:
                parsed_data["visual_quality"] = quality_match.group(1)
            
            # Extract nutrition values
            parsed_data["nutrition_estimate"] = {}
            for nutrient in ["calories", "protein", "carbs", "fats", "fat"]:
                pattern = f'"{nutrient}"\\s*:\\s*"([^"]+)"'
                match = re.search(pattern, cleaned_content)
                if match:
                    value_str = match.group(1)
                    # Extract first number from strings like "650-750 kkal" or "25-30 gram"
                    number_match = re.search(r'(\d+)', value_str)
                    if number_match:
                        parsed_data["nutrition_estimate"][nutrient] = number_match.group(1)
        
        # Normalize nutrition values (handle both "fat" and "fats")
        if "nutrition_estimate" in parsed_data:
            nutr = parsed_data["nutrition_estimate"]
            if "fat" in nutr and "fats" not in nutr:
                nutr["fats"] = nutr["fat"]
        
        print(f"‚úÖ Parsed Data: {parsed_data}")
        return parsed_data
    except json.JSONDecodeError as e:
        print(f"‚ùå JSON Decode Error: {e}")
        print(f"‚ùå Content was: {content}")
        return {"error": f"Invalid JSON: {str(e)}"}
    except Exception as e:
        print(f"‚ùå API Error: {e}")
        return {"error": str(e)}

==================================================
FILENAME: .\backend\services\__init__.py
==================================================


==================================================
FILENAME: .\frontend_next\app\globals.css
==================================================
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

:root {
  /* Updated color scheme for Bekal Bangsa - Primary Green #2D7A3E, Secondary Amber #D97E1A */
  --background: oklch(0.98 0 0);
  --foreground: oklch(0.13 0 0); /* #212121 */
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.13 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.13 0 0);
  --primary: oklch(0.45 0.13 142); /* #2D7A3E - Emerald Green */
  --primary-foreground: oklch(0.98 0 0);
  --secondary: oklch(0.55 0.18 50); /* #D97E1A - Amber */
  --secondary-foreground: oklch(0.98 0 0);
  --muted: oklch(0.93 0 0);
  --muted-foreground: oklch(0.46 0 0); /* #757575 */
  --accent: oklch(0.55 0.18 50); /* Amber for accents */
  --accent-foreground: oklch(0.98 0 0);
  --destructive: oklch(0.577 0.245 27.325); /* #EF4444 - Red */
  --destructive-foreground: oklch(0.98 0 0);
  --border: oklch(0.92 0 0);
  --input: oklch(0.96 0 0);
  --ring: oklch(0.45 0.13 142);
  /* Status colors */
  --success: oklch(0.57 0.13 142); /* #10B981 - Green */
  --warning: oklch(0.62 0.18 50); /* #F59E0B - Amber */
  --danger: oklch(0.577 0.245 27.325); /* #EF4444 - Red */
  --chart-1: oklch(0.45 0.13 142); /* Green */
  --chart-2: oklch(0.55 0.18 50); /* Amber */
  --chart-3: oklch(0.57 0.13 142); /* Success green */
  --chart-4: oklch(0.62 0.18 50); /* Warning amber */
  --chart-5: oklch(0.577 0.245 27.325); /* Danger red */
  --radius: 0.625rem;
  --sidebar: oklch(0.45 0.13 142);
  --sidebar-foreground: oklch(0.98 0 0);
  --sidebar-primary: oklch(0.55 0.18 50);
  --sidebar-primary-foreground: oklch(0.98 0 0);
  --sidebar-accent: oklch(0.55 0.18 50);
  --sidebar-accent-foreground: oklch(0.98 0 0);
  --sidebar-border: oklch(0.5 0.08 142);
  --sidebar-ring: oklch(0.55 0.18 50);
}

.dark {
  --background: oklch(0.12 0 0);
  --foreground: oklch(0.95 0 0);
  --card: oklch(0.18 0 0);
  --card-foreground: oklch(0.95 0 0);
  --popover: oklch(0.18 0 0);
  --popover-foreground: oklch(0.95 0 0);
  --primary: oklch(0.55 0.15 142);
  --primary-foreground: oklch(0.12 0 0);
  --secondary: oklch(0.62 0.18 50);
  --secondary-foreground: oklch(0.12 0 0);
  --muted: oklch(0.25 0 0);
  --muted-foreground: oklch(0.7 0 0);
  --accent: oklch(0.62 0.18 50);
  --accent-foreground: oklch(0.12 0 0);
  --destructive: oklch(0.62 0.18 50);
  --destructive-foreground: oklch(0.95 0 0);
  --border: oklch(0.25 0 0);
  --input: oklch(0.25 0 0);
  --ring: oklch(0.55 0.18 50);
  --success: oklch(0.62 0.15 142);
  --warning: oklch(0.68 0.18 50);
  --danger: oklch(0.62 0.18 27);
  --chart-1: oklch(0.55 0.15 142);
  --chart-2: oklch(0.62 0.18 50);
  --chart-3: oklch(0.62 0.15 142);
  --chart-4: oklch(0.68 0.18 50);
  --chart-5: oklch(0.62 0.18 27);
  --sidebar: oklch(0.15 0 0);
  --sidebar-foreground: oklch(0.95 0 0);
  --sidebar-primary: oklch(0.62 0.18 50);
  --sidebar-primary-foreground: oklch(0.95 0 0);
  --sidebar-accent: oklch(0.62 0.18 50);
  --sidebar-accent-foreground: oklch(0.95 0 0);
  --sidebar-border: oklch(0.25 0 0);
  --sidebar-ring: oklch(0.62 0.18 50);
}

@theme inline {
  --font-sans: "Geist", "Geist Fallback";
  --font-mono: "Geist Mono", "Geist Mono Fallback";
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-success: var(--success);
  --color-warning: var(--warning);
  --color-danger: var(--danger);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}


==================================================
FILENAME: .\frontend_next\app\layout.tsx
==================================================
import type React from "react"
import type { Metadata } from "next"
import { Geist, Geist_Mono } from "next/font/google"
import { Analytics } from "@vercel/analytics/next"
import "./globals.css"

const _geist = Geist({ subsets: ["latin"] })
const _geistMono = Geist_Mono({ subsets: ["latin"] })

export const metadata: Metadata = {
  title: "Bekal Bangsa - Smart Food Supply Chain",
  description: "Platform untuk UMKM dan SPPG dalam ekosistem pangan lokal",
  generator: "v0.app",
  icons: {
    icon: [
      {
        url: "/icon-light-32x32.png",
        media: "(prefers-color-scheme: light)",
      },
      {
        url: "/icon-dark-32x32.png",
        media: "(prefers-color-scheme: dark)",
      },
      {
        url: "/icon.svg",
        type: "image/svg+xml",
      },
    ],
    apple: "/apple-icon.png",
  },
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en">
      <body className={`font-sans antialiased`}>
        {children}
        <Analytics />
      </body>
    </html>
  )
}


==================================================
FILENAME: .\frontend_next\app\page.tsx
==================================================
"use client"

import { useState } from "react"
import RoleSelector from "@/components/role-selector"
import VendorDashboard from "@/components/vendor/vendor-dashboard"
import KitchenDashboard from "@/components/kitchen/kitchen-dashboard"
import ErrorBoundary from "@/components/shared/error-boundary"

export default function Home() {
  const [userRole, setUserRole] = useState<"vendor" | "kitchen" | null>(null)

  if (!userRole) {
    return <RoleSelector onSelectRole={setUserRole} />
  }

  return (
    <ErrorBoundary>
      <main className="min-h-screen bg-background">
        {userRole === "vendor" ? (
          <VendorDashboard onLogout={() => setUserRole(null)} />
        ) : (
          <KitchenDashboard onLogout={() => setUserRole(null)} />
        )}
      </main>
    </ErrorBoundary>
  )
}


==================================================
FILENAME: .\frontend_next\components\role-selector.tsx
==================================================
"use client"

import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { ShoppingCart, UtensilsCrossed, Leaf } from "lucide-react"

interface RoleSelectorProps {
  onSelectRole: (role: "vendor" | "kitchen") => void
}

export default function RoleSelector({ onSelectRole }: RoleSelectorProps) {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-primary via-emerald-600 to-primary p-4">
      <div className="w-full max-w-6xl space-y-8">
        {/* Header */}
        <div className="text-center space-y-2">
          <div className="flex items-center justify-center gap-2 mb-4">
            <Leaf className="w-8 h-8 text-white" />
            <h1 className="text-5xl md:text-6xl font-bold text-white">Bekal Bangsa</h1>
            <Leaf className="w-8 h-8 text-white" />
          </div>
          <p className="text-xl md:text-2xl text-emerald-50 font-medium">Dari Lahan Lokal, Jadi Bekal Masa Depan</p>
          <p className="text-emerald-100 text-sm md:text-base">Platform Cerdas untuk Ekosistem Pangan Lokal</p>
        </div>

        {/* Role Selection */}
        <div className="grid md:grid-cols-2 gap-8 md:gap-6">
          {/* Vendor Card */}
          <Card
            className="border-0 shadow-xl hover:shadow-2xl transition-all cursor-pointer group overflow-hidden"
            onClick={() => onSelectRole("vendor")}
          >
            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-secondary to-amber-400"></div>
            <CardHeader className="text-center pb-4">
              <div className="flex justify-center mb-6">
                <div className="bg-gradient-to-br from-secondary/20 to-amber-100 p-6 rounded-2xl group-hover:scale-110 transition-transform">
                  <ShoppingCart className="w-16 h-16 text-secondary" />
                </div>
              </div>
              <CardTitle className="text-3xl text-foreground">UMKM Vendor</CardTitle>
              <CardDescription className="text-base mt-2">Jual & Donasikan Persediaan Makanan</CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              <ul className="space-y-3">
                <li className="flex gap-3 items-start">
                  <span className="text-secondary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Ambil foto dengan AI atau upload file</span>
                </li>
                <li className="flex gap-3 items-start">
                  <span className="text-secondary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Deteksi lokasi otomatis dengan GPS</span>
                </li>
                <li className="flex gap-3 items-start">
                  <span className="text-secondary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Cari SPPG terdekat berdasarkan jarak</span>
                </li>
                <li className="flex gap-3 items-start">
                  <span className="text-secondary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Pantau status pesanan real-time</span>
                </li>
              </ul>
              <Button className="w-full bg-secondary hover:bg-secondary/90 text-white font-semibold py-6 text-base rounded-lg">
                Masuk Sebagai Vendor
              </Button>
            </CardContent>
          </Card>

          {/* Kitchen Card */}
          <Card
            className="border-0 shadow-xl hover:shadow-2xl transition-all cursor-pointer group overflow-hidden"
            onClick={() => onSelectRole("kitchen")}
          >
            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-emerald-400"></div>
            <CardHeader className="text-center pb-4">
              <div className="flex justify-center mb-6">
                <div className="bg-gradient-to-br from-primary/20 to-emerald-100 p-6 rounded-2xl group-hover:scale-110 transition-transform">
                  <UtensilsCrossed className="w-16 h-16 text-primary" />
                </div>
              </div>
              <CardTitle className="text-3xl text-foreground">Kitchen Admin</CardTitle>
              <CardDescription className="text-base mt-2">Kelola Persediaan & Produksi Makanan</CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              <ul className="space-y-3">
                <li className="flex gap-3 items-start">
                  <span className="text-primary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Dashboard persediaan dari semua vendor</span>
                </li>
                <li className="flex gap-3 items-start">
                  <span className="text-primary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Rekomendasi menu berbasis AI</span>
                </li>
                <li className="flex gap-3 items-start">
                  <span className="text-primary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Pantau produksi dengan nutrisi otomatis</span>
                </li>
                <li className="flex gap-3 items-start">
                  <span className="text-primary font-bold text-lg mt-0.5">‚úì</span>
                  <span className="text-sm text-foreground/80">Monitor IoT suhu & kelembaban real-time</span>
                </li>
              </ul>
              <Button className="w-full bg-primary hover:bg-primary/90 text-white font-semibold py-6 text-base rounded-lg">
                Masuk Sebagai Kitchen Admin
              </Button>
            </CardContent>
          </Card>
        </div>

        {/* Footer Info */}
        <div className="text-center text-emerald-50 text-sm">
          <p>Platform untuk Program Makan Bergizi Gratis yang lebih baik</p>
        </div>
      </div>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\theme-provider.tsx
==================================================
'use client'

import * as React from 'react'
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from 'next-themes'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}


==================================================
FILENAME: .\frontend_next\components\common\inventory-list.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import {
    Table,
    TableBody,
    TableCell,
    TableHead,
    TableHeader,
    TableRow,
} from "@/components/ui/table"
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Package, AlertTriangle, CheckCircle } from "lucide-react"

interface InventoryItem {
    id: number
    item_name: string
    quantity: number
    unit: string
    expiry_days: number
    owner_name?: string
}

interface InventoryListProps {
    role: "vendor" | "kitchen"
}

export default function InventoryList({ role }: InventoryListProps) {
    const [items, setItems] = useState<InventoryItem[]>([])
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        const fetchInventory = async () => {
            try {
                // In a real app, we might filter by owner_id for vendor
                // For now, we fetch all supplies
                const response = await fetch("/api/supplies")
                const data = await response.json()

                if (Array.isArray(data)) {
                    setItems(data)
                }
            } catch (error) {
                console.error("Error fetching inventory:", error)
            } finally {
                setLoading(false)
            }
        }

        fetchInventory()
    }, [])

    const getStatusColor = (days: number) => {
        if (days <= 2) return "destructive"
        if (days <= 5) return "warning"
        return "success"
    }

    const getStatusLabel = (days: number) => {
        if (days <= 2) return "Critical"
        if (days <= 5) return "Warning"
        return "Fresh"
    }

    if (loading) {
        return <div className="p-4 text-center text-muted-foreground">Memuat data inventaris...</div>
    }

    return (
        <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
            <CardHeader className="bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-100 py-6">
                <CardTitle className="flex items-center gap-2 text-blue-800">
                    <Package className="w-5 h-5" />
                    Daftar Inventaris {role === "vendor" ? "Saya" : "Gudang"}
                </CardTitle>
                <CardDescription className="text-blue-600">
                    Status stok dan masa kadaluarsa terkini
                </CardDescription>
            </CardHeader>
            <CardContent className="p-0">
                <Table>
                    <TableHeader className="bg-gray-50/50">
                        <TableRow>
                            <TableHead className="w-[200px]">Nama Barang</TableHead>
                            <TableHead>Jumlah</TableHead>
                            <TableHead>Satuan</TableHead>
                            <TableHead>Sisa Hari</TableHead>
                            <TableHead className="text-right">Status</TableHead>
                        </TableRow>
                    </TableHeader>
                    <TableBody>
                        {items.length === 0 ? (
                            <TableRow>
                                <TableCell colSpan={5} className="text-center py-8 text-muted-foreground">
                                    Belum ada data inventaris
                                </TableCell>
                            </TableRow>
                        ) : (
                            items.map((item) => (
                                <TableRow key={item.id} className="hover:bg-gray-50/50 transition-colors">
                                    <TableCell className="font-medium text-foreground">
                                        {item.item_name}
                                        {role === "kitchen" && item.owner_name && (
                                            <span className="block text-xs text-muted-foreground font-normal">
                                                Dari: {item.owner_name}
                                            </span>
                                        )}
                                    </TableCell>
                                    <TableCell>{item.quantity}</TableCell>
                                    <TableCell className="text-muted-foreground">{item.unit}</TableCell>
                                    <TableCell>
                                        <div className="flex items-center gap-2">
                                            <span className={`font-medium ${item.expiry_days <= 2 ? "text-red-600" : "text-foreground"}`}>
                                                {item.expiry_days} Hari
                                            </span>
                                        </div>
                                    </TableCell>
                                    <TableCell className="text-right">
                                        <Badge
                                            variant={
                                                item.expiry_days <= 2 ? "destructive" :
                                                    item.expiry_days <= 5 ? "secondary" : "outline"
                                            }
                                            className={
                                                item.expiry_days > 5 ? "bg-green-100 text-green-700 hover:bg-green-200 border-green-200" : ""
                                            }
                                        >
                                            {item.expiry_days <= 2 && <AlertTriangle className="w-3 h-3 mr-1" />}
                                            {item.expiry_days > 5 && <CheckCircle className="w-3 h-3 mr-1" />}
                                            {getStatusLabel(item.expiry_days)}
                                        </Badge>
                                    </TableCell>
                                </TableRow>
                            ))
                        )}
                    </TableBody>
                </Table>
            </CardContent>
        </Card>
    )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\cooking-production.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Badge } from "@/components/ui/badge"
import { Checkbox } from "@/components/ui/checkbox"
import { Flame, Clock, AlertTriangle, CheckCircle } from "lucide-react"

interface InventoryItem {
  id: number
  item_name: string
  quantity: number
  unit: string
}

interface CookingSession {
  id: number
  menu_name: string
  qty_produced: number
  expiry_datetime: string
  status: string
  storage_tips: string
  nutrition_estimate: any
}

export default function CookingProduction() {
  const [menuName, setMenuName] = useState("")
  const [quantity, setQuantity] = useState("")
  const [inventory, setInventory] = useState<InventoryItem[]>([])
  const [selectedIngredients, setSelectedIngredients] = useState<number[]>([])
  const [sessions, setSessions] = useState<CookingSession[]>([])
  const [loading, setLoading] = useState(false)
  const [now, setNow] = useState(new Date())

  // 1. Fetch Inventory & History on Mount
  useEffect(() => {
    fetchInventory()
    fetchHistory()

    // Update timer every minute
    const timer = setInterval(() => setNow(new Date()), 60000)
    return () => clearInterval(timer)
  }, [])

  const fetchInventory = async () => {
    try {
      const res = await fetch("/api/supplies")
      const data = await res.json()
      if (Array.isArray(data)) setInventory(data)
    } catch (e) {
      console.error("Failed to fetch inventory", e)
    }
  }

  const fetchHistory = async () => {
    try {
      const res = await fetch("/api/kitchen/meals")
      const data = await res.json()
      if (Array.isArray(data)) setSessions(data)
    } catch (e) {
      console.error("Failed to fetch history", e)
    }
  }

  const handleStartCooking = async () => {
    if (!menuName || !quantity) return

    setLoading(true)
    try {
      const response = await fetch("/api/kitchen/cook", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          menu_name: menuName,
          qty_produced: Number.parseInt(quantity),
          ingredients_ids: selectedIngredients,
        }),
      })
      const data = await response.json()
      console.log("Cook response:", data)

      // Refresh history to show new meal
      fetchHistory()
      fetchInventory() // Refresh inventory (stock deducted)

      // Reset form
      setMenuName("")
      setQuantity("")
      setSelectedIngredients([])
    } catch (error) {
      console.error("Error starting cooking:", error)
      alert("Gagal memproses masakan")
    } finally {
      setLoading(false)
    }
  }

  const toggleIngredient = (id: number) => {
    setSelectedIngredients(prev =>
      prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]
    )
  }

  const handleServeMeal = async (id: number) => {
    try {
      const response = await fetch(`/api/kitchen/meals/${id}/serve`, {
        method: "PUT",
      })
      const data = await response.json()
      if (data.status === "success") {
        fetchHistory() // Refresh list
      }
    } catch (error) {
      console.error("Error serving meal:", error)
      alert("Gagal update status")
    }
  }

  // Helper: Calculate Time Left
  const getTimeLeft = (expiryStr: string) => {
    const expiry = new Date(expiryStr)
    const diff = expiry.getTime() - now.getTime()

    if (diff <= 0) return "Expired"

    const hours = Math.floor(diff / (1000 * 60 * 60))
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60))

    return `${hours}j ${minutes}m`
  }

  const isCritical = (expiryStr: string) => {
    const expiry = new Date(expiryStr)
    const diff = expiry.getTime() - now.getTime()
    return diff < (1000 * 60 * 60) // Less than 1 hour
  }

  return (
    <div className="grid md:grid-cols-2 gap-6">
      {/* Left: Cooking Form */}
      <Card className="h-fit">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Flame className="w-5 h-5 text-orange-500" />
            Dapur Produksi
          </CardTitle>
          <CardDescription>Masak menu baru dan kurangi stok otomatis</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-2">
            <Label>Nama Menu</Label>
            <Input
              placeholder="Contoh: Nasi Goreng Spesial"
              value={menuName}
              onChange={(e) => setMenuName(e.target.value)}
            />
          </div>

          <div className="space-y-2">
            <Label>Jumlah Porsi</Label>
            <Input
              type="number"
              placeholder="0"
              value={quantity}
              onChange={(e) => setQuantity(e.target.value)}
            />
          </div>

          <div className="space-y-2">
            <Label>Pilih Bahan Baku (Opsional)</Label>
            <div className="border rounded-md p-3 h-48 overflow-y-auto space-y-2 bg-gray-50">
              {inventory.length === 0 ? (
                <p className="text-xs text-muted-foreground text-center py-4">Stok kosong</p>
              ) : (
                inventory.map(item => (
                  <div key={item.id} className="flex items-center space-x-2">
                    <Checkbox
                      id={`ing-${item.id}`}
                      checked={selectedIngredients.includes(item.id)}
                      onCheckedChange={() => toggleIngredient(item.id)}
                    />
                    <label
                      htmlFor={`ing-${item.id}`}
                      className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                    >
                      {item.item_name} ({item.quantity} {item.unit})
                    </label>
                  </div>
                ))
              )}
            </div>
            <p className="text-xs text-muted-foreground">
              *Bahan yang dipilih akan dikurangi dari stok
            </p>
          </div>

          <Button
            onClick={handleStartCooking}
            disabled={!menuName || !quantity || loading}
            className="w-full bg-orange-600 hover:bg-orange-700 text-white"
          >
            {loading ? "Sedang Memasak..." : "Mulai Masak"}
          </Button>
        </CardContent>
      </Card>

      {/* Right: Active Sessions (Real DB) */}
      <div className="space-y-4">
        <h3 className="font-semibold text-lg flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Riwayat & Monitoring
        </h3>

        {sessions.filter(s => s.status !== 'served').length === 0 ? (
          <div className="text-center py-12 border-2 border-dashed rounded-lg text-muted-foreground">
            Belum ada aktifitas memasak hari ini
          </div>
        ) : (
          sessions.filter(s => s.status !== 'served').map((session) => {
            const timeLeft = getTimeLeft(session.expiry_datetime)
            const critical = isCritical(session.expiry_datetime)
            const expired = timeLeft === "Expired"

            return (
              <Card key={session.id} className={`border-l-4 ${expired ? 'border-l-red-500 bg-red-50' : critical ? 'border-l-orange-500' : 'border-l-green-500'}`}>
                <CardContent className="p-4">
                  <div className="flex justify-between items-start mb-2">
                    <div>
                      <h4 className="font-bold text-lg">{session.menu_name}</h4>
                      <p className="text-sm text-muted-foreground">{session.qty_produced} porsi</p>
                    </div>
                    <Badge variant={expired ? "destructive" : critical ? "secondary" : "outline"} className={!expired && !critical ? "bg-green-100 text-green-800 border-green-200" : ""}>
                      {expired ? "BASI" : critical ? "SEGERA HABISKAN" : "FRESH"}
                    </Badge>
                  </div>

                  <div className="grid grid-cols-2 gap-4 text-sm mt-3">
                    <div className="bg-white/50 p-2 rounded border">
                      <p className="text-xs text-muted-foreground">Sisa Waktu (Suhu Ruang)</p>
                      <p className={`font-mono font-bold text-lg ${critical || expired ? 'text-red-600' : 'text-green-600'}`}>
                        {timeLeft}
                      </p>
                    </div>
                    <div className="bg-white/50 p-2 rounded border">
                      <p className="text-xs text-muted-foreground">Tips Penyimpanan</p>
                      <p className="text-xs leading-tight mt-1">{session.storage_tips}</p>
                    </div>
                  </div>

                  <div className="mt-4 pt-3 border-t flex justify-end">
                    <Button
                      size="sm"
                      variant="outline"
                      className="text-green-600 border-green-200 hover:bg-green-50"
                      onClick={() => handleServeMeal(session.id)}
                    >
                      <CheckCircle className="w-4 h-4 mr-2" />
                      Telah Disajikan
                    </Button>
                  </div>
                </CardContent>
              </Card>
            )
          })
        )}
      </div>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\dashboard-overview.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Warehouse, AlertTriangle, TrendingUp, Clock } from "lucide-react"
import ExpiryAlerts from "./expiry-alerts"

interface DashboardStats {
  total_supplies: number
  expiring_soon: number
  cooked_today: number
  avg_temp: number
}

export default function DashboardOverview() {
  const [stats, setStats] = useState<DashboardStats | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchStats = async () => {
      try {
        // Simulate getting stats - in real app would fetch from backend
        setStats({
          total_supplies: 156,
          expiring_soon: 12,
          cooked_today: 48,
          avg_temp: 2.5,
        })
      } catch (error) {
        console.error("Error fetching stats:", error)
      } finally {
        setLoading(false)
      }
    }

    fetchStats()
  }, [])

  if (loading || !stats) {
    return <p className="text-center text-muted-foreground">Memuat...</p>
  }

  return (
    <div className="space-y-6">
      {/* Stats Grid */}
      <div className="grid md:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="pb-3">
            <CardTitle className="text-sm font-medium flex items-center gap-2">
              <Warehouse className="w-4 h-4 text-accent" />
              Total Persediaan
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.total_supplies}</div>
            <p className="text-xs text-muted-foreground">unit bahan</p>
          </CardContent>
        </Card>

        <Card className="border-l-4 border-l-red-500">
          <CardHeader className="pb-3">
            <CardTitle className="text-sm font-medium flex items-center gap-2">
              <AlertTriangle className="w-4 h-4 text-red-500" />
              Akan Kadaluarsa
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-red-600">{stats.expiring_soon}</div>
            <p className="text-xs text-muted-foreground">dalam 3 hari</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-3">
            <CardTitle className="text-sm font-medium flex items-center gap-2">
              <TrendingUp className="w-4 h-4 text-green-500" />
              Diproduksi Hari Ini
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.cooked_today}</div>
            <p className="text-xs text-muted-foreground">porsi</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-3">
            <CardTitle className="text-sm font-medium flex items-center gap-2">
              <Clock className="w-4 h-4 text-blue-500" />
              Suhu Rata-rata
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.avg_temp}¬∞C</div>
            <p className="text-xs text-muted-foreground">dalam range ideal</p>
          </CardContent>
        </Card>
      </div>

      {/* Expiry Alerts Section */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <AlertTriangle className="w-5 h-5 text-red-500" />
            Notifikasi Penting
          </CardTitle>
          <CardDescription>Item yang akan segera kadaluarsa</CardDescription>
        </CardHeader>
        <CardContent>
          <ExpiryAlerts />
        </CardContent>
      </Card>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\expiry-alerts.tsx
==================================================
import { useState, useEffect } from "react"
import { AlertTriangle, Bell, X, ChefHat, Flame, ArrowRight } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog"

interface ExpiryAlert {
  id: number
  item_name: string
  days_left: number
  quantity: number
  unit: string
  urgency: "critical" | "warning" | "info"
}

interface RescueMenu {
  menu_name: string
  description: string
  ingredients_needed: string[]
  cooking_steps: string[]
  nutrition: {
    calories: string
    protein: string
  }
  reason: string
}

export default function ExpiryAlerts() {
  const [alerts, setAlerts] = useState<ExpiryAlert[]>([])
  const [rescueMenu, setRescueMenu] = useState<RescueMenu | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchAlerts = async () => {
      try {
        const response = await fetch("/api/notifications/trigger", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
        })
        const data = await response.json()
        console.log("[v0] Alerts Data:", data)

        if (data.expiring_items) {
          const formattedAlerts = data.expiring_items.map((item: any, idx: number) => ({
            id: idx,
            item_name: item.item_name || item.name, // Handle inconsistent naming
            days_left: item.expiry_days,
            quantity: item.quantity || item.qty,
            unit: item.unit,
            urgency: item.expiry_days <= 1 ? "critical" : item.expiry_days <= 3 ? "warning" : "info",
          }))
          setAlerts(formattedAlerts)
        }

        if (data.rescue_menu) {
          setRescueMenu(data.rescue_menu)
        }
      } catch (error) {
        console.error("Error fetching alerts:", error)
        // Optional: Set UI state to show error if needed, but for alerts maybe just log it
      } finally {
        setLoading(false)
      }
    }

    fetchAlerts()
    const interval = setInterval(fetchAlerts, 30000) // Update every 30 seconds
    return () => clearInterval(interval)
  }, [])

  const dismissAlert = (id: number) => {
    setAlerts(alerts.filter((a) => a.id !== id))
  }

  const getAlertColor = (urgency: string) => {
    switch (urgency) {
      case "critical":
        return "border-l-4 border-l-red-500 bg-red-50"
      case "warning":
        return "border-l-4 border-l-yellow-500 bg-yellow-50"
      case "info":
        return "border-l-4 border-l-blue-500 bg-blue-50"
      default:
        return ""
    }
  }

  const getUrgencyText = (urgency: string) => {
    switch (urgency) {
      case "critical":
        return "URGENT - Akan kadaluarsa hari ini"
      case "warning":
        return "PERHATIAN - Akan kadaluarsa segera"
      case "info":
        return "INFO - Perhatian tanggal kadaluarsa"
      default:
        return ""
    }
  }

  if (loading) {
    return <p className="text-center text-muted-foreground text-sm py-2">Memuat notifikasi...</p>
  }

  if (alerts.length === 0) {
    return (
      <Alert className="bg-green-50 border-green-200">
        <Bell className="h-4 w-4 text-green-600" />
        <AlertDescription className="text-green-800">Tidak ada item yang akan segera kadaluarsa</AlertDescription>
      </Alert>
    )
  }

  return (
    <div className="space-y-4">
      <div className="space-y-3">
        {alerts.map((alert) => (
          <div
            key={alert.id}
            className={`rounded-lg p-4 flex justify-between items-start gap-4 ${getAlertColor(alert.urgency)}`}
          >
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-2">
                <AlertTriangle className="w-4 h-4" />
                <span className="font-semibold text-sm">{getUrgencyText(alert.urgency)}</span>
              </div>
              <p className="font-semibold text-foreground mb-1">{alert.item_name}</p>
              <p className="text-sm text-muted-foreground">
                {alert.quantity} {alert.unit} ‚Ä¢ {alert.days_left} hari tersisa
              </p>
            </div>
            <button
              onClick={() => dismissAlert(alert.id)}
              className="flex-shrink-0 hover:bg-black/10 rounded p-1 transition-colors"
            >
              <X className="w-4 h-4" />
            </button>
          </div>
        ))}
      </div>

      {/* Rescue Menu Recommendation */}
      {rescueMenu && (
        <Dialog>
          <DialogTrigger asChild>
            <Button className="w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white border-0 shadow-md">
              <ChefHat className="w-4 h-4 mr-2" />
              Lihat Rekomendasi Masakan Penyelamat
              <ArrowRight className="w-4 h-4 ml-2" />
            </Button>
          </DialogTrigger>
          <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
            <DialogHeader>
              <DialogTitle className="flex items-center gap-2 text-xl">
                <Flame className="w-5 h-5 text-orange-500" />
                Rekomendasi Penyelamatan Stok
              </DialogTitle>
              <DialogDescription>
                Gunakan bahan-bahan yang akan kadaluarsa untuk membuat menu ini.
              </DialogDescription>
            </DialogHeader>

            <div className="space-y-6 py-4">
              <div className="bg-orange-50 border border-orange-100 rounded-lg p-4">
                <h3 className="font-bold text-lg text-orange-800 mb-1">{rescueMenu.menu_name}</h3>
                <p className="text-orange-700 text-sm">{rescueMenu.description}</p>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <h4 className="font-semibold mb-3 flex items-center gap-2">
                    <span className="bg-primary/10 p-1 rounded text-primary text-xs">1</span>
                    Bahan-bahan
                  </h4>
                  <ul className="space-y-2 text-sm text-muted-foreground">
                    {rescueMenu.ingredients_needed.map((ing, i) => (
                      <li key={i} className="flex items-start gap-2">
                        <span className="w-1.5 h-1.5 rounded-full bg-primary mt-1.5" />
                        {ing}
                      </li>
                    ))}
                  </ul>
                </div>

                <div>
                  <h4 className="font-semibold mb-3 flex items-center gap-2">
                    <span className="bg-primary/10 p-1 rounded text-primary text-xs">2</span>
                    Nutrisi
                  </h4>
                  <div className="bg-gray-50 p-4 rounded-lg space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-muted-foreground">Kalori</span>
                      <span className="font-medium">{rescueMenu.nutrition.calories}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-muted-foreground">Protein</span>
                      <span className="font-medium">{rescueMenu.nutrition.protein}</span>
                    </div>
                  </div>
                </div>
              </div>

              <div>
                <h4 className="font-semibold mb-3 flex items-center gap-2">
                  <span className="bg-primary/10 p-1 rounded text-primary text-xs">3</span>
                  Cara Memasak
                </h4>
                <div className="space-y-3">
                  {rescueMenu.cooking_steps.map((step, i) => (
                    <div key={i} className="flex gap-3 text-sm">
                      <span className="font-bold text-muted-foreground w-5">{i + 1}.</span>
                      <p className="text-foreground">{step}</p>
                    </div>
                  ))}
                </div>
              </div>

              <Button className="w-full" size="lg">
                <ChefHat className="w-4 h-4 mr-2" />
                Mulai Masak Sekarang
              </Button>
            </div>
          </DialogContent>
        </Dialog>
      )}
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\iot-monitoring.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  AreaChart,
  Area,
} from "recharts"
import { Thermometer, Droplets, AlertTriangle } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"

interface IoTLog {
  timestamp: string
  temperature: number
  humidity: number
}

export default function IoTMonitoring() {
  const [logs, setLogs] = useState<IoTLog[]>([])
  const [loading, setLoading] = useState(true)
  const [autoRefresh, setAutoRefresh] = useState(true)

  useEffect(() => {
    const fetchLogs = async () => {
      try {
        const response = await fetch("/api/iot/logs")
        const data = await response.json()
        console.log("[v0] IoT logs:", data)

        // Backend returns a list directly: [{...}, {...}]
        if (Array.isArray(data)) {
          const formattedLogs = data.map((log: any) => ({
            timestamp: new Date(log.created_at).toLocaleTimeString(),
            temperature: log.temperature,
            humidity: log.humidity,
          }))
          // Reverse to show oldest to newest on chart if needed, or just slice
          // Usually charts want left-to-right time, so if API returns desc, we might need to reverse
          setLogs(formattedLogs.reverse().slice(-20))
        }
      } catch (error) {
        console.error("Error fetching IoT logs:", error)
      } finally {
        setLoading(false)
      }
    }

    fetchLogs()

    if (autoRefresh) {
      const interval = setInterval(fetchLogs, 5000)
      return () => clearInterval(interval)
    }
  }, [autoRefresh])

  const latestTemp = logs.length > 0 ? logs[logs.length - 1].temperature : 0
  const latestHumidity = logs.length > 0 ? logs[logs.length - 1].humidity : 0
  const isAlertTemp = latestTemp > 4 || latestTemp < 0 // Cold storage should be 0-4¬∞C
  const isAlertHumidity = latestHumidity > 80 || latestHumidity < 40

  if (loading) {
    return (
      <Card>
        <CardContent className="pt-6">
          <p className="text-center text-muted-foreground">Memuat data sensor...</p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      {/* Current Status */}
      <div className="grid md:grid-cols-2 gap-4">
        <Card className={isAlertTemp ? "border-l-4 border-l-red-500" : ""}>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Thermometer className="w-5 h-5 text-red-500" />
              Suhu
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-4xl font-bold text-foreground mb-2">{latestTemp.toFixed(1)}¬∞C</div>
            <p className="text-sm text-muted-foreground">
              {isAlertTemp ? "‚ö†Ô∏è Di luar rentang ideal (0-4¬∞C)" : "‚úì Dalam rentang ideal"}
            </p>
          </CardContent>
        </Card>

        <Card className={isAlertHumidity ? "border-l-4 border-l-yellow-500" : ""}>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Droplets className="w-5 h-5 text-blue-500" />
              Kelembaban
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-4xl font-bold text-foreground mb-2">{latestHumidity.toFixed(1)}%</div>
            <p className="text-sm text-muted-foreground">
              {isAlertHumidity ? "‚ö†Ô∏è Di luar rentang ideal (40-80%)" : "‚úì Dalam rentang ideal"}
            </p>
          </CardContent>
        </Card>
      </div>

      {/* Alerts */}
      {(isAlertTemp || isAlertHumidity) && (
        <Alert className="border-l-4 border-l-red-500 bg-red-50">
          <AlertTriangle className="h-4 w-4 text-red-500" />
          <AlertDescription className="text-red-800">
            Kondisi penyimpanan tidak optimal! Segera periksa sistem pendingin.
          </AlertDescription>
        </Alert>
      )}

      {/* Charts */}
      {logs.length > 0 && (
        <>
          <Card>
            <CardHeader>
              <CardTitle>Grafik Suhu (Last 20 min)</CardTitle>
              <CardDescription>Pantau tren suhu penyimpanan</CardDescription>
            </CardHeader>
            <CardContent>
              <ResponsiveContainer width="100%" height={300}>
                <AreaChart data={logs}>
                  <defs>
                    <linearGradient id="colorTemp" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="5%" stopColor="hsl(var(--chart-1))" stopOpacity={0.8} />
                      <stop offset="95%" stopColor="hsl(var(--chart-1))" stopOpacity={0.1} />
                    </linearGradient>
                  </defs>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="timestamp" />
                  <YAxis domain={[0, 10]} />
                  <Tooltip />
                  <Area
                    type="monotone"
                    dataKey="temperature"
                    stroke="var(--chart-1)"
                    fillOpacity={1}
                    fill="url(#colorTemp)"
                  />
                </AreaChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Grafik Kelembaban (Last 20 min)</CardTitle>
              <CardDescription>Pantau tren kelembaban penyimpanan</CardDescription>
            </CardHeader>
            <CardContent>
              <ResponsiveContainer width="100%" height={300}>
                <LineChart data={logs}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="timestamp" />
                  <YAxis domain={[0, 100]} />
                  <Tooltip />
                  <Legend />
                  <Line
                    type="monotone"
                    dataKey="humidity"
                    stroke="var(--chart-2)"
                    strokeWidth={2}
                    name="Kelembaban (%)"
                  />
                </LineChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        </>
      )}
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\kitchen-dashboard-overview.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import {
  BarChart,
  Bar,
  PieChart,
  Pie,
  Cell,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from "recharts"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { TrendingUp, Package, Loader2 } from "lucide-react"
import MenuRecommendation from "./menu-recommendation"
import ExpiryAlerts from "./expiry-alerts"
import InventoryList from "@/components/common/inventory-list"
import KitchenOrderHistory from "./kitchen-order-history"
import KitchenLocation from "./kitchen-location"

export default function KitchenDashboardOverview() {
  const [analytics, setAnalytics] = useState<any>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchAnalytics = async () => {
      try {
        const response = await fetch("/api/analytics/kitchen")
        const data = await response.json()
        setAnalytics(data)
      } catch (error) {
        console.error("Error fetching analytics:", error)
      } finally {
        setLoading(false)
      }
    }

    fetchAnalytics()
  }, [])

  if (loading) {
    return <div className="flex justify-center p-8"><Loader2 className="animate-spin w-8 h-8 text-primary" /></div>
  }

  // Fallback if no data
  const compositionData = analytics?.composition || []
  const qualityData = analytics?.quality || []
  const metrics = analytics?.metrics || { total_items: 0, total_qty: 0, warning_count: 0 }

  // Colors for Pie Chart
  const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d']

  return (
    <div className="space-y-6">
      {/* GPS Location Status */}
      <KitchenLocation />

      {/* Alert Banner */}
      <ExpiryAlerts />

      {/* Top Metrics Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card className="bg-blue-50 border-blue-100">
          <CardContent className="p-6">
            <p className="text-sm font-medium text-blue-600">Total Item Terdata</p>
            <p className="text-3xl font-bold text-blue-800">{metrics.total_items} Item</p>
          </CardContent>
        </Card>
        <Card className="bg-green-50 border-green-100">
          <CardContent className="p-6">
            <p className="text-sm font-medium text-green-600">Total Kuantitas</p>
            <p className="text-3xl font-bold text-green-800">{metrics.total_qty} Unit</p>
          </CardContent>
        </Card>
        <Card className="bg-amber-50 border-amber-100">
          <CardContent className="p-6">
            <p className="text-sm font-medium text-amber-600">Perlu Segera Digunakan</p>
            <p className="text-3xl font-bold text-amber-800">{metrics.warning_count} Item</p>
          </CardContent>
        </Card>
      </div>

      {/* Charts */}
      <div className="grid md:grid-cols-2 gap-6">
        {/* Chart A: Composition (Pie) */}
        <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
          <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20 py-6">
            <CardTitle className="flex items-center gap-2">
              <Package className="w-5 h-5 text-primary" />
              Komposisi Stok
            </CardTitle>
            <CardDescription>Distribusi barang berdasarkan jenis</CardDescription>
          </CardHeader>
          <CardContent className="pt-6 pb-6">
            <ResponsiveContainer width="100%" height={300}>
              <PieChart>
                <Pie
                  data={compositionData}
                  cx="50%"
                  cy="50%"
                  labelLine={false}
                  label={({ name, percent }) => `${name} ${((percent ?? 0) * 100).toFixed(0)}%`}
                  outerRadius={100}
                  fill="#8884d8"
                  dataKey="value"
                >
                  {compositionData.map((entry: any, index: number) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Pie>
                <Tooltip />
              </PieChart>
            </ResponsiveContainer>
          </CardContent>
        </Card>

        {/* Chart B: Quality (Bar) */}
        <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
          <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20 py-6">
            <CardTitle className="flex items-center gap-2">
              <TrendingUp className="w-5 h-5 text-primary" />
              Kualitas & Kuantitas
            </CardTitle>
            <CardDescription>Jumlah stok per item berdasarkan status</CardDescription>
          </CardHeader>
          <CardContent className="pt-6 pb-6">
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={qualityData}>
                <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                <XAxis dataKey="name" stroke="#6b7280" />
                <YAxis stroke="#6b7280" />
                <Tooltip />
                <Legend />
                <Bar dataKey="fresh" stackId="a" fill="#10B981" name="Segar" />
                <Bar dataKey="warning" stackId="a" fill="#F59E0B" name="Peringatan" />
                <Bar dataKey="critical" stackId="a" fill="#EF4444" name="Kritis" />
              </BarChart>
            </ResponsiveContainer>
          </CardContent>
        </Card>
      </div>

      {/* Menu Recommendation */}
      <MenuRecommendation />

      {/* Inventory List */}
      <InventoryList role="kitchen" />

      {/* Transaction History */}
      <KitchenOrderHistory />
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\kitchen-dashboard.tsx
==================================================
"use client"

import { useState } from "react"
import KitchenSidebar from "./kitchen-sidebar"
import KitchenDashboardOverview from "./kitchen-dashboard-overview"
import CookingProduction from "./cooking-production"
import IoTMonitoring from "./iot-monitoring"
import ScanFoodQC from "./scan-food-qc"
import SupplierSearchOrder from "./supplier-search-order"

interface KitchenDashboardProps {
  onLogout: () => void
}

export default function KitchenDashboard({ onLogout }: KitchenDashboardProps) {
  const [activeTab, setActiveTab] = useState("dashboard")

  const handleLogout = () => {
    onLogout()
  }

  return (
    <div className="flex min-h-screen bg-background">
      {/* Sidebar Layout */}
      <KitchenSidebar activeTab={activeTab} onTabChange={setActiveTab} onLogout={handleLogout} />

      {/* Main Content */}
      <main className="flex-1 lg:ml-64 pt-16 lg:pt-0">
        <header className="bg-white border-b border-border shadow-sm sticky top-0 z-10 lg:relative">
          <div className="px-4 sm:px-6 lg:px-8 py-4">
            <h1 className="text-2xl sm:text-3xl font-bold text-foreground">
              {activeTab === "dashboard" && "Dashboard Overview"}
              {activeTab === "search" && "Cari Supplier & Bahan"}
              {activeTab === "cook" && "Dapur & Produksi"}
              {activeTab === "iot" && "Smart Storage Monitoring"}
              {activeTab === "qc" && "Quality Control"}
            </h1>
          </div>
        </header>

        {/* Page Content */}
        <div className="px-4 sm:px-6 lg:px-8 py-8 space-y-8">
          {activeTab === "dashboard" && <KitchenDashboardOverview />}
          {activeTab === "search" && <SupplierSearchOrder />}
          {activeTab === "cook" && <CookingProduction />}
          {activeTab === "iot" && <IoTMonitoring />}
          {activeTab === "qc" && <ScanFoodQC />}
        </div>
      </main>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\kitchen-inbox.tsx
==================================================
"use client"

import { useState } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Bell, Trash2, Clock, AlertTriangle, Info } from "lucide-react"

interface InboxMessage {
  id: number
  type: "expiry" | "alert" | "info"
  title: string
  message: string
  timestamp: string
  read: boolean
  itemName?: string
  daysLeft?: number
}

export default function KitchenInbox() {
  const [messages, setMessages] = useState<InboxMessage[]>([
    {
      id: 1,
      type: "expiry",
      title: "Bahan Segera Kadaluarsa",
      message: "Telur dari vendor Semarang akan kadaluarsa dalam 1 hari",
      timestamp: "2 menit lalu",
      read: false,
      itemName: "Telur",
      daysLeft: 1,
    },
    {
      id: 2,
      type: "alert",
      title: "Kondisi Penyimpanan Tidak Optimal",
      message: "Suhu penyimpanan melebihi batas ideal (> 4¬∞C)",
      timestamp: "30 menit lalu",
      read: false,
    },
    {
      id: 3,
      type: "info",
      title: "Pesanan Baru Diterima",
      message: "SPPG Bekasi memesan 50kg beras putih",
      timestamp: "1 jam lalu",
      read: true,
    },
  ])

  const deleteMessage = (id: number) => {
    setMessages(messages.filter((m) => m.id !== id))
  }

  const markAsRead = (id: number) => {
    setMessages(messages.map((m) => (m.id === id ? { ...m, read: true } : m)))
  }

  const getIcon = (type: string) => {
    switch (type) {
      case "expiry":
        return <AlertTriangle className="w-5 h-5 text-red-500" />
      case "alert":
        return <Clock className="w-5 h-5 text-yellow-500" />
      case "info":
        return <Info className="w-5 h-5 text-blue-500" />
      default:
        return <Bell className="w-5 h-5 text-primary" />
    }
  }

  const getMessageColor = (type: string) => {
    switch (type) {
      case "expiry":
        return "bg-red-50 border-l-4 border-l-red-500"
      case "alert":
        return "bg-yellow-50 border-l-4 border-l-yellow-500"
      case "info":
        return "bg-blue-50 border-l-4 border-l-blue-500"
      default:
        return "bg-emerald-50 border-l-4 border-l-primary"
    }
  }

  const unreadCount = messages.filter((m) => !m.read).length
  const expiryCount = messages.filter((m) => m.type === "expiry" && !m.read).length

  return (
    <div className="space-y-6">
      <Card className="border-0 shadow-md">
        <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="bg-primary/20 p-2 rounded-lg">
                <Bell className="w-5 h-5 text-primary" />
              </div>
              <div>
                <CardTitle>Inbox Notifikasi</CardTitle>
                <CardDescription>Kelola peringatan dan notifikasi penting</CardDescription>
              </div>
            </div>
            {unreadCount > 0 && (
              <span className="bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">{unreadCount}</span>
            )}
          </div>
        </CardHeader>
        <CardContent className="pt-6">
          <Tabs defaultValue="all" className="space-y-4">
            <TabsList className="grid w-full grid-cols-4 bg-slate-100">
              <TabsTrigger value="all">
                Semua {messages.length > 0 && <span className="ml-1 text-xs">({messages.length})</span>}
              </TabsTrigger>
              <TabsTrigger value="unread">
                Belum Baca {unreadCount > 0 && <span className="ml-1 text-xs">({unreadCount})</span>}
              </TabsTrigger>
              <TabsTrigger value="expiry">
                Kadaluarsa {expiryCount > 0 && <span className="ml-1 text-xs">({expiryCount})</span>}
              </TabsTrigger>
              <TabsTrigger value="archived">Hapus</TabsTrigger>
            </TabsList>

            {/* All Messages */}
            <TabsContent value="all" className="space-y-3">
              {messages.length === 0 ? (
                <div className="text-center py-8">
                  <Bell className="w-8 h-8 text-muted-foreground mx-auto mb-2 opacity-50" />
                  <p className="text-muted-foreground">Tidak ada notifikasi</p>
                </div>
              ) : (
                messages.map((msg) => (
                  <div
                    key={msg.id}
                    className={`rounded-lg p-4 space-y-2 cursor-pointer transition-all hover:shadow-md ${getMessageColor(msg.type)} ${
                      !msg.read ? "font-semibold" : ""
                    }`}
                    onClick={() => markAsRead(msg.id)}
                  >
                    <div className="flex items-start justify-between gap-3">
                      <div className="flex items-start gap-3 flex-1">
                        {getIcon(msg.type)}
                        <div className="flex-1 min-w-0">
                          <p className="font-semibold text-foreground text-sm">{msg.title}</p>
                          <p className="text-sm text-muted-foreground line-clamp-2">{msg.message}</p>
                          <p className="text-xs text-muted-foreground mt-1">{msg.timestamp}</p>
                        </div>
                      </div>
                      <button
                        onClick={(e) => {
                          e.stopPropagation()
                          deleteMessage(msg.id)
                        }}
                        className="flex-shrink-0 hover:bg-black/10 rounded p-1 transition-colors"
                      >
                        <Trash2 className="w-4 h-4 text-muted-foreground" />
                      </button>
                    </div>

                    {msg.daysLeft && msg.daysLeft <= 2 && (
                      <div className="ml-8 bg-red-100 border border-red-300 rounded px-2 py-1">
                        <p className="text-xs font-semibold text-red-700">
                          {msg.itemName} - {msg.daysLeft} hari tersisa
                        </p>
                      </div>
                    )}
                  </div>
                ))
              )}
            </TabsContent>

            {/* Unread Messages */}
            <TabsContent value="unread" className="space-y-3">
              {messages.filter((m) => !m.read).length === 0 ? (
                <div className="text-center py-8">
                  <Bell className="w-8 h-8 text-muted-foreground mx-auto mb-2 opacity-50" />
                  <p className="text-muted-foreground">Tidak ada notifikasi belum baca</p>
                </div>
              ) : (
                messages
                  .filter((m) => !m.read)
                  .map((msg) => (
                    <div
                      key={msg.id}
                      className={`rounded-lg p-4 space-y-2 cursor-pointer transition-all hover:shadow-md ${getMessageColor(msg.type)}`}
                      onClick={() => markAsRead(msg.id)}
                    >
                      <div className="flex items-start justify-between gap-3">
                        <div className="flex items-start gap-3 flex-1">
                          {getIcon(msg.type)}
                          <div className="flex-1">
                            <p className="font-semibold text-foreground text-sm">{msg.title}</p>
                            <p className="text-sm text-muted-foreground">{msg.message}</p>
                            <p className="text-xs text-muted-foreground mt-1">{msg.timestamp}</p>
                          </div>
                        </div>
                        <button
                          onClick={(e) => {
                            e.stopPropagation()
                            deleteMessage(msg.id)
                          }}
                          className="flex-shrink-0 hover:bg-black/10 rounded p-1 transition-colors"
                        >
                          <Trash2 className="w-4 h-4 text-muted-foreground" />
                        </button>
                      </div>
                    </div>
                  ))
              )}
            </TabsContent>

            {/* Expiry Messages */}
            <TabsContent value="expiry" className="space-y-3">
              {messages.filter((m) => m.type === "expiry").length === 0 ? (
                <div className="text-center py-8">
                  <AlertTriangle className="w-8 h-8 text-muted-foreground mx-auto mb-2 opacity-50" />
                  <p className="text-muted-foreground">Tidak ada peringatan kadaluarsa</p>
                </div>
              ) : (
                messages
                  .filter((m) => m.type === "expiry")
                  .map((msg) => (
                    <div
                      key={msg.id}
                      className={`rounded-lg p-4 space-y-2 cursor-pointer transition-all hover:shadow-md ${getMessageColor(msg.type)}`}
                      onClick={() => markAsRead(msg.id)}
                    >
                      <div className="flex items-start justify-between gap-3">
                        <div className="flex items-start gap-3 flex-1">
                          {getIcon(msg.type)}
                          <div className="flex-1">
                            <p className="font-semibold text-foreground text-sm">{msg.title}</p>
                            <p className="text-sm text-muted-foreground">{msg.message}</p>
                            <p className="text-xs text-muted-foreground mt-1">{msg.timestamp}</p>
                          </div>
                        </div>
                        <button
                          onClick={(e) => {
                            e.stopPropagation()
                            deleteMessage(msg.id)
                          }}
                          className="flex-shrink-0 hover:bg-black/10 rounded p-1 transition-colors"
                        >
                          <Trash2 className="w-4 h-4 text-muted-foreground" />
                        </button>
                      </div>
                    </div>
                  ))
              )}
            </TabsContent>

            {/* Empty State for Archived */}
            <TabsContent value="archived" className="space-y-3">
              <div className="text-center py-8">
                <Trash2 className="w-8 h-8 text-muted-foreground mx-auto mb-2 opacity-50" />
                <p className="text-muted-foreground">Tidak ada notifikasi yang dihapus</p>
              </div>
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\kitchen-location.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { MapPin, Navigation, Loader2, AlertCircle } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Alert, AlertDescription } from "@/components/ui/alert"

export default function KitchenLocation() {
    const [location, setLocation] = useState<{ lat: number; long: number } | null>(null)
    const [error, setError] = useState<string | null>(null)
    const [loading, setLoading] = useState(true)

    // Manual Input State
    const [manualLat, setManualLat] = useState("-6.175392")
    const [manualLong, setManualLong] = useState("106.827153")
    const [isEditing, setIsEditing] = useState(false)

    const getLocation = () => {
        setLoading(true)
        setError(null)

        if (!navigator.geolocation) {
            setError("Geolocation is not supported")
            setLoading(false)
            return
        }

        navigator.geolocation.getCurrentPosition(
            (position) => {
                setLocation({
                    lat: position.coords.latitude,
                    long: position.coords.longitude,
                })
                setManualLat(position.coords.latitude.toString())
                setManualLong(position.coords.longitude.toString())
                setLoading(false)
            },
            (err) => {
                if (!err.message.includes("secure origin")) {
                    console.error("Geolocation Error:", err.message)
                }
                // Fallback to Monas
                setLocation({ lat: -6.175392, long: 106.827153 })
                setError("GPS Blocked (Non-HTTPS). Using Default Location.")
                setLoading(false)
            }
        )
    }

    const handleManualUpdate = () => {
        setLocation({
            lat: parseFloat(manualLat),
            long: parseFloat(manualLong)
        })
        setIsEditing(false)
        setError(null)
    }

    useEffect(() => {
        getLocation()
    }, [])

    return (
        <Card className="border-0 shadow-md overflow-hidden py-0 gap-0 bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
            <CardContent className="p-6 flex items-center justify-between">
                <div className="space-y-1 w-full">
                    <div className="flex items-center gap-2 mb-2">
                        <MapPin className="w-5 h-5 text-blue-200" />
                        <h3 className="font-bold text-lg">Lokasi SPPG Terdeteksi</h3>
                        <Button
                            variant="ghost"
                            size="sm"
                            className="h-6 text-xs bg-white/10 hover:bg-white/20 text-white ml-2"
                            onClick={() => setIsEditing(!isEditing)}
                        >
                            {isEditing ? "Batal" : "Ubah Lokasi"}
                        </Button>
                    </div>

                    {isEditing ? (
                        <div className="bg-white/10 p-3 rounded-lg space-y-2 backdrop-blur-sm">
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="text-xs text-blue-200">Latitude</label>
                                    <input
                                        type="text"
                                        value={manualLat}
                                        onChange={(e) => setManualLat(e.target.value)}
                                        className="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-sm text-white"
                                    />
                                </div>
                                <div>
                                    <label className="text-xs text-blue-200">Longitude</label>
                                    <input
                                        type="text"
                                        value={manualLong}
                                        onChange={(e) => setManualLong(e.target.value)}
                                        className="w-full bg-black/20 border border-white/10 rounded px-2 py-1 text-sm text-white"
                                    />
                                </div>
                            </div>
                            <Button
                                size="sm"
                                onClick={handleManualUpdate}
                                className="w-full bg-white text-blue-700 hover:bg-blue-50"
                            >
                                Update Lokasi
                            </Button>
                        </div>
                    ) : loading ? (
                        <div className="flex items-center gap-2 text-blue-100">
                            <Loader2 className="w-4 h-4 animate-spin" />
                            <span>Mencari koordinat GPS...</span>
                        </div>
                    ) : (
                        <div className="space-y-1">
                            {error && (
                                <div className="flex items-center gap-2 text-yellow-200 bg-yellow-900/20 px-2 py-1 rounded mb-2">
                                    <AlertCircle className="w-4 h-4" />
                                    <span className="text-xs">{error}</span>
                                </div>
                            )}
                            <div className="flex gap-4">
                                <div className="bg-white/10 px-3 py-1 rounded backdrop-blur-sm">
                                    <span className="text-xs text-blue-200 block">Latitude</span>
                                    <span className="font-mono font-medium">{location?.lat.toFixed(6)}</span>
                                </div>
                                <div className="bg-white/10 px-3 py-1 rounded backdrop-blur-sm">
                                    <span className="text-xs text-blue-200 block">Longitude</span>
                                    <span className="font-mono font-medium">{location?.long.toFixed(6)}</span>
                                </div>
                            </div>
                        </div>
                    )}
                </div>

                <div className="hidden sm:block ml-4">
                    <div className="bg-white/10 p-3 rounded-full">
                        <Navigation className="w-8 h-8 text-blue-200" />
                    </div>
                </div>
            </CardContent>
        </Card>
    )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\kitchen-order-history.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { AlertCircle, CheckCircle, Clock, ShoppingBag } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"

interface Order {
    id: number
    supply_name: string
    qty_ordered: number
    buyer_name: string
    status: "pending" | "confirmed" | "completed"
    created_at: string
    supplies?: {
        item_name: string
        unit: string
        price_per_unit: number
    }
}

export default function KitchenOrderHistory() {
    const [orders, setOrders] = useState<Order[]>([])
    const [loading, setLoading] = useState(true)

    useEffect(() => {
        const fetchOrders = async () => {
            try {
                // Reusing the UMKM endpoint as it returns all orders with supply details
                const response = await fetch("/api/orders/umkm")
                const data = await response.json()
                // Filter for orders where buyer is SPPG (or just show all for demo)
                // For this demo, we assume all orders are relevant
                setOrders(data.orders || data || [])
            } catch (error) {
                console.error("Error fetching orders:", error)
            } finally {
                setLoading(false)
            }
        }

        fetchOrders()
    }, [])

    const getStatusIcon = (status: string) => {
        switch (status) {
            case "confirmed":
                return <CheckCircle className="w-5 h-5 text-green-500" />
            case "pending":
                return <Clock className="w-5 h-5 text-yellow-500" />
            case "completed":
                return <CheckCircle className="w-5 h-5 text-blue-500" />
            default:
                return <AlertCircle className="w-5 h-5 text-muted-foreground" />
        }
    }

    const getStatusBadge = (status: string) => {
        switch (status) {
            case "pending":
                return "bg-yellow-100 text-yellow-800"
            case "confirmed":
                return "bg-blue-100 text-blue-800"
            case "completed":
                return "bg-green-100 text-green-800"
            default:
                return "bg-muted text-muted-foreground"
        }
    }

    if (loading) {
        return (
            <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
                <CardHeader className="bg-gradient-to-r from-purple-50 to-pink-50 border-b border-purple-100 py-6">
                    <CardTitle className="flex items-center gap-2 text-purple-800">
                        <ShoppingBag className="w-5 h-5" />
                        Riwayat Transaksi
                    </CardTitle>
                    <CardDescription>Memuat riwayat...</CardDescription>
                </CardHeader>
                <CardContent className="pt-6 pb-6">
                    <p className="text-center text-muted-foreground">Memuat data...</p>
                </CardContent>
            </Card>
        )
    }

    return (
        <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
            <CardHeader className="bg-gradient-to-r from-purple-50 to-pink-50 border-b border-purple-100 py-6">
                <CardTitle className="flex items-center gap-2 text-purple-800">
                    <ShoppingBag className="w-5 h-5" />
                    Riwayat Transaksi
                </CardTitle>
                <CardDescription className="text-purple-600">
                    Status pesanan bahan baku ke UMKM
                </CardDescription>
            </CardHeader>
            <CardContent className="pt-6 pb-6">
                {orders.length === 0 ? (
                    <Alert className="bg-purple-50 border-purple-200">
                        <AlertCircle className="h-4 w-4 text-purple-600" />
                        <AlertDescription className="text-purple-800">Belum ada riwayat transaksi</AlertDescription>
                    </Alert>
                ) : (
                    <div className="space-y-3">
                        {orders.map((order) => (
                            <div key={order.id} className="border border-border rounded-lg p-4 hover:bg-slate-50 transition-colors">
                                <div className="flex items-start justify-between">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-2">
                                            {getStatusIcon(order.status)}
                                            <p className="font-semibold text-foreground">
                                                {order.supplies?.item_name || order.supply_name || "Item Tidak Diketahui"}
                                            </p>
                                        </div>
                                        <div className="text-sm text-muted-foreground space-y-1">
                                            <p>Jumlah: {order.qty_ordered} {order.supplies?.unit || "unit"}</p>
                                            <p className="text-xs">Dipesan pada: {new Date(order.created_at).toLocaleDateString("id-ID", {
                                                day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit'
                                            })}</p>
                                        </div>
                                    </div>
                                    <span className={`text-xs px-3 py-1 rounded-full font-semibold ${getStatusBadge(order.status)}`}>
                                        {order.status === "pending" ? "Menunggu Konfirmasi" :
                                            order.status === "confirmed" ? "Dikonfirmasi" :
                                                order.status === "completed" ? "Selesai" : order.status}
                                    </span>
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </CardContent>
        </Card>
    )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\kitchen-sidebar.tsx
==================================================
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { LayoutDashboard, Search, ChefHat, Thermometer, Camera, LogOut, Menu, X } from "lucide-react"

interface KitchenSidebarProps {
  activeTab: string
  onTabChange: (tab: string) => void
  onLogout: () => void
}

export default function KitchenSidebar({ activeTab, onTabChange, onLogout }: KitchenSidebarProps) {
  const [open, setOpen] = useState(false)

  const navItems = [
    { id: "dashboard", label: "Dashboard", icon: LayoutDashboard },
    { id: "search", label: "Cari Supplier", icon: Search },
    { id: "cook", label: "Dapur & Produksi", icon: ChefHat },
    { id: "iot", label: "Smart Storage", icon: Thermometer },
    { id: "qc", label: "Quality Control", icon: Camera },
  ]

  return (
    <>
      {/* Mobile Toggle Button */}
      <Button
        variant="ghost"
        size="icon"
        className="lg:hidden fixed top-4 left-4 z-40 bg-white border border-border"
        onClick={() => setOpen(!open)}
      >
        {open ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
      </Button>

      {/* Sidebar */}
      <aside
        className={`fixed left-0 top-0 h-full w-64 bg-white border-r border-border z-30 transition-transform duration-300 lg:translate-x-0 ${
          open ? "translate-x-0" : "-translate-x-full"
        }`}
      >
        <div className="flex flex-col h-full">
          {/* Sidebar Header */}
          <div className="p-6 border-b border-border">
            <h2 className="text-xl font-bold text-foreground">Bekal Bangsa</h2>
            <p className="text-xs text-muted-foreground mt-1">SPPG Control Center</p>
          </div>

          {/* Navigation */}
          <nav className="flex-1 p-4 space-y-2">
            {navItems.map((item) => {
              const Icon = item.icon
              return (
                <Button
                  key={item.id}
                  onClick={() => {
                    onTabChange(item.id)
                    setOpen(false)
                  }}
                  className={`w-full justify-start gap-3 text-base font-medium transition-all ${
                    activeTab === item.id
                      ? "bg-primary text-white shadow-md"
                      : "bg-transparent text-foreground hover:bg-primary/10"
                  }`}
                >
                  <Icon className="w-5 h-5" />
                  {item.label}
                </Button>
              )
            })}
          </nav>

          {/* Logout */}
          <div className="p-4 border-t border-border">
            <Button
              onClick={onLogout}
              className="w-full justify-start gap-3 text-base font-medium bg-red-50 text-red-600 hover:bg-red-100"
            >
              <LogOut className="w-5 h-5" />
              Logout
            </Button>
          </div>
        </div>
      </aside>

      {/* Mobile Overlay */}
      {open && <div className="fixed inset-0 bg-black/50 z-20 lg:hidden" onClick={() => setOpen(false)} />}
    </>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\menu-recommendation.tsx
==================================================
"use client"

import { useState } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { ChefHat, Zap, Plus, X, Flame } from "lucide-react"

interface MenuRecommendation {
  menu_name: string
  description: string
  nutrition: {
    calories: string
    protein: string
    carbs?: string
    fats?: string
  }
  reason: string
  ingredients: string[]
  ingredients_needed: string[]
  cooking_steps: string[]
}

export default function MenuRecommendation() {
  const [ingredients, setIngredients] = useState<string[]>([])
  const [newIngredient, setNewIngredient] = useState("")
  const [recommendations, setRecommendations] = useState<MenuRecommendation[]>([])
  const [loading, setLoading] = useState(false)
  const [availableStock, setAvailableStock] = useState<any[]>([])

  // Fetch available stock on mount
  useState(() => {
    const fetchStock = async () => {
      try {
        const res = await fetch("/api/supplies?limit=20")
        const data = await res.json()
        if (Array.isArray(data)) {
          setAvailableStock(data)
        }
      } catch (err) {
        console.error("Failed to fetch stock:", err)
      }
    }
    fetchStock()
  })

  const handleAddIngredient = (name?: string) => {
    const ingredientToAdd = name || newIngredient
    if (ingredientToAdd.trim() && !ingredients.includes(ingredientToAdd.trim())) {
      setIngredients([...ingredients, ingredientToAdd.trim()])
      setNewIngredient("")
    }
  }

  const handleRemoveIngredient = (ingredient: string) => {
    setIngredients(ingredients.filter((i) => i !== ingredient))
  }

  const handleGetRecommendations = async () => {
    if (ingredients.length === 0) return

    setLoading(true)
    try {
      const response = await fetch("/api/recommend-menu", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ingredients }),
      })
      const data = await response.json()
      console.log("API Response:", data)

      if (data.error) {
        alert(`Gagal mendapatkan rekomendasi: ${data.error}`)
        return
      }

      // Robust handling for various AI response formats
      let recs: MenuRecommendation[] = []

      if (data.recommendations && Array.isArray(data.recommendations)) {
        recs = data.recommendations
      } else if (Array.isArray(data)) {
        recs = data
      } else if (data.menu_name) {
        // Single object response fallback
        recs = [data as MenuRecommendation]
      }

      if (recs.length === 0) {
        console.warn("No recommendations found in data:", data)
      }

      setRecommendations(recs)
    } catch (error) {
      console.error("Error getting recommendations:", error)
      alert(`Terjadi kesalahan: ${error instanceof Error ? error.message : "Unknown error"}`)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="space-y-6">
      <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
        <CardHeader className="bg-gradient-to-r from-secondary/10 to-amber-50 border-b border-secondary/20 py-6">
          <div className="flex items-center gap-3">
            <div className="bg-secondary/20 p-2 rounded-lg">
              <ChefHat className="w-5 h-5 text-secondary" />
            </div>
            <div>
              <CardTitle>Rekomendasi Menu AI</CardTitle>
              <CardDescription>Pilih bahan dari stok tersedia atau ketik manual</CardDescription>
            </div>
          </div>
        </CardHeader>
        <CardContent className="space-y-4 pt-6 pb-6">
          <div className="space-y-4">
            {/* Available Stock Selection */}
            {availableStock.length > 0 && (
              <div className="space-y-2">
                <p className="text-sm font-medium text-muted-foreground">Stok Tersedia:</p>
                <div className="flex flex-wrap gap-2">
                  {availableStock.map((item) => (
                    <button
                      key={item.id}
                      onClick={() => handleAddIngredient(item.item_name)}
                      disabled={ingredients.includes(item.item_name)}
                      className={`px-3 py-1.5 rounded-full text-xs font-medium border transition-all
                        ${ingredients.includes(item.item_name)
                          ? "bg-secondary/10 text-secondary border-secondary/20 opacity-50 cursor-not-allowed"
                          : "bg-white text-foreground border-border hover:border-secondary hover:text-secondary"
                        }`}
                    >
                      {item.item_name}
                    </button>
                  ))}
                </div>
              </div>
            )}

            <div className="flex gap-2">
              <Input
                placeholder="Atau ketik bahan manual..."
                value={newIngredient}
                onChange={(e) => setNewIngredient(e.target.value)}
                onKeyDown={(e) => e.key === "Enter" && handleAddIngredient()}
                className="border-primary/30 focus:border-primary"
              />
              <Button
                onClick={() => handleAddIngredient()}
                className="bg-primary hover:bg-primary/90 text-white font-medium px-4"
              >
                <Plus className="w-4 h-4" />
              </Button>
            </div>

            {ingredients.length > 0 && (
              <div className="flex flex-wrap gap-2 p-3 bg-gray-50 rounded-lg border border-gray-100">
                {ingredients.map((ingredient) => (
                  <button
                    key={ingredient}
                    onClick={() => handleRemoveIngredient(ingredient)}
                    className="bg-secondary hover:bg-secondary/90 text-white px-3 py-1 rounded-full text-sm transition-colors flex items-center gap-2"
                  >
                    {ingredient}
                    <X className="w-3 h-3" />
                  </button>
                ))}
              </div>
            )}

            <Button
              onClick={handleGetRecommendations}
              disabled={ingredients.length === 0 || loading}
              className="w-full bg-secondary hover:bg-secondary/90 text-white font-semibold py-6 rounded-lg flex items-center justify-center gap-2"
            >
              <Zap className="w-4 h-4" />
              {loading ? "Sedang Meracik Menu..." : "Dapatkan Rekomendasi Menu"}
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Recommendations */}
      {recommendations.length > 0 && (
        <div className="space-y-4">
          {recommendations.map((menu, idx) => (
            <Card key={idx} className="border-0 shadow-md border-l-4 border-l-secondary overflow-hidden">
              <CardHeader className="bg-gradient-to-r from-secondary/10 to-amber-50 pb-4">
                <div className="flex items-start justify-between">
                  <div className="flex items-start gap-3">
                    <div className="bg-secondary/20 p-2 rounded-lg mt-1">
                      <Flame className="w-4 h-4 text-secondary" />
                    </div>
                    <CardTitle className="text-xl">{menu.menu_name}</CardTitle>
                  </div>
                </div>
              </CardHeader>
              <CardContent className="space-y-4 pt-6">
                <p className="text-muted-foreground">{menu.description}</p>

                <div className="grid md:grid-cols-2 gap-4 mb-4">
                  <div className="bg-gray-50 p-3 rounded-lg">
                    <p className="text-sm font-semibold mb-2">Bahan yang Digunakan:</p>
                    <div className="flex flex-wrap gap-2">
                      {menu.ingredients?.map((ing, i) => (
                        <span key={i} className="text-xs bg-white border px-2 py-1 rounded-full text-muted-foreground">
                          {ing}
                        </span>
                      )) || <span className="text-xs text-muted-foreground">Tidak ada data bahan.</span>}
                    </div>
                  </div>

                  <div className="bg-blue-50 p-3 rounded-lg">
                    <p className="text-sm font-semibold mb-2 text-blue-800">Bahan yang Dibutuhkan:</p>
                    <ul className="space-y-1">
                      {menu.ingredients_needed?.map((ing, i) => (
                        <li key={i} className="text-xs text-blue-700 flex items-start gap-2">
                          <span className="w-1 h-1 rounded-full bg-blue-400 mt-1.5" />
                          {ing}
                        </li>
                      )) || <li className="text-xs text-muted-foreground">Tidak ada detail bahan.</li>}
                    </ul>
                  </div>
                </div>

                <div className="bg-orange-50 p-4 rounded-lg mb-4 border border-orange-100">
                  <p className="text-sm font-semibold mb-3 text-orange-800 flex items-center gap-2">
                    <ChefHat className="w-4 h-4" />
                    Langkah Memasak
                  </p>
                  <div className="space-y-2">
                    {menu.cooking_steps?.map((step, i) => (
                      <div key={i} className="flex gap-3 text-sm">
                        <span className="font-bold text-orange-400 w-5 flex-shrink-0">{i + 1}.</span>
                        <p className="text-orange-900">{step}</p>
                      </div>
                    )) || <p className="text-sm text-muted-foreground">Tidak ada langkah memasak.</p>}
                  </div>
                </div>

                <div className="grid md:grid-cols-2 gap-4">
                  <div className="bg-emerald-50 border border-primary/20 p-4 rounded-lg">
                    <p className="text-sm text-muted-foreground mb-2 font-semibold">Nutrisi per Porsi</p>
                    <div className="space-y-1">
                      <p className="font-bold text-foreground text-lg">{menu.nutrition.calories}</p>
                      <p className="text-sm text-muted-foreground">Protein: {menu.nutrition.protein}</p>
                      {menu.nutrition.carbs && <p className="text-sm text-muted-foreground">Karbo: {menu.nutrition.carbs}</p>}
                      {menu.nutrition.fats && <p className="text-sm text-muted-foreground">Lemak: {menu.nutrition.fats}</p>}
                    </div>
                  </div>

                  <div className="bg-amber-50 border border-secondary/30 p-4 rounded-lg">
                    <p className="text-sm font-semibold mb-2 text-secondary">Alasan Rekomendasi</p>
                    <p className="text-sm text-foreground">{menu.reason}</p>
                  </div>
                </div>

                <Button className="w-full bg-primary hover:bg-primary/90 text-white font-semibold py-6 rounded-lg">
                  <Flame className="w-4 h-4 mr-2" />
                  Mulai Memasak
                </Button>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\scan-food-qc.tsx
==================================================
"use client"

import type React from "react"

import { useState, useRef, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Camera, Upload, CheckCircle, AlertCircle } from "lucide-react"

interface ScanResult {
  id: number
  image: string
  safetyStatus: "approved" | "rejected" | "pending"
  nutritionData: {
    calories: number
    protein: number
    carbs: number
    fat: number
  }
  menuName?: string
  visualQuality?: string
  spoilageSigns?: string[]
  timestamp: string
}

export default function ScanFoodQC() {
  const [activeTab, setActiveTab] = useState<"camera" | "upload">("camera")
  const [stream, setStream] = useState<MediaStream | null>(null)
  const [photo, setPhoto] = useState<string | null>(null)
  const [results, setResults] = useState<ScanResult[]>([])
  const [loading, setLoading] = useState(false)
  const videoRef = useRef<HTMLVideoElement>(null)
  const canvasRef = useRef<HTMLCanvasElement>(null)

  // Fix: Attach stream to video element when it becomes available
  useEffect(() => {
    if (videoRef.current && stream) {
      videoRef.current.srcObject = stream
    }
  }, [stream])

  const startCamera = async () => {
    try {
      const mediaStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
      })
      setStream(mediaStream)
      // videoRef.current is null here because the video element hasn't rendered yet
    } catch (error) {
      console.error("Error accessing camera:", error)
      alert("Tidak dapat mengakses kamera")
    }
  }

  const stopCamera = () => {
    if (stream) {
      stream.getTracks().forEach((track) => track.stop())
      setStream(null)
      // Do not clear photo here, as it's called after capture
    }
  }

  const capturePhoto = () => {
    if (videoRef.current && canvasRef.current) {
      const context = canvasRef.current.getContext("2d")
      if (context) {
        canvasRef.current.width = videoRef.current.videoWidth
        canvasRef.current.height = videoRef.current.videoHeight
        context.drawImage(videoRef.current, 0, 0)
        const photoData = canvasRef.current.toDataURL("image/jpeg")
        setPhoto(photoData)
        stopCamera()
      }
    }
  }

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (file) {
      const reader = new FileReader()
      reader.onload = (event) => {
        setPhoto(event.target?.result as string)
      }
      reader.readAsDataURL(file)
    }
  }

  const submitForAnalysis = async () => {
    if (!photo) return

    setLoading(true)
    try {
      // Convert base64 to blob
      // Convert base64 to blob
      const fetchRes = await fetch(photo)
      const blob = await fetchRes.blob()
      const file = new File([blob], "scan.jpg", { type: "image/jpeg" })

      const formData = new FormData()
      formData.append("file", file)

      console.log("Sending file to backend...", file.size, file.type) // Debug log

      const response = await fetch("/api/kitchen/scan-food", {
        method: "POST",
        body: formData,
      })
      const data = await response.json()

      console.log("Backend response:", data)

      // Map analyze_cooked_meal response to frontend state
      const safetyStatus: "approved" | "rejected" | "pending" = data.is_safe === true
        ? "approved"
        : data.is_safe === false
          ? "rejected"
          : "pending"

      const nutritionData = {
        calories: parseInt(data.nutrition_estimate?.calories) || 0,
        protein: parseInt(data.nutrition_estimate?.protein) || 0,
        carbs: parseInt(data.nutrition_estimate?.carbs) || 0,
        fat: parseInt(data.nutrition_estimate?.fats || data.nutrition_estimate?.fat) || 0,
      }

      const newResult: ScanResult = {
        id: results.length + 1,
        image: photo,
        safetyStatus,
        nutritionData,
        menuName: data.menu_name,
        visualQuality: data.visual_quality,
        spoilageSigns: data.spoilage_signs && data.spoilage_signs.length > 0 ? data.spoilage_signs : undefined,
        timestamp: new Date().toLocaleString("id-ID"),
      }
      setResults([newResult, ...results])
      setPhoto(null)
    } catch (error) {
      console.error("Error submitting for analysis:", error)
      alert("Gagal mengirim untuk analisis")
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="space-y-6">
      {/* Scan Section */}
      <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
        <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20 py-6">
          <CardTitle>QC Scan Makanan</CardTitle>
          <CardDescription>Scan makanan untuk verifikasi keamanan dan nutrisi</CardDescription>
        </CardHeader>
        <CardContent className="pt-6 pb-6">
          {/* Tabs */}
          <div className="flex gap-2 mb-6">
            <Button
              onClick={() => {
                setActiveTab("camera")
                startCamera()
              }}
              className={`flex items-center gap-2 ${activeTab === "camera"
                ? "bg-primary text-white"
                : "bg-white text-foreground border border-border hover:bg-slate-50"
                }`}
            >
              <Camera className="w-4 h-4" />
              Ambil Foto
            </Button>
            <Button
              onClick={() => {
                setActiveTab("upload")
                stopCamera()
              }}
              className={`flex items-center gap-2 ${activeTab === "upload"
                ? "bg-primary text-white"
                : "bg-white text-foreground border border-border hover:bg-slate-50"
                }`}
            >
              <Upload className="w-4 h-4" />
              Upload File
            </Button>
          </div>

          {/* Camera Tab */}
          {activeTab === "camera" && (
            <div className="space-y-4">
              {stream && !photo ? (
                <div className="space-y-4">
                  <video
                    ref={videoRef}
                    autoPlay
                    playsInline
                    className="w-full rounded-lg bg-black border-2 border-primary"
                  />
                  <div className="flex gap-2">
                    <Button onClick={capturePhoto} className="flex-1 bg-primary hover:bg-primary/90 text-white">
                      <Camera className="w-4 h-4 mr-2" />
                      Ambil Foto
                    </Button>
                    <Button
                      onClick={stopCamera}
                      variant="outline"
                      className="flex-1 border-red-300 text-red-600 hover:bg-red-50 bg-transparent"
                    >
                      Batalkan
                    </Button>
                  </div>
                </div>
              ) : !photo ? (
                <Button onClick={startCamera} className="w-full bg-primary hover:bg-primary/90 text-white py-6">
                  <Camera className="w-5 h-5 mr-2" />
                  Buka Kamera
                </Button>
              ) : (
                <div className="space-y-4">
                  <img
                    src={photo || "/placeholder.svg"}
                    alt="Captured"
                    className="w-full rounded-lg border-2 border-primary"
                  />
                  <div className="flex gap-2">
                    <Button onClick={() => setPhoto(null)} variant="outline" className="flex-1">
                      Ambil Ulang
                    </Button>
                    <Button
                      onClick={submitForAnalysis}
                      disabled={loading}
                      className="flex-1 bg-primary hover:bg-primary/90 text-white"
                    >
                      {loading ? "Menganalisis..." : "Analisis"}
                    </Button>
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Upload Tab */}
          {activeTab === "upload" && !photo && (
            <div className="space-y-4">
              <label className="block">
                <div className="border-2 border-dashed border-primary/30 rounded-lg p-8 text-center cursor-pointer hover:bg-primary/5 transition-colors">
                  <Upload className="w-8 h-8 text-primary mx-auto mb-2" />
                  <p className="font-semibold text-foreground">Klik untuk upload foto</p>
                  <p className="text-sm text-muted-foreground">atau drag and drop</p>
                </div>
                <Input type="file" accept="image/*" onChange={handleFileUpload} className="hidden" />
              </label>
            </div>
          )}

          {/* Upload Preview */}
          {activeTab === "upload" && photo && (
            <div className="space-y-4">
              <img
                src={photo || "/placeholder.svg"}
                alt="Uploaded"
                className="w-full rounded-lg border-2 border-primary"
              />
              <div className="flex gap-2">
                <Button onClick={() => setPhoto(null)} variant="outline" className="flex-1">
                  Pilih Ulang
                </Button>
                <Button
                  onClick={submitForAnalysis}
                  disabled={loading}
                  className="flex-1 bg-primary hover:bg-primary/90 text-white"
                >
                  {loading ? "Menganalisis..." : "Analisis"}
                </Button>
              </div>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Hidden canvas for camera capture */}
      <canvas ref={canvasRef} className="hidden" />

      {/* Results */}
      {results.length > 0 && (
        <Card className="border-0 shadow-md overflow-hidden py-0 gap-0">
          <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20 py-6">
            <CardTitle>Hasil Pemeriksaan</CardTitle>
            <CardDescription>Riwayat scan QC makanan</CardDescription>
          </CardHeader>
          <CardContent className="pt-6 pb-6 space-y-4">
            {results.map((result) => (
              <div key={result.id} className="border border-border rounded-lg p-4 space-y-4">
                <div className="flex items-start justify-between gap-4">
                  <img
                    src={result.image || "/placeholder.svg"}
                    alt="Scan result"
                    className="w-20 h-20 rounded-lg object-cover border border-border"
                  />
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      {result.safetyStatus === "approved" ? (
                        <CheckCircle className="w-5 h-5 text-green-500" />
                      ) : result.safetyStatus === "rejected" ? (
                        <AlertCircle className="w-5 h-5 text-red-500" />
                      ) : (
                        <AlertCircle className="w-5 h-5 text-yellow-500" />
                      )}
                      <span className="font-semibold text-foreground">
                        {result.safetyStatus === "approved"
                          ? "Disetujui"
                          : result.safetyStatus === "rejected"
                            ? "Ditolak"
                            : "Pending"}
                      </span>
                    </div>
                    {result.menuName && (
                      <p className="text-sm font-medium text-foreground mb-1">{result.menuName}</p>
                    )}
                    {result.visualQuality && (
                      <p className="text-xs text-muted-foreground mb-1">üé® {result.visualQuality}</p>
                    )}
                    {result.spoilageSigns && result.spoilageSigns.length > 0 && (
                      <p className="text-xs text-red-600 mb-1">‚ö†Ô∏è {result.spoilageSigns.join(", ")}</p>
                    )}
                    <p className="text-xs text-muted-foreground">{result.timestamp}</p>
                  </div>
                </div>

                {/* Nutrition Info */}
                <div className="grid grid-cols-4 gap-2 text-sm">
                  <div className="bg-primary/10 p-2 rounded text-center">
                    <p className="text-xs text-muted-foreground">Kalori</p>
                    <p className="font-semibold text-foreground">{result.nutritionData.calories}</p>
                  </div>
                  <div className="bg-secondary/10 p-2 rounded text-center">
                    <p className="text-xs text-muted-foreground">Protein</p>
                    <p className="font-semibold text-foreground">{result.nutritionData.protein}g</p>
                  </div>
                  <div className="bg-blue-500/10 p-2 rounded text-center">
                    <p className="text-xs text-muted-foreground">Karbo</p>
                    <p className="font-semibold text-foreground">{result.nutritionData.carbs}g</p>
                  </div>
                  <div className="bg-orange-500/10 p-2 rounded text-center">
                    <p className="text-xs text-muted-foreground">Lemak</p>
                    <p className="font-semibold text-foreground">{result.nutritionData.fat}g</p>
                  </div>
                </div>
              </div>
            ))}
          </CardContent>
        </Card>
      )}
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\supplier-search-order.tsx
==================================================
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { MapPin, Search, ShoppingCart, CheckCircle } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import {
    Dialog,
    DialogContent,
    DialogDescription,
    DialogFooter,
    DialogHeader,
    DialogTitle,
} from "@/components/ui/dialog"
import { Label } from "@/components/ui/label"

interface SupplyItem {
    id: number
    name: string
    item_name?: string // Backend field
    qty: number
    quantity?: number // Backend field
    unit: string
    freshness: string
    quality_status?: string // Backend field
    expiry_days: number
    distance?: number
    distance_km?: number // Backend field
    owner_name: string
    location: string
}

export default function SupplierSearchOrder() {
    const [searchQuery, setSearchQuery] = useState("")
    const [searchResults, setSearchResults] = useState<SupplyItem[]>([])
    const [loading, setLoading] = useState(false)
    const [location, setLocation] = useState<{ lat: number; lon: number } | null>(null)

    // Order State
    const [selectedItem, setSelectedItem] = useState<SupplyItem | null>(null)
    const [orderQty, setOrderQty] = useState(1)
    const [isOrderDialogOpen, setIsOrderDialogOpen] = useState(false)
    const [orderProcessing, setOrderProcessing] = useState(false)

    const handleGetLocation = () => {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    setLocation({
                        lat: position.coords.latitude,
                        lon: position.coords.longitude,
                    })
                },
                (error) => {
                    // Only log if it's NOT a secure origin error to avoid console noise
                    if (!error.message.includes("secure origin")) {
                        console.error("Error getting location:", error)
                    }
                    // Fallback to Monas, Jakarta for Demo/Dev
                    setLocation({
                        lat: -6.175392,
                        lon: 106.827153,
                    })
                },
            )
        }
    }

    const handleSearch = async () => {
        if (!searchQuery.trim()) return

        setLoading(true)
        try {
            const params = new URLSearchParams({
                q: searchQuery,
                ...(location && { lat: location.lat.toString(), long: location.lon.toString() }),
            })

            const response = await fetch(`/api/suppliers/search?${params}`, {
                method: "GET",
            })
            const data = await response.json()
            console.log("[v0] Search results:", data)
            setSearchResults(data.data || [])
        } catch (error) {
            console.error("Error searching suppliers:", error)
        } finally {
            setLoading(false)
        }
    }

    const openOrderDialog = (item: SupplyItem) => {
        setSelectedItem(item)
        setOrderQty(1)
        setIsOrderDialogOpen(true)
    }

    const handlePlaceOrder = async () => {
        if (!selectedItem) return

        setOrderProcessing(true)
        try {
            const response = await fetch("/api/orders", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    supply_id: selectedItem.id,
                    qty_ordered: orderQty,
                    buyer_name: "Dapur SPPG Pusat", // Hardcoded for now, ideally from auth
                }),
            })

            if (response.ok) {
                alert("Pesanan berhasil dibuat!")
                setIsOrderDialogOpen(false)
                setSelectedItem(null)
            } else {
                alert("Gagal membuat pesanan.")
            }
        } catch (error) {
            console.error("Error placing order:", error)
            alert("Terjadi kesalahan saat memesan.")
        } finally {
            setOrderProcessing(false)
        }
    }

    return (
        <div className="space-y-6">
            <Card>
                <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                        <Search className="w-5 h-5 text-emerald-600" />
                        Cari Supplier & Bahan Baku
                    </CardTitle>
                    <CardDescription>Cari bahan segar dari UMKM terdekat untuk dapur Anda</CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                    <div className="flex gap-2">
                        <Input
                            placeholder="Cari bahan (misal: Bawang, Telur, Bayam)"
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                            onKeyDown={(e) => e.key === "Enter" && handleSearch()}
                            className="flex-1"
                        />
                        <Button
                            onClick={handleSearch}
                            disabled={loading}
                            className="bg-emerald-600 hover:bg-emerald-700 text-white"
                        >
                            {loading ? "Mencari..." : "Cari"}
                        </Button>
                    </div>
                </CardContent>
            </Card>

            {/* Results */}
            {searchResults.length > 0 && (
                <Card>
                    <CardHeader>
                        <CardTitle>Hasil Pencarian ({searchResults.length})</CardTitle>
                    </CardHeader>
                    <CardContent>
                        <div className="space-y-3">
                            {searchResults.map((item) => (
                                <div key={item.id} className="border border-border rounded-lg p-4 hover:bg-muted transition-colors">
                                    <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                            {/* Backend returns: item_name, quantity, unit, quality_status, owner_name */}
                                            <p className="font-semibold text-foreground text-lg">{item.item_name || item.name}</p>
                                            <p className="text-sm text-muted-foreground">
                                                Stok: {item.quantity || item.qty} {item.unit} ‚Ä¢ {item.quality_status || item.freshness}
                                            </p>
                                            <p className="text-xs text-muted-foreground mt-1">
                                                Supplier: <span className="font-medium text-emerald-700">{item.owner_name}</span>
                                            </p>
                                        </div>
                                        <div className="text-right space-y-2">
                                            {/* Backend returns: distance_km, expiry_days */}
                                            {(item.distance_km !== undefined || item.distance !== undefined) && (
                                                <div className="flex items-center justify-end gap-1 text-emerald-600">
                                                    <MapPin className="w-3 h-3" />
                                                    <p className="text-sm font-bold">
                                                        {(item.distance_km ?? item.distance ?? 0).toFixed(1)} km
                                                    </p>
                                                </div>
                                            )}
                                            <span className="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded block text-center">
                                                Exp: {item.expiry_days} hari
                                            </span>
                                        </div>
                                    </div>

                                    <div className="mt-4 flex justify-end">
                                        <Button
                                            onClick={() => openOrderDialog(item)}
                                            className="bg-emerald-600 hover:bg-emerald-700 text-white"
                                        >
                                            <ShoppingCart className="w-4 h-4 mr-2" />
                                            Pesan Sekarang
                                        </Button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </CardContent>
                </Card>
            )}

            {!loading && searchResults.length === 0 && searchQuery && (
                <Alert>
                    <AlertDescription>Tidak ada hasil pencarian untuk "{searchQuery}"</AlertDescription>
                </Alert>
            )}

            {/* Order Dialog */}
            <Dialog open={isOrderDialogOpen} onOpenChange={setIsOrderDialogOpen}>
                <DialogContent>
                    <DialogHeader>
                        <DialogTitle>Konfirmasi Pesanan</DialogTitle>
                        <DialogDescription>
                            Anda akan memesan <strong>{selectedItem?.name}</strong> dari {selectedItem?.owner_name}.
                        </DialogDescription>
                    </DialogHeader>

                    <div className="grid gap-4 py-4">
                        <div className="grid grid-cols-4 items-center gap-4">
                            <Label htmlFor="qty" className="text-right">
                                Jumlah
                            </Label>
                            <Input
                                id="qty"
                                type="number"
                                value={orderQty}
                                onChange={(e) => setOrderQty(Number(e.target.value))}
                                className="col-span-3"
                                min={1}
                                max={selectedItem?.qty}
                            />
                        </div>
                        <p className="text-sm text-muted-foreground text-right">
                            Tersedia: {selectedItem?.qty} {selectedItem?.unit}
                        </p>
                    </div>

                    <DialogFooter>
                        <Button variant="outline" onClick={() => setIsOrderDialogOpen(false)}>Batal</Button>
                        <Button
                            onClick={handlePlaceOrder}
                            disabled={orderProcessing}
                            className="bg-emerald-600 hover:bg-emerald-700 text-white"
                        >
                            {orderProcessing ? "Memproses..." : "Konfirmasi Pesanan"}
                        </Button>
                    </DialogFooter>
                </DialogContent>
            </Dialog>
        </div>
    )
}


==================================================
FILENAME: .\frontend_next\components\kitchen\supply-overview.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Input } from "@/components/ui/input"
import { Button } from "@/components/ui/button"
import { Search, AlertCircle, Warehouse } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from "recharts"

interface Supply {
  id: number
  name: string
  qty: number
  unit: string
  freshness: string
  expiry_days: number
  owner_name: string
  location: string
}

export default function SupplyOverview() {
  const [supplies, setSupplies] = useState<Supply[]>([])
  const [searchQuery, setSearchQuery] = useState("")
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchSupplies = async () => {
      try {
        const response = await fetch("/api/supplies")
        const data = await response.json()
        setSupplies(data.supplies || [])
      } catch (error) {
        console.error("Error fetching supplies:", error)
      } finally {
        setLoading(false)
      }
    }

    fetchSupplies()
  }, [])

  const filteredSupplies = supplies.filter((s) => s.name.toLowerCase().includes(searchQuery.toLowerCase()))

  const chartData = supplies.map((s) => ({
    name: s.name.substring(0, 8),
    qty: s.qty,
    expiryDays: s.expiry_days,
  }))

  const expiryDistribution = [
    {
      name: "Urgent (0-2d)",
      value: supplies.filter((s) => s.expiry_days <= 2).length,
    },
    {
      name: "Warning (3-5d)",
      value: supplies.filter((s) => s.expiry_days > 2 && s.expiry_days <= 5).length,
    },
    {
      name: "Normal (6+d)",
      value: supplies.filter((s) => s.expiry_days > 5).length,
    },
  ]

  const COLORS = ["#EF4444", "#EAB308", "#2D7A3E"]

  const getUrgencyColor = (expiryDays: number) => {
    if (expiryDays <= 2) return "bg-red-100 text-red-700 border border-red-300"
    if (expiryDays <= 5) return "bg-yellow-100 text-yellow-700 border border-yellow-300"
    return "bg-emerald-100 text-emerald-700 border border-emerald-300"
  }

  const getUrgencyBg = (expiryDays: number) => {
    if (expiryDays <= 2) return "bg-red-50 border-l-4 border-l-red-500"
    if (expiryDays <= 5) return "bg-yellow-50 border-l-4 border-l-yellow-500"
    return "bg-emerald-50 border-l-4 border-l-primary"
  }

  if (loading) {
    return (
      <Card className="border-0 shadow-md">
        <CardContent className="pt-6">
          <p className="text-center text-muted-foreground">Memuat persediaan...</p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      {/* Summary Stats */}
      <div className="grid md:grid-cols-4 gap-4">
        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20 pb-3">
            <CardTitle className="text-sm">Total Bahan</CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-foreground">{supplies.length}</div>
            <p className="text-xs text-muted-foreground">jenis bahan</p>
          </CardContent>
        </Card>

        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-red-50 to-red-100 border-b border-red-200 pb-3">
            <CardTitle className="text-sm">Urgent</CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-red-600">{supplies.filter((s) => s.expiry_days <= 2).length}</div>
            <p className="text-xs text-muted-foreground">akan segera kadaluarsa</p>
          </CardContent>
        </Card>

        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-yellow-50 to-yellow-100 border-b border-yellow-200 pb-3">
            <CardTitle className="text-sm">Warning</CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-yellow-600">
              {supplies.filter((s) => s.expiry_days > 2 && s.expiry_days <= 5).length}
            </div>
            <p className="text-xs text-muted-foreground">kadaluarsa dalam 3-5 hari</p>
          </CardContent>
        </Card>

        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-emerald-50 to-emerald-100 border-b border-emerald-200 pb-3">
            <CardTitle className="text-sm">Stabil</CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-emerald-600">
              {supplies.filter((s) => s.expiry_days > 5).length}
            </div>
            <p className="text-xs text-muted-foreground">kondisi baik</p>
          </CardContent>
        </Card>
      </div>

      {/* Charts */}
      {chartData.length > 0 && (
        <div className="grid md:grid-cols-2 gap-6">
          {/* Bar Chart */}
          <Card className="border-0 shadow-md">
            <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20">
              <CardTitle>Persediaan per Bahan</CardTitle>
              <CardDescription>Jumlah stok masing-masing bahan</CardDescription>
            </CardHeader>
            <CardContent className="pt-6">
              <ResponsiveContainer width="100%" height={300}>
                <BarChart data={chartData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="hsl(var(--border))" />
                  <XAxis dataKey="name" stroke="hsl(var(--muted-foreground))" />
                  <YAxis stroke="hsl(var(--muted-foreground))" />
                  <Tooltip
                    contentStyle={{
                      backgroundColor: "hsl(var(--background))",
                      border: "1px solid hsl(var(--border))",
                      borderRadius: "8px",
                    }}
                  />
                  <Bar dataKey="qty" fill="#2D7A3E" radius={[8, 8, 0, 0]} />
                </BarChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>

          {/* Pie Chart */}
          <Card className="border-0 shadow-md">
            <CardHeader className="bg-gradient-to-r from-secondary/10 to-amber-50 border-b border-secondary/20">
              <CardTitle>Distribusi Urgensi Kadaluarsa</CardTitle>
              <CardDescription>Status kadaluarsa persediaan</CardDescription>
            </CardHeader>
            <CardContent className="pt-6 flex justify-center">
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={expiryDistribution}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ name, value }) => `${name}: ${value}`}
                    outerRadius={80}
                    fill="#8884d8"
                    dataKey="value"
                  >
                    {expiryDistribution.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        </div>
      )}

      {/* Search and Grid */}
      <Card className="border-0 shadow-md">
        <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20">
          <div className="flex items-center gap-3">
            <div className="bg-primary/20 p-2 rounded-lg">
              <Warehouse className="w-5 h-5 text-primary" />
            </div>
            <div>
              <CardTitle>Daftar Persediaan</CardTitle>
              <CardDescription>Detail semua bahan tersedia</CardDescription>
            </div>
          </div>
        </CardHeader>
        <CardContent className="space-y-4 pt-6">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary" />
            <Input
              placeholder="Cari bahan..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10 border-primary/30 focus:border-primary"
            />
          </div>

          {filteredSupplies.length === 0 ? (
            <Alert className="bg-amber-50 border border-secondary/30">
              <AlertCircle className="h-4 w-4 text-secondary" />
              <AlertDescription className="text-secondary">Tidak ada persediaan tersedia</AlertDescription>
            </Alert>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {filteredSupplies.map((supply) => (
                <div
                  key={supply.id}
                  className={`rounded-lg p-4 space-y-3 hover:shadow-md transition-all border-0 ${getUrgencyBg(supply.expiry_days)}`}
                >
                  <div className="flex justify-between items-start">
                    <div className="flex-1">
                      <p className="font-semibold text-foreground">{supply.name}</p>
                      <p className="text-sm text-muted-foreground">
                        {supply.qty} {supply.unit}
                      </p>
                    </div>
                    <div className="flex flex-col items-end gap-1">
                      <span
                        className={`text-xs px-2 py-1 rounded-full font-semibold ${getUrgencyColor(supply.expiry_days)}`}
                      >
                        {supply.expiry_days}d
                      </span>
                      {supply.expiry_days <= 2 && (
                        <span className="text-xs bg-red-500 text-white px-2 py-1 rounded-full">Urgent</span>
                      )}
                    </div>
                  </div>

                  <div className="space-y-1 border-t border-foreground/10 pt-2">
                    <p className="text-xs text-muted-foreground">
                      <span className="font-semibold">Kondisi:</span> {supply.freshness}
                    </p>
                    <p className="text-xs text-muted-foreground">
                      <span className="font-semibold">Dari:</span> {supply.owner_name}
                    </p>
                  </div>

                  <Button size="sm" className="w-full bg-primary hover:bg-primary/90 text-white font-medium rounded-lg">
                    Lihat Detail
                  </Button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\shared\error-boundary.tsx
==================================================
"use client"

import { Component, type ReactNode } from "react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { AlertTriangle } from "lucide-react"

interface Props {
  children: ReactNode
}

interface State {
  hasError: boolean
  error: Error | null
}

export default class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props)
    this.state = { hasError: false, error: null }
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error }
  }

  render() {
    if (this.state.hasError) {
      return (
        <Alert className="border-l-4 border-l-red-500 bg-red-50">
          <AlertTriangle className="h-4 w-4 text-red-600" />
          <AlertDescription className="text-red-800">Terjadi kesalahan: {this.state.error?.message}</AlertDescription>
        </Alert>
      )
    }

    return this.props.children
  }
}


==================================================
FILENAME: .\frontend_next\components\shared\loading-spinner.tsx
==================================================
"use client"

export default function LoadingSpinner() {
  return (
    <div className="flex items-center justify-center">
      <div className="relative w-8 h-8">
        <div className="absolute inset-0 bg-accent rounded-full opacity-25 animate-pulse"></div>
        <div className="absolute inset-0 border-2 border-transparent border-t-accent border-r-accent rounded-full animate-spin"></div>
      </div>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\ui\accordion.tsx
==================================================
'use client'

import * as React from 'react'
import * as AccordionPrimitive from '@radix-ui/react-accordion'
import { ChevronDownIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn('border-b last:border-b-0', className)}
      {...props}
    />
  )
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          'focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180',
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  )
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn('pt-0 pb-4', className)}>{children}</div>
    </AccordionPrimitive.Content>
  )
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


==================================================
FILENAME: .\frontend_next\components\ui\alert-dialog.tsx
==================================================
'use client'

import * as React from 'react'
import * as AlertDialogPrimitive from '@radix-ui/react-alert-dialog'

import { cn } from '@/lib/utils'
import { buttonVariants } from '@/components/ui/button'

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  )
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  )
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',
        className,
      )}
      {...props}
    />
  )
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg',
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  )
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn('flex flex-col gap-2 text-center sm:text-left', className)}
      {...props}
    />
  )
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        'flex flex-col-reverse gap-2 sm:flex-row sm:justify-end',
        className,
      )}
      {...props}
    />
  )
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn('text-lg font-semibold', className)}
      {...props}
    />
  )
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  )
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: 'outline' }), className)}
      {...props}
    />
  )
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


==================================================
FILENAME: .\frontend_next\components\ui\alert.tsx
==================================================
import * as React from 'react'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const alertVariants = cva(
  'relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current',
  {
    variants: {
      variant: {
        default: 'bg-card text-card-foreground',
        destructive:
          'text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        'col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight',
        className,
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        'text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed',
        className,
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }


==================================================
FILENAME: .\frontend_next\components\ui\aspect-ratio.tsx
==================================================
'use client'

import * as AspectRatioPrimitive from '@radix-ui/react-aspect-ratio'

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />
}

export { AspectRatio }


==================================================
FILENAME: .\frontend_next\components\ui\avatar.tsx
==================================================
'use client'

import * as React from 'react'
import * as AvatarPrimitive from '@radix-ui/react-avatar'

import { cn } from '@/lib/utils'

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        'relative flex size-8 shrink-0 overflow-hidden rounded-full',
        className,
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn('aspect-square size-full', className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        'bg-muted flex size-full items-center justify-center rounded-full',
        className,
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }


==================================================
FILENAME: .\frontend_next\components\ui\badge.tsx
==================================================
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const badgeVariants = cva(
  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',
  {
    variants: {
      variant: {
        default:
          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',
        secondary:
          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',
        destructive:
          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
        outline:
          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<'span'> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'span'

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }


==================================================
FILENAME: .\frontend_next\components\ui\breadcrumb.tsx
==================================================
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { ChevronRight, MoreHorizontal } from 'lucide-react'

import { cn } from '@/lib/utils'

function Breadcrumb({ ...props }: React.ComponentProps<'nav'>) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<'ol'>) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        'text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5',
        className,
      )}
      {...props}
    />
  )
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn('inline-flex items-center gap-1.5', className)}
      {...props}
    />
  )
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<'a'> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : 'a'

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn('hover:text-foreground transition-colors', className)}
      {...props}
    />
  )
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn('text-foreground font-normal', className)}
      {...props}
    />
  )
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn('[&>svg]:size-3.5', className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  )
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn('flex size-9 items-center justify-center', className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  )
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}


==================================================
FILENAME: .\frontend_next\components\ui\button-group.tsx
==================================================
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Separator } from '@/components/ui/separator'

const buttonGroupVariants = cva(
  "flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",
  {
    variants: {
      orientation: {
        horizontal:
          '[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none',
        vertical:
          'flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none',
      },
    },
    defaultVariants: {
      orientation: 'horizontal',
    },
  },
)

function ButtonGroup({
  className,
  orientation,
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof buttonGroupVariants>) {
  return (
    <div
      role="group"
      data-slot="button-group"
      data-orientation={orientation}
      className={cn(buttonGroupVariants({ orientation }), className)}
      {...props}
    />
  )
}

function ButtonGroupText({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<'div'> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : 'div'

  return (
    <Comp
      className={cn(
        "bg-muted flex items-center gap-2 rounded-md border px-4 text-sm font-medium shadow-xs [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function ButtonGroupSeparator({
  className,
  orientation = 'vertical',
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="button-group-separator"
      orientation={orientation}
      className={cn(
        'bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto',
        className,
      )}
      {...props}
    />
  )
}

export {
  ButtonGroup,
  ButtonGroupSeparator,
  ButtonGroupText,
  buttonGroupVariants,
}


==================================================
FILENAME: .\frontend_next\components\ui\button.tsx
==================================================
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: 'bg-primary text-primary-foreground hover:bg-primary/90',
        destructive:
          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',
        outline:
          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',
        secondary:
          'bg-secondary text-secondary-foreground hover:bg-secondary/80',
        ghost:
          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',
        link: 'text-primary underline-offset-4 hover:underline',
      },
      size: {
        default: 'h-9 px-4 py-2 has-[>svg]:px-3',
        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',
        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',
        icon: 'size-9',
        'icon-sm': 'size-8',
        'icon-lg': 'size-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<'button'> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }


==================================================
FILENAME: .\frontend_next\components\ui\calendar.tsx
==================================================
'use client'

import * as React from 'react'
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from 'lucide-react'
import { DayButton, DayPicker, getDefaultClassNames } from 'react-day-picker'

import { cn } from '@/lib/utils'
import { Button, buttonVariants } from '@/components/ui/button'

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = 'label',
  buttonVariant = 'ghost',
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>['variant']
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        'bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent',
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className,
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString('default', { month: 'short' }),
        ...formatters,
      }}
      classNames={{
        root: cn('w-fit', defaultClassNames.root),
        months: cn(
          'flex gap-4 flex-col md:flex-row relative',
          defaultClassNames.months,
        ),
        month: cn('flex flex-col w-full gap-4', defaultClassNames.month),
        nav: cn(
          'flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between',
          defaultClassNames.nav,
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          'size-(--cell-size) aria-disabled:opacity-50 p-0 select-none',
          defaultClassNames.button_previous,
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          'size-(--cell-size) aria-disabled:opacity-50 p-0 select-none',
          defaultClassNames.button_next,
        ),
        month_caption: cn(
          'flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)',
          defaultClassNames.month_caption,
        ),
        dropdowns: cn(
          'w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5',
          defaultClassNames.dropdowns,
        ),
        dropdown_root: cn(
          'relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md',
          defaultClassNames.dropdown_root,
        ),
        dropdown: cn(
          'absolute bg-popover inset-0 opacity-0',
          defaultClassNames.dropdown,
        ),
        caption_label: cn(
          'select-none font-medium',
          captionLayout === 'label'
            ? 'text-sm'
            : 'rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5',
          defaultClassNames.caption_label,
        ),
        table: 'w-full border-collapse',
        weekdays: cn('flex', defaultClassNames.weekdays),
        weekday: cn(
          'text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none',
          defaultClassNames.weekday,
        ),
        week: cn('flex w-full mt-2', defaultClassNames.week),
        week_number_header: cn(
          'select-none w-(--cell-size)',
          defaultClassNames.week_number_header,
        ),
        week_number: cn(
          'text-[0.8rem] select-none text-muted-foreground',
          defaultClassNames.week_number,
        ),
        day: cn(
          'relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none',
          defaultClassNames.day,
        ),
        range_start: cn(
          'rounded-l-md bg-accent',
          defaultClassNames.range_start,
        ),
        range_middle: cn('rounded-none', defaultClassNames.range_middle),
        range_end: cn('rounded-r-md bg-accent', defaultClassNames.range_end),
        today: cn(
          'bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none',
          defaultClassNames.today,
        ),
        outside: cn(
          'text-muted-foreground aria-selected:text-muted-foreground',
          defaultClassNames.outside,
        ),
        disabled: cn(
          'text-muted-foreground opacity-50',
          defaultClassNames.disabled,
        ),
        hidden: cn('invisible', defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === 'left') {
            return (
              <ChevronLeftIcon className={cn('size-4', className)} {...props} />
            )
          }

          if (orientation === 'right') {
            return (
              <ChevronRightIcon
                className={cn('size-4', className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn('size-4', className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        'data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70',
        defaultClassNames.day,
        className,
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }


==================================================
FILENAME: .\frontend_next\components\ui\card.tsx
==================================================
import * as React from 'react'

import { cn } from '@/lib/utils'

function Card({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card"
      className={cn(
        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',
        className,
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',
        className,
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-title"
      className={cn('leading-none font-semibold', className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',
        className,
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-content"
      className={cn('px-6', className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="card-footer"
      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}


==================================================
FILENAME: .\frontend_next\components\ui\carousel.tsx
==================================================
'use client'

import * as React from 'react'
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from 'embla-carousel-react'
import { ArrowLeft, ArrowRight } from 'lucide-react'

import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: 'horizontal' | 'vertical'
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error('useCarousel must be used within a <Carousel />')
  }

  return context
}

function Carousel({
  orientation = 'horizontal',
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<'div'> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === 'horizontal' ? 'x' : 'y',
    },
    plugins,
  )
  const [canScrollPrev, setCanScrollPrev] = React.useState(false)
  const [canScrollNext, setCanScrollNext] = React.useState(false)

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return
    setCanScrollPrev(api.canScrollPrev())
    setCanScrollNext(api.canScrollNext())
  }, [])

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev()
  }, [api])

  const scrollNext = React.useCallback(() => {
    api?.scrollNext()
  }, [api])

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === 'ArrowLeft') {
        event.preventDefault()
        scrollPrev()
      } else if (event.key === 'ArrowRight') {
        event.preventDefault()
        scrollNext()
      }
    },
    [scrollPrev, scrollNext],
  )

  React.useEffect(() => {
    if (!api || !setApi) return
    setApi(api)
  }, [api, setApi])

  React.useEffect(() => {
    if (!api) return
    onSelect(api)
    api.on('reInit', onSelect)
    api.on('select', onSelect)

    return () => {
      api?.off('select', onSelect)
    }
  }, [api, onSelect])

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === 'y' ? 'vertical' : 'horizontal'),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn('relative', className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  )
}

function CarouselContent({ className, ...props }: React.ComponentProps<'div'>) {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          'flex',
          orientation === 'horizontal' ? '-ml-4' : '-mt-4 flex-col',
          className,
        )}
        {...props}
      />
    </div>
  )
}

function CarouselItem({ className, ...props }: React.ComponentProps<'div'>) {
  const { orientation } = useCarousel()

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        'min-w-0 shrink-0 grow-0 basis-full',
        orientation === 'horizontal' ? 'pl-4' : 'pt-4',
        className,
      )}
      {...props}
    />
  )
}

function CarouselPrevious({
  className,
  variant = 'outline',
  size = 'icon',
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        'absolute size-8 rounded-full',
        orientation === 'horizontal'
          ? 'top-1/2 -left-12 -translate-y-1/2'
          : '-top-12 left-1/2 -translate-x-1/2 rotate-90',
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
}

function CarouselNext({
  className,
  variant = 'outline',
  size = 'icon',
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        'absolute size-8 rounded-full',
        orientation === 'horizontal'
          ? 'top-1/2 -right-12 -translate-y-1/2'
          : '-bottom-12 left-1/2 -translate-x-1/2 rotate-90',
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  )
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}


==================================================
FILENAME: .\frontend_next\components\ui\chart.tsx
==================================================
'use client'

import * as React from 'react'
import * as RechartsPrimitive from 'recharts'

import { cn } from '@/lib/utils'

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: '', dark: '.dark' } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error('useChart must be used within a <ChartContainer />')
  }

  return context
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<'div'> & {
  config: ChartConfig
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >['children']
}) {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, '')}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        // @ts-ignore
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color,
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
                .map(([key, itemConfig]) => {
                  const color =
                    itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
                    itemConfig.color
                  return color ? `  --color-${key}: ${color};` : null
                })
                .join('\n')}
}
`,
          )
          .join('\n'),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = 'dot',
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> & React.ComponentProps<'div'> & any) {
  const { config } = useChart()

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null
    }

    const [item] = payload
    const key = `${labelKey || item?.dataKey || item?.name || 'value'}`
    const itemConfig = getPayloadConfigFromPayload(config, item, key)
    const value =
      !labelKey && typeof label === 'string'
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label

    if (labelFormatter) {
      return (
        <div className={cn('font-medium', labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      )
    }

    if (!value) {
      return null
    }

    return <div className={cn('font-medium', labelClassName)}>{value}</div>
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ])

  if (!active || !payload?.length) {
    return null
  }

  const nestLabel = payload.length === 1 && indicator !== 'dot'

  return (
    <div
      className={cn(
        'border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl',
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item: any, index: number) => {
          const key = `${nameKey || item.name || item.dataKey || 'value'}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)
          const indicatorColor = color || item.payload.fill || item.color

          return (
            <div
              key={item.dataKey}
              className={cn(
                '[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5',
                indicator === 'dot' && 'items-center',
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          'shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)',
                          {
                            'h-2.5 w-2.5': indicator === 'dot',
                            'w-1': indicator === 'line',
                            'w-0 border-[1.5px] border-dashed bg-transparent':
                              indicator === 'dashed',
                            'my-0.5': nestLabel && indicator === 'dashed',
                          },
                        )}
                        style={
                          {
                            '--color-bg': indicatorColor,
                            '--color-border': indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      'flex flex-1 justify-between leading-none',
                      nestLabel ? 'items-end' : 'items-center',
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          )
        })}
      </div>
    </div>
  )
}

const ChartLegend = RechartsPrimitive.Legend

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = 'bottom',
  nameKey,
}: React.ComponentProps<'div'> & any) {
  const { config } = useChart()

  if (!payload?.length) {
    return null
  }

  return (
    <div
      className={cn(
        'flex items-center justify-center gap-4',
        verticalAlign === 'top' ? 'pb-3' : 'pt-3',
        className,
      )}
    >
      {payload.map((item: any) => {
        const key = `${nameKey || item.dataKey || 'value'}`
        const itemConfig = getPayloadConfigFromPayload(config, item, key)

        return (
          <div
            key={item.value}
            className={
              '[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3'
            }
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        )
      })}
    </div>
  )
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string,
) {
  if (typeof payload !== 'object' || payload === null) {
    return undefined
  }

  const payloadPayload =
    'payload' in payload &&
      typeof payload.payload === 'object' &&
      payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === 'string'
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === 'string'
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}


==================================================
FILENAME: .\frontend_next\components\ui\checkbox.tsx
==================================================
'use client'

import * as React from 'react'
import * as CheckboxPrimitive from '@radix-ui/react-checkbox'
import { CheckIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        'peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }


==================================================
FILENAME: .\frontend_next\components\ui\collapsible.tsx
==================================================
'use client'

import * as CollapsiblePrimitive from '@radix-ui/react-collapsible'

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  )
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  )
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent }


==================================================
FILENAME: .\frontend_next\components\ui\command.tsx
==================================================
'use client'

import * as React from 'react'
import { Command as CommandPrimitive } from 'cmdk'
import { SearchIcon } from 'lucide-react'

import { cn } from '@/lib/utils'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        'bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md',
        className,
      )}
      {...props}
    />
  )
}

function CommandDialog({
  title = 'Command Palette',
  description = 'Search for a command to run...',
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string
  description?: string
  className?: string
  showCloseButton?: boolean
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn('overflow-hidden p-0', className)}
        showCloseButton={showCloseButton}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          'placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50',
          className,
        )}
        {...props}
      />
    </div>
  )
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        'max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto',
        className,
      )}
      {...props}
    />
  )
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  )
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        'text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium',
        className,
      )}
      {...props}
    />
  )
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn('bg-border -mx-1 h-px', className)}
      {...props}
    />
  )
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


==================================================
FILENAME: .\frontend_next\components\ui\context-menu.tsx
==================================================
'use client'

import * as React from 'react'
import * as ContextMenuPrimitive from '@radix-ui/react-context-menu'
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  )
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  )
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  )
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  )
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  )
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg',
        className,
      )}
      {...props}
    />
  )
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md',
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  )
}

function ContextMenuItem({
  className,
  inset,
  variant = 'default',
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean
  variant?: 'default' | 'destructive'
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  )
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  )
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        'text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',
        className,
      )}
      {...props}
    />
  )
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn('bg-border -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}


==================================================
FILENAME: .\frontend_next\components\ui\dialog.tsx
==================================================
'use client'

import * as React from 'react'
import * as DialogPrimitive from '@radix-ui/react-dialog'
import { XIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',
        className,
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg',
          className,
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="dialog-header"
      className={cn('flex flex-col gap-2 text-center sm:text-left', className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        'flex flex-col-reverse gap-2 sm:flex-row sm:justify-end',
        className,
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn('text-lg leading-none font-semibold', className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}


==================================================
FILENAME: .\frontend_next\components\ui\drawer.tsx
==================================================
'use client'

import * as React from 'react'
import { Drawer as DrawerPrimitive } from 'vaul'

import { cn } from '@/lib/utils'

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',
        className,
      )}
      {...props}
    />
  )
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          'group/drawer-content bg-background fixed z-50 flex h-auto flex-col',
          'data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b',
          'data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t',
          'data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm',
          'data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm',
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  )
}

function DrawerHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        'flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left',
        className,
      )}
      {...props}
    />
  )
}

function DrawerFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn('mt-auto flex flex-col gap-2 p-4', className)}
      {...props}
    />
  )
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn('text-foreground font-semibold', className)}
      {...props}
    />
  )
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}


==================================================
FILENAME: .\frontend_next\components\ui\dropdown-menu.tsx
==================================================
'use client'

import * as React from 'react'
import * as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu'
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md',
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = 'default',
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: 'default' | 'destructive'
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        'px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',
        className,
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn('bg-border -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg',
        className,
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}


==================================================
FILENAME: .\frontend_next\components\ui\empty.tsx
==================================================
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

function Empty({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty"
      className={cn(
        'flex min-w-0 flex-1 flex-col items-center justify-center gap-6 rounded-lg border-dashed p-6 text-center text-balance md:p-12',
        className,
      )}
      {...props}
    />
  )
}

function EmptyHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty-header"
      className={cn(
        'flex max-w-sm flex-col items-center gap-2 text-center',
        className,
      )}
      {...props}
    />
  )
}

const emptyMediaVariants = cva(
  'flex shrink-0 items-center justify-center mb-2 [&_svg]:pointer-events-none [&_svg]:shrink-0',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        icon: "bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6",
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function EmptyMedia({
  className,
  variant = 'default',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof emptyMediaVariants>) {
  return (
    <div
      data-slot="empty-icon"
      data-variant={variant}
      className={cn(emptyMediaVariants({ variant, className }))}
      {...props}
    />
  )
}

function EmptyTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty-title"
      className={cn('text-lg font-medium tracking-tight', className)}
      {...props}
    />
  )
}

function EmptyDescription({ className, ...props }: React.ComponentProps<'p'>) {
  return (
    <div
      data-slot="empty-description"
      className={cn(
        'text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4',
        className,
      )}
      {...props}
    />
  )
}

function EmptyContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="empty-content"
      className={cn(
        'flex w-full max-w-sm min-w-0 flex-col items-center gap-4 text-sm text-balance',
        className,
      )}
      {...props}
    />
  )
}

export {
  Empty,
  EmptyHeader,
  EmptyTitle,
  EmptyDescription,
  EmptyContent,
  EmptyMedia,
}


==================================================
FILENAME: .\frontend_next\components\ui\field.tsx
==================================================
'use client'

import { useMemo } from 'react'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Label } from '@/components/ui/label'
import { Separator } from '@/components/ui/separator'

function FieldSet({ className, ...props }: React.ComponentProps<'fieldset'>) {
  return (
    <fieldset
      data-slot="field-set"
      className={cn(
        'flex flex-col gap-6',
        'has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3',
        className,
      )}
      {...props}
    />
  )
}

function FieldLegend({
  className,
  variant = 'legend',
  ...props
}: React.ComponentProps<'legend'> & { variant?: 'legend' | 'label' }) {
  return (
    <legend
      data-slot="field-legend"
      data-variant={variant}
      className={cn(
        'mb-3 font-medium',
        'data-[variant=legend]:text-base',
        'data-[variant=label]:text-sm',
        className,
      )}
      {...props}
    />
  )
}

function FieldGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="field-group"
      className={cn(
        'group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4',
        className,
      )}
      {...props}
    />
  )
}

const fieldVariants = cva(
  'group/field flex w-full gap-3 data-[invalid=true]:text-destructive',
  {
    variants: {
      orientation: {
        vertical: ['flex-col [&>*]:w-full [&>.sr-only]:w-auto'],
        horizontal: [
          'flex-row items-center',
          '[&>[data-slot=field-label]]:flex-auto',
          'has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px',
        ],
        responsive: [
          'flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto',
          '@md/field-group:[&>[data-slot=field-label]]:flex-auto',
          '@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px',
        ],
      },
    },
    defaultVariants: {
      orientation: 'vertical',
    },
  },
)

function Field({
  className,
  orientation = 'vertical',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof fieldVariants>) {
  return (
    <div
      role="group"
      data-slot="field"
      data-orientation={orientation}
      className={cn(fieldVariants({ orientation }), className)}
      {...props}
    />
  )
}

function FieldContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="field-content"
      className={cn(
        'group/field-content flex flex-1 flex-col gap-1.5 leading-snug',
        className,
      )}
      {...props}
    />
  )
}

function FieldLabel({
  className,
  ...props
}: React.ComponentProps<typeof Label>) {
  return (
    <Label
      data-slot="field-label"
      className={cn(
        'group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50',
        'has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4',
        'has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10',
        className,
      )}
      {...props}
    />
  )
}

function FieldTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="field-label"
      className={cn(
        'flex w-fit items-center gap-2 text-sm leading-snug font-medium group-data-[disabled=true]/field:opacity-50',
        className,
      )}
      {...props}
    />
  )
}

function FieldDescription({ className, ...props }: React.ComponentProps<'p'>) {
  return (
    <p
      data-slot="field-description"
      className={cn(
        'text-muted-foreground text-sm leading-normal font-normal group-has-[[data-orientation=horizontal]]/field:text-balance',
        'last:mt-0 nth-last-2:-mt-1 [[data-variant=legend]+&]:-mt-1.5',
        '[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4',
        className,
      )}
      {...props}
    />
  )
}

function FieldSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<'div'> & {
  children?: React.ReactNode
}) {
  return (
    <div
      data-slot="field-separator"
      data-content={!!children}
      className={cn(
        'relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2',
        className,
      )}
      {...props}
    >
      <Separator className="absolute inset-0 top-1/2" />
      {children && (
        <span
          className="bg-background text-muted-foreground relative mx-auto block w-fit px-2"
          data-slot="field-separator-content"
        >
          {children}
        </span>
      )}
    </div>
  )
}

function FieldError({
  className,
  children,
  errors,
  ...props
}: React.ComponentProps<'div'> & {
  errors?: Array<{ message?: string } | undefined>
}) {
  const content = useMemo(() => {
    if (children) {
      return children
    }

    if (!errors) {
      return null
    }

    if (errors.length === 1 && errors[0]?.message) {
      return errors[0].message
    }

    return (
      <ul className="ml-4 flex list-disc flex-col gap-1">
        {errors.map(
          (error, index) =>
            error?.message && <li key={index}>{error.message}</li>,
        )}
      </ul>
    )
  }, [children, errors])

  if (!content) {
    return null
  }

  return (
    <div
      role="alert"
      data-slot="field-error"
      className={cn('text-destructive text-sm font-normal', className)}
      {...props}
    >
      {content}
    </div>
  )
}

export {
  Field,
  FieldLabel,
  FieldDescription,
  FieldError,
  FieldGroup,
  FieldLegend,
  FieldSeparator,
  FieldSet,
  FieldContent,
  FieldTitle,
}


==================================================
FILENAME: .\frontend_next\components\ui\form.tsx
==================================================
'use client'

import * as React from 'react'
import * as LabelPrimitive from '@radix-ui/react-label'
import { Slot } from '@radix-ui/react-slot'
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from 'react-hook-form'

import { cn } from '@/lib/utils'
import { Label } from '@/components/ui/label'

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState } = useFormContext()
  const formState = useFormState({ name: fieldContext.name })
  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error('useFormField should be used within <FormField>')
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
)

function FormItem({ className, ...props }: React.ComponentProps<'div'>) {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn('grid gap-2', className)}
        {...props}
      />
    </FormItemContext.Provider>
  )
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField()

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn('data-[error=true]:text-destructive', className)}
      htmlFor={formItemId}
      {...props}
    />
  )
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
}

function FormDescription({ className, ...props }: React.ComponentProps<'p'>) {
  const { formDescriptionId } = useFormField()

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

function FormMessage({ className, ...props }: React.ComponentProps<'p'>) {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? '') : props.children

  if (!body) {
    return null
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn('text-destructive text-sm', className)}
      {...props}
    >
      {body}
    </p>
  )
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


==================================================
FILENAME: .\frontend_next\components\ui\hover-card.tsx
==================================================
'use client'

import * as React from 'react'
import * as HoverCardPrimitive from '@radix-ui/react-hover-card'

import { cn } from '@/lib/utils'

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  )
}

function HoverCardContent({
  className,
  align = 'center',
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden',
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  )
}

export { HoverCard, HoverCardTrigger, HoverCardContent }


==================================================
FILENAME: .\frontend_next\components\ui\input-group.tsx
==================================================
'use client'

import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'

function InputGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="input-group"
      role="group"
      className={cn(
        'group/input-group border-input dark:bg-input/30 relative flex w-full items-center rounded-md border shadow-xs transition-[color,box-shadow] outline-none',
        'h-9 has-[>textarea]:h-auto',

        // Variants based on alignment.
        'has-[>[data-align=inline-start]]:[&>input]:pl-2',
        'has-[>[data-align=inline-end]]:[&>input]:pr-2',
        'has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3',
        'has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3',

        // Focus state.
        'has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]',

        // Error state.
        'has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40',

        className,
      )}
      {...props}
    />
  )
}

const inputGroupAddonVariants = cva(
  "text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",
  {
    variants: {
      align: {
        'inline-start':
          'order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]',
        'inline-end':
          'order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]',
        'block-start':
          'order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5',
        'block-end':
          'order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5',
      },
    },
    defaultVariants: {
      align: 'inline-start',
    },
  },
)

function InputGroupAddon({
  className,
  align = 'inline-start',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof inputGroupAddonVariants>) {
  return (
    <div
      role="group"
      data-slot="input-group-addon"
      data-align={align}
      className={cn(inputGroupAddonVariants({ align }), className)}
      onClick={(e) => {
        if ((e.target as HTMLElement).closest('button')) {
          return
        }
        e.currentTarget.parentElement?.querySelector('input')?.focus()
      }}
      {...props}
    />
  )
}

const inputGroupButtonVariants = cva(
  'text-sm shadow-none flex gap-2 items-center',
  {
    variants: {
      size: {
        xs: "h-6 gap-1 px-2 rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-3.5 has-[>svg]:px-2",
        sm: 'h-8 px-2.5 gap-1.5 rounded-md has-[>svg]:px-2.5',
        'icon-xs':
          'size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0',
        'icon-sm': 'size-8 p-0 has-[>svg]:p-0',
      },
    },
    defaultVariants: {
      size: 'xs',
    },
  },
)

function InputGroupButton({
  className,
  type = 'button',
  variant = 'ghost',
  size = 'xs',
  ...props
}: Omit<React.ComponentProps<typeof Button>, 'size'> &
  VariantProps<typeof inputGroupButtonVariants>) {
  return (
    <Button
      type={type}
      data-size={size}
      variant={variant}
      className={cn(inputGroupButtonVariants({ size }), className)}
      {...props}
    />
  )
}

function InputGroupText({ className, ...props }: React.ComponentProps<'span'>) {
  return (
    <span
      className={cn(
        "text-muted-foreground flex items-center gap-2 text-sm [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function InputGroupInput({
  className,
  ...props
}: React.ComponentProps<'input'>) {
  return (
    <Input
      data-slot="input-group-control"
      className={cn(
        'flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent',
        className,
      )}
      {...props}
    />
  )
}

function InputGroupTextarea({
  className,
  ...props
}: React.ComponentProps<'textarea'>) {
  return (
    <Textarea
      data-slot="input-group-control"
      className={cn(
        'flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent',
        className,
      )}
      {...props}
    />
  )
}

export {
  InputGroup,
  InputGroupAddon,
  InputGroupButton,
  InputGroupText,
  InputGroupInput,
  InputGroupTextarea,
}


==================================================
FILENAME: .\frontend_next\components\ui\input-otp.tsx
==================================================
'use client'

import * as React from 'react'
import { OTPInput, OTPInputContext } from 'input-otp'
import { MinusIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        'flex items-center gap-2 has-disabled:opacity-50',
        containerClassName,
      )}
      className={cn('disabled:cursor-not-allowed', className)}
      {...props}
    />
  )
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn('flex items-center', className)}
      {...props}
    />
  )
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<'div'> & {
  index: number
}) {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {}

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        'data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]',
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  )
}

function InputOTPSeparator({ ...props }: React.ComponentProps<'div'>) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  )
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }


==================================================
FILENAME: .\frontend_next\components\ui\input.tsx
==================================================
import * as React from 'react'

import { cn } from '@/lib/utils'

function Input({ className, type, ...props }: React.ComponentProps<'input'>) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',
        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',
        className,
      )}
      {...props}
    />
  )
}

export { Input }


==================================================
FILENAME: .\frontend_next\components\ui\item.tsx
==================================================
import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { Separator } from '@/components/ui/separator'

function ItemGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      role="list"
      data-slot="item-group"
      className={cn('group/item-group flex flex-col', className)}
      {...props}
    />
  )
}

function ItemSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="item-separator"
      orientation="horizontal"
      className={cn('my-0', className)}
      {...props}
    />
  )
}

const itemVariants = cva(
  'group/item flex items-center border border-transparent text-sm rounded-md transition-colors [a&]:hover:bg-accent/50 [a&]:transition-colors duration-100 flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        outline: 'border-border',
        muted: 'bg-muted/50',
      },
      size: {
        default: 'p-4 gap-4 ',
        sm: 'py-3 px-4 gap-2.5',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Item({
  className,
  variant = 'default',
  size = 'default',
  asChild = false,
  ...props
}: React.ComponentProps<'div'> &
  VariantProps<typeof itemVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'div'
  return (
    <Comp
      data-slot="item"
      data-variant={variant}
      data-size={size}
      className={cn(itemVariants({ variant, size, className }))}
      {...props}
    />
  )
}

const itemMediaVariants = cva(
  'flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none group-has-[[data-slot=item-description]]/item:translate-y-0.5',
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        icon: "size-8 border rounded-sm bg-muted [&_svg:not([class*='size-'])]:size-4",
        image:
          'size-10 rounded-sm overflow-hidden [&_img]:size-full [&_img]:object-cover',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

function ItemMedia({
  className,
  variant = 'default',
  ...props
}: React.ComponentProps<'div'> & VariantProps<typeof itemMediaVariants>) {
  return (
    <div
      data-slot="item-media"
      data-variant={variant}
      className={cn(itemMediaVariants({ variant, className }))}
      {...props}
    />
  )
}

function ItemContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-content"
      className={cn(
        'flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none',
        className,
      )}
      {...props}
    />
  )
}

function ItemTitle({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-title"
      className={cn(
        'flex w-fit items-center gap-2 text-sm leading-snug font-medium',
        className,
      )}
      {...props}
    />
  )
}

function ItemDescription({ className, ...props }: React.ComponentProps<'p'>) {
  return (
    <p
      data-slot="item-description"
      className={cn(
        'text-muted-foreground line-clamp-2 text-sm leading-normal font-normal text-balance',
        '[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4',
        className,
      )}
      {...props}
    />
  )
}

function ItemActions({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-actions"
      className={cn('flex items-center gap-2', className)}
      {...props}
    />
  )
}

function ItemHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-header"
      className={cn(
        'flex basis-full items-center justify-between gap-2',
        className,
      )}
      {...props}
    />
  )
}

function ItemFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="item-footer"
      className={cn(
        'flex basis-full items-center justify-between gap-2',
        className,
      )}
      {...props}
    />
  )
}

export {
  Item,
  ItemMedia,
  ItemContent,
  ItemActions,
  ItemGroup,
  ItemSeparator,
  ItemTitle,
  ItemDescription,
  ItemHeader,
  ItemFooter,
}


==================================================
FILENAME: .\frontend_next\components\ui\kbd.tsx
==================================================
import { cn } from '@/lib/utils'

function Kbd({ className, ...props }: React.ComponentProps<'kbd'>) {
  return (
    <kbd
      data-slot="kbd"
      className={cn(
        'bg-muted w-fit text-muted-foreground pointer-events-none inline-flex h-5 min-w-5 items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium select-none',
        "[&_svg:not([class*='size-'])]:size-3",
        '[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10',
        className,
      )}
      {...props}
    />
  )
}

function KbdGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <kbd
      data-slot="kbd-group"
      className={cn('inline-flex items-center gap-1', className)}
      {...props}
    />
  )
}

export { Kbd, KbdGroup }


==================================================
FILENAME: .\frontend_next\components\ui\label.tsx
==================================================
'use client'

import * as React from 'react'
import * as LabelPrimitive from '@radix-ui/react-label'

import { cn } from '@/lib/utils'

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        'flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',
        className,
      )}
      {...props}
    />
  )
}

export { Label }


==================================================
FILENAME: .\frontend_next\components\ui\menubar.tsx
==================================================
'use client'

import * as React from 'react'
import * as MenubarPrimitive from '@radix-ui/react-menubar'
import { CheckIcon, ChevronRightIcon, CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        'bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs',
        className,
      )}
      {...props}
    />
  )
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  )
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        'focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none',
        className,
      )}
      {...props}
    />
  )
}

function MenubarContent({
  className,
  align = 'start',
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md',
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  )
}

function MenubarItem({
  className,
  inset,
  variant = 'default',
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean
  variant?: 'default' | 'destructive'
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  )
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  )
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        'px-2 py-1.5 text-sm font-medium data-[inset]:pl-8',
        className,
      )}
      {...props}
    />
  )
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn('bg-border -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        'text-muted-foreground ml-auto text-xs tracking-widest',
        className,
      )}
      {...props}
    />
  )
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        'focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8',
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  )
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg',
        className,
      )}
      {...props}
    />
  )
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
}


==================================================
FILENAME: .\frontend_next\components\ui\navigation-menu.tsx
==================================================
import * as React from 'react'
import * as NavigationMenuPrimitive from '@radix-ui/react-navigation-menu'
import { cva } from 'class-variance-authority'
import { ChevronDownIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        'group/navigation-menu relative flex max-w-max flex-1 items-center justify-center',
        className,
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  )
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        'group flex flex-1 list-none items-center justify-center gap-1',
        className,
      )}
      {...props}
    />
  )
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn('relative', className)}
      {...props}
    />
  )
}

const navigationMenuTriggerStyle = cva(
  'group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1',
)

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), 'group', className)}
      {...props}
    >
      {children}{' '}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  )
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        'data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto',
        'group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none',
        className,
      )}
      {...props}
    />
  )
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={'absolute top-full left-0 isolate z-50 flex justify-center'}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          'origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]',
          className,
        )}
        {...props}
      />
    </div>
  )
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        'data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden',
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  )
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
}


==================================================
FILENAME: .\frontend_next\components\ui\pagination.tsx
==================================================
import * as React from 'react'
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from 'lucide-react'

import { cn } from '@/lib/utils'
import { Button, buttonVariants } from '@/components/ui/button'

function Pagination({ className, ...props }: React.ComponentProps<'nav'>) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn('mx-auto flex w-full justify-center', className)}
      {...props}
    />
  )
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<'ul'>) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn('flex flex-row items-center gap-1', className)}
      {...props}
    />
  )
}

function PaginationItem({ ...props }: React.ComponentProps<'li'>) {
  return <li data-slot="pagination-item" {...props} />
}

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<React.ComponentProps<typeof Button>, 'size'> &
  React.ComponentProps<'a'>

function PaginationLink({
  className,
  isActive,
  size = 'icon',
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? 'page' : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? 'outline' : 'ghost',
          size,
        }),
        className,
      )}
      {...props}
    />
  )
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn('gap-1 px-2.5 sm:pl-2.5', className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  )
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn('gap-1 px-2.5 sm:pr-2.5', className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  )
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<'span'>) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn('flex size-9 items-center justify-center', className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  )
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}


==================================================
FILENAME: .\frontend_next\components\ui\popover.tsx
==================================================
'use client'

import * as React from 'react'
import * as PopoverPrimitive from '@radix-ui/react-popover'

import { cn } from '@/lib/utils'

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
}

function PopoverContent({
  className,
  align = 'center',
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden',
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  )
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }


==================================================
FILENAME: .\frontend_next\components\ui\progress.tsx
==================================================
'use client'

import * as React from 'react'
import * as ProgressPrimitive from '@radix-ui/react-progress'

import { cn } from '@/lib/utils'

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        'bg-primary/20 relative h-2 w-full overflow-hidden rounded-full',
        className,
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  )
}

export { Progress }


==================================================
FILENAME: .\frontend_next\components\ui\radio-group.tsx
==================================================
'use client'

import * as React from 'react'
import * as RadioGroupPrimitive from '@radix-ui/react-radio-group'
import { CircleIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn('grid gap-3', className)}
      {...props}
    />
  )
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        'border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
}

export { RadioGroup, RadioGroupItem }


==================================================
FILENAME: .\frontend_next\components\ui\resizable.tsx
==================================================
'use client'

import * as React from 'react'
import { GripVerticalIcon } from 'lucide-react'
import * as ResizablePrimitive from 'react-resizable-panels'

import { cn } from '@/lib/utils'

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        'flex h-full w-full data-[panel-group-direction=vertical]:flex-col',
        className,
      )}
      {...props}
    />
  )
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        'bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90',
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  )
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }


==================================================
FILENAME: .\frontend_next\components\ui\scroll-area.tsx
==================================================
'use client'

import * as React from 'react'
import * as ScrollAreaPrimitive from '@radix-ui/react-scroll-area'

import { cn } from '@/lib/utils'

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn('relative', className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = 'vertical',
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        'flex touch-none p-px transition-colors select-none',
        orientation === 'vertical' &&
          'h-full w-2.5 border-l border-l-transparent',
        orientation === 'horizontal' &&
          'h-2.5 flex-col border-t border-t-transparent',
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }


==================================================
FILENAME: .\frontend_next\components\ui\select.tsx
==================================================
'use client'

import * as React from 'react'
import * as SelectPrimitive from '@radix-ui/react-select'
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = 'default',
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: 'sm' | 'default'
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = 'popper',
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          'bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md',
          position === 'popper' &&
            'data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1',
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            'p-1',
            position === 'popper' &&
              'h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1',
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn('text-muted-foreground px-2 py-1.5 text-xs', className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn('bg-border pointer-events-none -mx-1 my-1 h-px', className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        'flex cursor-default items-center justify-center py-1',
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        'flex cursor-default items-center justify-center py-1',
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}


==================================================
FILENAME: .\frontend_next\components\ui\separator.tsx
==================================================
'use client'

import * as React from 'react'
import * as SeparatorPrimitive from '@radix-ui/react-separator'

import { cn } from '@/lib/utils'

function Separator({
  className,
  orientation = 'horizontal',
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        'bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px',
        className,
      )}
      {...props}
    />
  )
}

export { Separator }


==================================================
FILENAME: .\frontend_next\components\ui\sheet.tsx
==================================================
'use client'

import * as React from 'react'
import * as SheetPrimitive from '@radix-ui/react-dialog'
import { XIcon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',
        className,
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = 'right',
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: 'top' | 'right' | 'bottom' | 'left'
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500',
          side === 'right' &&
            'data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm',
          side === 'left' &&
            'data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm',
          side === 'top' &&
            'data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b',
          side === 'bottom' &&
            'data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t',
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sheet-header"
      className={cn('flex flex-col gap-1.5 p-4', className)}
      {...props}
    />
  )
}

function SheetFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn('mt-auto flex flex-col gap-2 p-4', className)}
      {...props}
    />
  )
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn('text-foreground font-semibold', className)}
      {...props}
    />
  )
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn('text-muted-foreground text-sm', className)}
      {...props}
    />
  )
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}


==================================================
FILENAME: .\frontend_next\components\ui\sidebar.tsx
==================================================
'use client'

import * as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, VariantProps } from 'class-variance-authority'
import { PanelLeftIcon } from 'lucide-react'

import { useIsMobile } from '@/hooks/use-mobile'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Separator } from '@/components/ui/separator'
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from '@/components/ui/sheet'
import { Skeleton } from '@/components/ui/skeleton'
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip'

const SIDEBAR_COOKIE_NAME = 'sidebar_state'
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = '16rem'
const SIDEBAR_WIDTH_MOBILE = '18rem'
const SIDEBAR_WIDTH_ICON = '3rem'
const SIDEBAR_KEYBOARD_SHORTCUT = 'b'

type SidebarContextProps = {
  state: 'expanded' | 'collapsed'
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error('useSidebar must be used within a SidebarProvider.')
  }

  return context
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<'div'> & {
  defaultOpen?: boolean
  open?: boolean
  onOpenChange?: (open: boolean) => void
}) {
  const isMobile = useIsMobile()
  const [openMobile, setOpenMobile] = React.useState(false)

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen)
  const open = openProp ?? _open
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === 'function' ? value(open) : value
      if (setOpenProp) {
        setOpenProp(openState)
      } else {
        _setOpen(openState)
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
    },
    [setOpenProp, open],
  )

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)
  }, [isMobile, setOpen, setOpenMobile])

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault()
        toggleSidebar()
      }
    }

    window.addEventListener('keydown', handleKeyDown)
    return () => window.removeEventListener('keydown', handleKeyDown)
  }, [toggleSidebar])

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? 'expanded' : 'collapsed'

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  )

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              '--sidebar-width': SIDEBAR_WIDTH,
              '--sidebar-width-icon': SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            'group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full',
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  )
}

function Sidebar({
  side = 'left',
  variant = 'sidebar',
  collapsible = 'offcanvas',
  className,
  children,
  ...props
}: React.ComponentProps<'div'> & {
  side?: 'left' | 'right'
  variant?: 'sidebar' | 'floating' | 'inset'
  collapsible?: 'offcanvas' | 'icon' | 'none'
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

  if (collapsible === 'none') {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          'bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col',
          className,
        )}
        {...props}
      >
        {children}
      </div>
    )
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              '--sidebar-width': SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    )
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === 'collapsed' ? collapsible : ''}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          'relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear',
          'group-data-[collapsible=offcanvas]:w-0',
          'group-data-[side=right]:rotate-180',
          variant === 'floating' || variant === 'inset'
            ? 'group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]'
            : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon)',
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          'fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex',
          side === 'left'
            ? 'left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]'
            : 'right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]',
          // Adjust the padding for floating and inset variants.
          variant === 'floating' || variant === 'inset'
            ? 'p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]'
            : 'group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l',
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  )
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn('size-7', className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
}

function SidebarRail({ className, ...props }: React.ComponentProps<'button'>) {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        'hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex',
        'in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize',
        '[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize',
        'hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full',
        '[[data-side=left][data-collapsible=offcanvas]_&]:-right-2',
        '[[data-side=right][data-collapsible=offcanvas]_&]:-left-2',
        className,
      )}
      {...props}
    />
  )
}

function SidebarInset({ className, ...props }: React.ComponentProps<'main'>) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        'bg-background relative flex w-full flex-1 flex-col',
        'md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2',
        className,
      )}
      {...props}
    />
  )
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn('bg-background h-8 w-full shadow-none', className)}
      {...props}
    />
  )
}

function SidebarHeader({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn('flex flex-col gap-2 p-2', className)}
      {...props}
    />
  )
}

function SidebarFooter({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn('flex flex-col gap-2 p-2', className)}
      {...props}
    />
  )
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn('bg-sidebar-border mx-2 w-auto', className)}
      {...props}
    />
  )
}

function SidebarContent({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        'flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarGroup({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn('relative flex w-full min-w-0 flex-col p-2', className)}
      {...props}
    />
  )
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<'div'> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'div'

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        'text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
        'group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0',
        className,
      )}
      {...props}
    />
  )
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<'button'> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
        // Increases the hit area of the button on mobile.
        'after:absolute after:-inset-2 md:after:hidden',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn('w-full text-sm', className)}
      {...props}
    />
  )
}

function SidebarMenu({ className, ...props }: React.ComponentProps<'ul'>) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn('flex w-full min-w-0 flex-col gap-1', className)}
      {...props}
    />
  )
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn('group/menu-item relative', className)}
      {...props}
    />
  )
}

const sidebarMenuButtonVariants = cva(
  'peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',
  {
    variants: {
      variant: {
        default: 'hover:bg-sidebar-accent hover:text-sidebar-accent-foreground',
        outline:
          'bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]',
      },
      size: {
        default: 'h-8 text-sm',
        sm: 'h-7 text-xs',
        lg: 'h-12 text-sm group-data-[collapsible=icon]:p-0!',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = 'default',
  size = 'default',
  tooltip,
  className,
  ...props
}: React.ComponentProps<'button'> & {
  asChild?: boolean
  isActive?: boolean
  tooltip?: string | React.ComponentProps<typeof TooltipContent>
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : 'button'
  const { isMobile, state } = useSidebar()

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  )

  if (!tooltip) {
    return button
  }

  if (typeof tooltip === 'string') {
    tooltip = {
      children: tooltip,
    }
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== 'collapsed' || isMobile}
        {...tooltip}
      />
    </Tooltip>
  )
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<'button'> & {
  asChild?: boolean
  showOnHover?: boolean
}) {
  const Comp = asChild ? Slot : 'button'

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0',
        // Increases the hit area of the button on mobile.
        'after:absolute after:-inset-2 md:after:hidden',
        'peer-data-[size=sm]/menu-button:top-1',
        'peer-data-[size=default]/menu-button:top-1.5',
        'peer-data-[size=lg]/menu-button:top-2.5',
        'group-data-[collapsible=icon]:hidden',
        showOnHover &&
          'peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0',
        className,
      )}
      {...props}
    />
  )
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        'text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none',
        'peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground',
        'peer-data-[size=sm]/menu-button:top-1',
        'peer-data-[size=default]/menu-button:top-1.5',
        'peer-data-[size=lg]/menu-button:top-2.5',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<'div'> & {
  showIcon?: boolean
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn('flex h-8 items-center gap-2 rounded-md px-2', className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            '--skeleton-width': width,
          } as React.CSSProperties
        }
      />
    </div>
  )
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<'ul'>) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        'border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<'li'>) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn('group/menu-sub-item relative', className)}
      {...props}
    />
  )
}

function SidebarMenuSubButton({
  asChild = false,
  size = 'md',
  isActive = false,
  className,
  ...props
}: React.ComponentProps<'a'> & {
  asChild?: boolean
  size?: 'sm' | 'md'
  isActive?: boolean
}) {
  const Comp = asChild ? Slot : 'a'

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        'text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0',
        'data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground',
        size === 'sm' && 'text-xs',
        size === 'md' && 'text-sm',
        'group-data-[collapsible=icon]:hidden',
        className,
      )}
      {...props}
    />
  )
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}


==================================================
FILENAME: .\frontend_next\components\ui\skeleton.tsx
==================================================
import { cn } from '@/lib/utils'

function Skeleton({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="skeleton"
      className={cn('bg-accent animate-pulse rounded-md', className)}
      {...props}
    />
  )
}

export { Skeleton }


==================================================
FILENAME: .\frontend_next\components\ui\slider.tsx
==================================================
'use client'

import * as React from 'react'
import * as SliderPrimitive from '@radix-ui/react-slider'

import { cn } from '@/lib/utils'

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max],
  )

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        'relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col',
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={
          'bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5'
        }
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={
            'bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full'
          }
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary ring-ring/50 block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  )
}

export { Slider }


==================================================
FILENAME: .\frontend_next\components\ui\sonner.tsx
==================================================
'use client'

import { useTheme } from 'next-themes'
import { Toaster as Sonner, ToasterProps } from 'sonner'

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = 'system' } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps['theme']}
      className="toaster group"
      style={
        {
          '--normal-bg': 'var(--popover)',
          '--normal-text': 'var(--popover-foreground)',
          '--normal-border': 'var(--border)',
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }


==================================================
FILENAME: .\frontend_next\components\ui\spinner.tsx
==================================================
import { Loader2Icon } from 'lucide-react'

import { cn } from '@/lib/utils'

function Spinner({ className, ...props }: React.ComponentProps<'svg'>) {
  return (
    <Loader2Icon
      role="status"
      aria-label="Loading"
      className={cn('size-4 animate-spin', className)}
      {...props}
    />
  )
}

export { Spinner }


==================================================
FILENAME: .\frontend_next\components\ui\switch.tsx
==================================================
'use client'

import * as React from 'react'
import * as SwitchPrimitive from '@radix-ui/react-switch'

import { cn } from '@/lib/utils'

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        'peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={
          'bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0'
        }
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }


==================================================
FILENAME: .\frontend_next\components\ui\table.tsx
==================================================
'use client'

import * as React from 'react'

import { cn } from '@/lib/utils'

function Table({ className, ...props }: React.ComponentProps<'table'>) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn('w-full caption-bottom text-sm', className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<'thead'>) {
  return (
    <thead
      data-slot="table-header"
      className={cn('[&_tr]:border-b', className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<'tbody'>) {
  return (
    <tbody
      data-slot="table-body"
      className={cn('[&_tr:last-child]:border-0', className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<'tfoot'>) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        'bg-muted/50 border-t font-medium [&>tr]:last:border-b-0',
        className,
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<'tr'>) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        'hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors',
        className,
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<'th'>) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        'text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]',
        className,
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<'td'>) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        'p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]',
        className,
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<'caption'>) {
  return (
    <caption
      data-slot="table-caption"
      className={cn('text-muted-foreground mt-4 text-sm', className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}


==================================================
FILENAME: .\frontend_next\components\ui\tabs.tsx
==================================================
'use client'

import * as React from 'react'
import * as TabsPrimitive from '@radix-ui/react-tabs'

import { cn } from '@/lib/utils'

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn('flex flex-col gap-2', className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        'bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]',
        className,
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn('flex-1 outline-none', className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }


==================================================
FILENAME: .\frontend_next\components\ui\textarea.tsx
==================================================
import * as React from 'react'

import { cn } from '@/lib/utils'

function Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',
        className,
      )}
      {...props}
    />
  )
}

export { Textarea }


==================================================
FILENAME: .\frontend_next\components\ui\toast.tsx
==================================================
'use client'

import * as React from 'react'
import * as ToastPrimitives from '@radix-ui/react-toast'
import { cva, type VariantProps } from 'class-variance-authority'
import { X } from 'lucide-react'

import { cn } from '@/lib/utils'

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      'fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]',
      className,
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  'group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full',
  {
    variants: {
      variant: {
        default: 'border bg-background text-foreground',
        destructive:
          'destructive group border-destructive bg-destructive text-destructive-foreground',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  },
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      'inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive',
      className,
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      'absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600',
      className,
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn('text-sm font-semibold', className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn('text-sm opacity-90', className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}


==================================================
FILENAME: .\frontend_next\components\ui\toaster.tsx
==================================================
'use client'

import { useToast } from '@/hooks/use-toast'
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from '@/components/ui/toast'

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}


==================================================
FILENAME: .\frontend_next\components\ui\toggle-group.tsx
==================================================
'use client'

import * as React from 'react'
import * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group'
import { type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'
import { toggleVariants } from '@/components/ui/toggle'

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: 'default',
  variant: 'default',
})

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        'group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs',
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  )
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        'min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l',
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
}

export { ToggleGroup, ToggleGroupItem }


==================================================
FILENAME: .\frontend_next\components\ui\toggle.tsx
==================================================
'use client'

import * as React from 'react'
import * as TogglePrimitive from '@radix-ui/react-toggle'
import { cva, type VariantProps } from 'class-variance-authority'

import { cn } from '@/lib/utils'

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: 'bg-transparent',
        outline:
          'border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground',
      },
      size: {
        default: 'h-9 px-2 min-w-9',
        sm: 'h-8 px-1.5 min-w-8',
        lg: 'h-10 px-2.5 min-w-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Toggle, toggleVariants }


==================================================
FILENAME: .\frontend_next\components\ui\tooltip.tsx
==================================================
'use client'

import * as React from 'react'
import * as TooltipPrimitive from '@radix-ui/react-tooltip'

import { cn } from '@/lib/utils'

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  )
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  )
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          'bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance',
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  )
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


==================================================
FILENAME: .\frontend_next\components\ui\use-mobile.tsx
==================================================
import * as React from 'react'

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener('change', onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener('change', onChange)
  }, [])

  return !!isMobile
}


==================================================
FILENAME: .\frontend_next\components\ui\use-toast.ts
==================================================
'use client'

// Inspired by react-hot-toast library
import * as React from 'react'

import type { ToastActionElement, ToastProps } from '@/components/ui/toast'

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: 'ADD_TOAST',
  UPDATE_TOAST: 'UPDATE_TOAST',
  DISMISS_TOAST: 'DISMISS_TOAST',
  REMOVE_TOAST: 'REMOVE_TOAST',
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType['ADD_TOAST']
      toast: ToasterToast
    }
  | {
      type: ActionType['UPDATE_TOAST']
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType['DISMISS_TOAST']
      toastId?: ToasterToast['id']
    }
  | {
      type: ActionType['REMOVE_TOAST']
      toastId?: ToasterToast['id']
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: 'REMOVE_TOAST',
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'ADD_TOAST':
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case 'UPDATE_TOAST':
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t,
        ),
      }

    case 'DISMISS_TOAST': {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t,
        ),
      }
    }
    case 'REMOVE_TOAST':
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, 'id'>

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: 'UPDATE_TOAST',
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })

  dispatch({
    type: 'ADD_TOAST',
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),
  }
}

export { useToast, toast }


==================================================
FILENAME: .\frontend_next\components\vendor\connection-status.tsx
==================================================
"use client"

import { MapPin, Building2, CheckCircle, AlertCircle } from "lucide-react"
import { Card, CardContent } from "@/components/ui/card"

interface ConnectionStatusProps {
  location?: string
  kitchenHub?: string
  distance?: number
  isConnected?: boolean
}

export default function ConnectionStatus({
  location = "Pasar Kramat Jati, Jakarta Timur",
  kitchenHub = "Dapur Umum Jaktim 01",
  distance = 2.5,
  isConnected = true,
}: ConnectionStatusProps) {
  return (
    <Card className="bg-white border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200">
      <CardContent className="p-6">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {/* Lokasi */}
          <div className="flex items-start gap-4 group">
            <div className="p-2 bg-emerald-50 rounded-full group-hover:bg-emerald-100 transition-colors">
              <MapPin className="w-5 h-5 text-emerald-600" />
            </div>
            <div>
              <p className="text-xs text-gray-500 font-medium uppercase tracking-wide mb-1">Lokasi Anda</p>
              <p className="text-sm font-semibold text-gray-900 leading-tight">{location}</p>
            </div>
          </div>

          {/* Mitra SPPG */}
          <div className="flex items-start gap-4 group">
            <div className="p-2 bg-amber-50 rounded-full group-hover:bg-amber-100 transition-colors">
              <Building2 className="w-5 h-5 text-amber-600" />
            </div>
            <div>
              <p className="text-xs text-gray-500 font-medium uppercase tracking-wide mb-1">Mitra SPPG</p>
              <p className="text-sm font-semibold text-gray-900 leading-tight">{kitchenHub}</p>
            </div>
          </div>

          {/* Status */}
          <div className="flex items-start gap-4 group">
            <div className={`p-2 rounded-full transition-colors ${isConnected ? "bg-green-50 group-hover:bg-green-100" : "bg-red-50 group-hover:bg-red-100"}`}>
              {isConnected ? (
                <CheckCircle className="w-5 h-5 text-green-600" />
              ) : (
                <AlertCircle className="w-5 h-5 text-red-600" />
              )}
            </div>
            <div>
              <p className="text-xs text-gray-500 font-medium uppercase tracking-wide mb-1">Status</p>
              <div className={`flex items-center gap-1.5 text-sm font-semibold ${isConnected ? "text-green-700" : "text-red-700"}`}>
                <span className={`w-2 h-2 rounded-full ${isConnected ? "bg-green-500" : "bg-red-500"} animate-pulse`} />
                {isConnected ? "Terhubung" : "Terputus"}
              </div>
            </div>
          </div>

          {/* Distance */}
          <div className="flex items-start gap-4 group">
            <div className="p-2 bg-blue-50 rounded-full group-hover:bg-blue-100 transition-colors">
              <MapPin className="w-5 h-5 text-blue-600" />
            </div>
            <div>
              <p className="text-xs text-gray-500 font-medium uppercase tracking-wide mb-1">Jarak</p>
              <p className="text-sm font-semibold text-gray-900 leading-tight">{distance} km</p>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\inventory-health.tsx
==================================================
"use client"

import { Leaf, AlertTriangle, Trash2 } from "lucide-react"
import { Card, CardContent } from "@/components/ui/card"

interface InventoryHealthProps {
  data?: {
    fresh: number
    warning: number
    expired: number
  }
}

export default function InventoryHealth({ data }: InventoryHealthProps) {
  const { fresh, warning, expired } = data || { fresh: 0, warning: 0, expired: 0 }
  return (
    <div>
      <h2 className="text-lg font-bold text-foreground mb-4">Status Stok Hari Ini</h2>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {/* Stok Segar */}
        <Card className="bg-gradient-to-br from-green-50 to-white border border-green-100 shadow-sm hover:shadow-lg transition-all duration-300 group">
          <CardContent className="p-6">
            <div className="flex items-start justify-between">
              <div>
                <p className="text-sm text-green-600 font-semibold mb-2">Stok Segar</p>
                <p className="text-4xl font-bold text-green-700 tracking-tight">{fresh}</p>
                <p className="text-xs text-green-600/80 mt-2 font-medium">Kualitas terjaga</p>
              </div>
              <div className="p-3 bg-green-100 rounded-xl group-hover:scale-110 transition-transform duration-300">
                <Leaf className="w-6 h-6 text-green-600" />
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Segera Habis */}
        <Card className="bg-gradient-to-br from-amber-50 to-white border border-amber-100 shadow-sm hover:shadow-lg transition-all duration-300 group">
          <CardContent className="p-6">
            <div className="flex items-start justify-between">
              <div>
                <p className="text-sm text-amber-600 font-semibold mb-2">Segera Habis</p>
                <p className="text-4xl font-bold text-amber-700 tracking-tight">{warning}</p>
                <p className="text-xs text-amber-600/80 mt-2 font-medium">Habis dalam &lt; 2 hari</p>
              </div>
              <div className="p-3 bg-amber-100 rounded-xl group-hover:scale-110 transition-transform duration-300">
                <AlertTriangle className="w-6 h-6 text-amber-600" />
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Kadaluwarsa */}
        <Card className="bg-gradient-to-br from-red-50 to-white border border-red-100 shadow-sm hover:shadow-lg transition-all duration-300 group">
          <CardContent className="p-6">
            <div className="flex items-start justify-between">
              <div>
                <p className="text-sm text-red-600 font-semibold mb-2">Kadaluwarsa</p>
                <p className="text-4xl font-bold text-red-700 tracking-tight">{expired}</p>
                <p className="text-xs text-red-600/80 mt-2 font-medium">Perlu tindakan segera</p>
              </div>
              <div className="p-3 bg-red-100 rounded-xl group-hover:scale-110 transition-transform duration-300">
                <Trash2 className="w-6 h-6 text-red-600" />
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\inventory-upload.tsx
==================================================
"use client"

import type React from "react"

import { useState, useRef } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Upload, Camera, MapPin, AlertCircle, X, RotateCcw, CheckCircle2, Trash2, Plus } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"

interface SupplyItem {
  name: string
  qty: number
  unit: string
  freshness: string
  expiry_days: number
  note?: string
  owner_name: string
  location: string
  latitude?: number
  longitude?: number
  photo_url?: string
}

export default function InventoryUpload() {
  const [uploadMode, setUploadMode] = useState<"camera" | "upload">("camera")
  const [uploading, setUploading] = useState(false)
  const [analyzing, setAnalyzing] = useState(false)
  const [location, setLocation] = useState<{ lat: number; lon: number } | null>(null)
  const [detectedItems, setDetectedItems] = useState<SupplyItem[]>([])
  const [previewUrl, setPreviewUrl] = useState<string | null>(null)
  const fileInputRef = useRef<HTMLInputElement>(null)
  const cameraInputRef = useRef<HTMLInputElement>(null)
  const videoRef = useRef<HTMLVideoElement>(null)
  const canvasRef = useRef<HTMLCanvasElement>(null)
  const [loadingLocation, setLoadingLocation] = useState(false)
  const [cameraActive, setCameraActive] = useState(false)

  const handleGetLocation = () => {
    setLoadingLocation(true)
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setLocation({
            lat: position.coords.latitude,
            lon: position.coords.longitude,
          })
          setLoadingLocation(false)
        },
        (error) => {
          if (!error.message.includes("secure origin")) {
            console.error("Error getting location:", error)
          }
          // Fallback to Monas, Jakarta for Demo/Dev
          setLocation({
            lat: -6.175392,
            lon: 106.827153,
          })
          setLoadingLocation(false)
        },
      )
    }
  }

  const startCamera = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
      })
      if (videoRef.current) {
        videoRef.current.srcObject = stream
        setCameraActive(true)
      }
    } catch (error) {
      console.error("Error accessing camera:", error)
      alert("Tidak dapat mengakses kamera. Silakan gunakan upload file.")
    }
  }

  const stopCamera = () => {
    if (videoRef.current?.srcObject) {
      const tracks = (videoRef.current.srcObject as MediaStream).getTracks()
      tracks.forEach((track) => track.stop())
      setCameraActive(false)
    }
  }

  const capturePhoto = () => {
    if (videoRef.current && canvasRef.current) {
      const context = canvasRef.current.getContext("2d")
      if (context) {
        canvasRef.current.width = videoRef.current.videoWidth
        canvasRef.current.height = videoRef.current.videoHeight
        context.drawImage(videoRef.current, 0, 0)
        const imageData = canvasRef.current.toDataURL("image/jpeg")
        setPreviewUrl(imageData)
        stopCamera()
        handleAnalyzePhoto(imageData)
      }
    }
  }

  const handleAnalyzePhoto = async (imageData: string) => {
    setAnalyzing(true)
    try {
      const response = await fetch(imageData)
      const blob = await response.blob()
      const file = new File([blob], "camera-capture.jpg", { type: "image/jpeg" })

      setUploading(true)
      const formData = new FormData()
      formData.append("file", file)

      const uploadRes = await fetch("/api/upload", {
        method: "POST",
        body: formData,
      })
      const uploadData = await uploadRes.json()

      const analyzeFormData = new FormData()
      analyzeFormData.append("file", file)

      const analyzeRes = await fetch("/api/analyze", {
        method: "POST",
        body: analyzeFormData,
      })
      const analyzeData = await analyzeRes.json()
      console.log("AI Analysis Result (Camera):", analyzeData)

      if (analyzeData.items) {
        const itemsWithLocation = analyzeData.items.map((item: SupplyItem) => ({
          ...item,
          owner_name: "UMKM Vendor",
          location: location ? `Lat: ${location.lat}, Lon: ${location.lon}` : "Tidak terdeteksi",
          latitude: location?.lat,
          longitude: location?.lon,
          photo_url: uploadData.url,
        }))
        setDetectedItems(itemsWithLocation)
      } else {
        console.warn("No items detected or invalid format:", analyzeData)
        alert("AI tidak dapat mendeteksi item. Coba foto yang lebih jelas.")
      }
    } catch (error) {
      console.error("Error analyzing photo:", error)
      alert("Gagal menganalisis foto")
    } finally {
      setUploading(false)
      setAnalyzing(false)
    }
  }

  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    const reader = new FileReader()
    reader.onload = (event) => {
      setPreviewUrl(event.target?.result as string)
      handleAnalyzePhotoFile(file)
    }
    reader.readAsDataURL(file)
  }

  const handleAnalyzePhotoFile = async (file: File) => {
    setAnalyzing(true)
    try {
      setUploading(true)
      const formData = new FormData()
      formData.append("file", file)

      const uploadRes = await fetch("/api/upload", {
        method: "POST",
        body: formData,
      })
      const uploadData = await uploadRes.json()

      const analyzeFormData = new FormData()
      analyzeFormData.append("file", file)

      const analyzeRes = await fetch("/api/analyze", {
        method: "POST",
        body: analyzeFormData,
      })
      const analyzeData = await analyzeRes.json()
      console.log("AI Analysis Result:", analyzeData)

      if (analyzeData.items) {
        const itemsWithLocation = analyzeData.items.map((item: SupplyItem) => ({
          ...item,
          owner_name: "UMKM Vendor",
          location: location ? `Lat: ${location.lat}, Lon: ${location.lon}` : "Tidak terdeteksi",
          latitude: location?.lat,
          longitude: location?.lon,
          photo_url: uploadData.url,
        }))
        setDetectedItems(itemsWithLocation)
      } else {
        console.warn("No items detected or invalid format:", analyzeData)
        alert("AI tidak dapat mendeteksi item. Coba foto yang lebih jelas.")
      }
    } catch (error) {
      console.error("Error uploading/analyzing:", error)
    } finally {
      setUploading(false)
      setAnalyzing(false)
    }
  }

  const handleSubmit = async () => {
    if (detectedItems.length === 0) return

    try {
      const response = await fetch("/api/supplies", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(detectedItems),
      })
      const result = await response.json()
      alert("Persediaan berhasil disimpan!")
      setDetectedItems([])
      setPreviewUrl(null)
    } catch (error) {
      console.error("Error submitting supplies:", error)
      alert("Gagal menyimpan persediaan")
    }
  }

  const resetCapture = () => {
    setPreviewUrl(null)
    setDetectedItems([])
    if (fileInputRef.current) {
      fileInputRef.current.value = ""
    }
  }

  const updateItem = (index: number, field: keyof SupplyItem, value: any) => {
    const newItems = [...detectedItems]
    newItems[index] = { ...newItems[index], [field]: value }
    setDetectedItems(newItems)
  }

  const addManualItem = () => {
    setDetectedItems([
      ...detectedItems,
      {
        name: "",
        qty: 1,
        unit: "kg",
        freshness: "Segar",
        expiry_days: 7,
        owner_name: "UMKM Vendor",
        location: location ? `Lat: ${location.lat}, Lon: ${location.lon}` : "Tidak terdeteksi",
        latitude: location?.lat,
        longitude: location?.lon,
        photo_url: previewUrl || undefined, // Use preview URL if available
      },
    ])
  }

  const removeManualItem = (index: number) => {
    const newItems = [...detectedItems]
    newItems.splice(index, 1)
    setDetectedItems(newItems)
  }

  return (
    <div className="space-y-6">
      <Card className="border-0 shadow-md overflow-hidden p-0">
        <CardHeader className="bg-gradient-to-r from-emerald-600 to-teal-500 text-white border-b border-emerald-700 shadow-sm">
          <div className="flex items-center gap-4">
            <div className="bg-white/20 p-3 rounded-xl backdrop-blur-sm">
              <Camera className="w-6 h-6 text-white" />
            </div>
            <div>
              <CardTitle className="text-xl font-bold text-white">Upload & Analisis Persediaan</CardTitle>
              <CardDescription className="text-emerald-50 text-sm mt-1">
                Ambil foto atau upload persediaan Anda. AI akan mendeteksi item, jumlah, dan kesegaran.
              </CardDescription>
            </div>
          </div>
        </CardHeader>
        <CardContent className="space-y-6 pt-6">
          {/* Location Section */}
          <div className="flex flex-col sm:flex-row gap-4">
            <Button
              onClick={handleGetLocation}
              disabled={loadingLocation}
              className="flex items-center gap-2 bg-primary hover:bg-primary/90 text-white font-medium"
            >
              <MapPin className="w-4 h-4" />
              {loadingLocation ? "Mendapatkan lokasi..." : "Dapatkan Lokasi GPS"}
            </Button>
            {location && (
              <div className="flex-1 bg-emerald-50 border border-primary/30 rounded-lg p-3 flex items-center gap-2">
                <CheckCircle2 className="w-4 h-4 text-primary flex-shrink-0" />
                <p className="text-sm text-primary">
                  Lokasi terdeteksi: {location.lat.toFixed(6)}, {location.lon.toFixed(6)}
                </p>
              </div>
            )}
          </div>

          {/* Tab Section */}
          <div className="flex gap-2 border-b-2 border-border">
            <button
              onClick={() => {
                setUploadMode("camera")
                stopCamera()
              }}
              className={`px-4 py-3 font-medium text-sm transition-all border-b-2 -mb-2 ${uploadMode === "camera"
                ? "text-secondary border-b-secondary"
                : "text-muted-foreground hover:text-foreground border-b-transparent"
                }`}
            >
              <Camera className="w-4 h-4 inline mr-2" />
              Ambil Foto (Prioritas)
            </button>
            <button
              onClick={() => {
                setUploadMode("upload")
                stopCamera()
              }}
              className={`px-4 py-3 font-medium text-sm transition-all border-b-2 -mb-2 ${uploadMode === "upload"
                ? "text-secondary border-b-secondary"
                : "text-muted-foreground hover:text-foreground border-b-transparent"
                }`}
            >
              <Upload className="w-4 h-4 inline mr-2" />
              Upload File
            </button>
          </div>

          {/* Camera Mode */}
          {uploadMode === "camera" && (
            <div className="space-y-4">
              {!cameraActive ? (
                <Button
                  onClick={startCamera}
                  className="w-full bg-secondary hover:bg-secondary/90 text-white py-6 text-lg font-semibold rounded-lg"
                >
                  <Camera className="w-5 h-5 mr-2" />
                  Aktifkan Kamera
                </Button>
              ) : (
                <div className="space-y-4">
                  <video
                    ref={videoRef}
                    autoPlay
                    playsInline
                    className="w-full rounded-lg border-2 border-secondary bg-black"
                  />
                  <div className="flex gap-2">
                    <Button
                      onClick={capturePhoto}
                      className="flex-1 bg-secondary hover:bg-secondary/90 text-white py-6 text-lg font-semibold rounded-lg"
                    >
                      <Camera className="w-5 h-5 mr-2" />
                      Ambil Foto
                    </Button>
                    <Button
                      onClick={stopCamera}
                      variant="outline"
                      className="flex-1 py-6 text-lg rounded-lg bg-transparent"
                    >
                      <X className="w-5 h-5 mr-2" />
                      Batal
                    </Button>
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Upload Mode */}
          {uploadMode === "upload" && (
            <div className="space-y-4">
              <div
                className="border-2 border-dashed border-emerald-200 bg-emerald-50/30 rounded-xl p-10 text-center cursor-pointer hover:bg-emerald-50 hover:border-emerald-400 transition-all duration-300 group"
                onClick={() => fileInputRef.current?.click()}
              >
                <div className="bg-white p-4 rounded-full w-16 h-16 mx-auto mb-4 shadow-sm group-hover:scale-110 transition-transform duration-300 flex items-center justify-center">
                  <Upload className="w-8 h-8 text-emerald-600" />
                </div>
                <p className="font-bold text-gray-700 text-lg mb-1">Klik atau drag foto di sini</p>
                <p className="text-sm text-gray-500">Format: PNG, JPG. Maksimal 5MB</p>
              </div>
              <input
                ref={fileInputRef}
                type="file"
                accept="image/*"
                className="hidden"
                onChange={handleFileSelect}
                disabled={uploading || analyzing}
              />
            </div>
          )}

          {/* Loading States */}
          {uploading && (
            <Alert className="bg-blue-50 border border-blue-200">
              <AlertCircle className="h-4 w-4 text-blue-600" />
              <AlertDescription className="text-blue-600">Mengunggah file...</AlertDescription>
            </Alert>
          )}
          {analyzing && (
            <Alert className="bg-blue-50 border border-blue-200">
              <AlertCircle className="h-4 w-4 text-blue-600" />
              <AlertDescription className="text-blue-600">Menganalisis foto dengan AI...</AlertDescription>
            </Alert>
          )}

          {/* Preview */}
          {previewUrl && (
            <div className="space-y-4">
              <img
                src={previewUrl || "/placeholder.svg"}
                alt="Preview"
                className="w-full max-h-96 object-cover rounded-lg border-2 border-secondary/30"
              />
              <Button onClick={resetCapture} variant="outline" className="w-full rounded-lg bg-transparent">
                <RotateCcw className="w-4 h-4 mr-2" />
                Ambil Foto Lagi
              </Button>
            </div>
          )}

          {/* Hidden canvas for camera capture */}
          <canvas ref={canvasRef} className="hidden" />
        </CardContent>
      </Card>

      {/* Detected Items (Editable) */}
      {detectedItems.length > 0 && (
        <Card className="border-0 shadow-md border-l-4 border-l-secondary">
          <CardHeader className="bg-gradient-to-r from-secondary/10 to-amber-50 flex flex-row items-center justify-between">
            <CardTitle className="flex items-center gap-2">
              <CheckCircle2 className="w-5 h-5 text-secondary" />
              Item yang Terdeteksi ({detectedItems.length})
            </CardTitle>
            <Button onClick={addManualItem} size="sm" variant="outline" className="bg-white hover:bg-gray-50">
              <Plus className="w-4 h-4 mr-2" /> Tambah Item
            </Button>
          </CardHeader>
          <CardContent className="space-y-4 pt-6">
            <div className="space-y-3">
              {detectedItems.map((item, idx) => (
                <div key={idx} className="bg-emerald-50 border border-primary/20 p-4 rounded-lg space-y-3 relative group">
                  <Button
                    variant="ghost"
                    size="icon"
                    className="absolute top-2 right-2 text-muted-foreground hover:text-destructive opacity-0 group-hover:opacity-100 transition-opacity"
                    onClick={() => removeManualItem(idx)}
                  >
                    <Trash2 className="w-4 h-4" />
                  </Button>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nama Barang</Label>
                      <Input
                        value={item.name}
                        onChange={(e) => updateItem(idx, "name", e.target.value)}
                        className="bg-white"
                      />
                    </div>
                    <div className="grid grid-cols-2 gap-2">
                      <div className="space-y-2">
                        <Label>Jumlah</Label>
                        <Input
                          type="number"
                          value={item.qty}
                          onChange={(e) => updateItem(idx, "qty", parseFloat(e.target.value) || 0)}
                          className="bg-white"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Satuan</Label>
                        <Input
                          value={item.unit}
                          onChange={(e) => updateItem(idx, "unit", e.target.value)}
                          className="bg-white"
                        />
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Kondisi</Label>
                      <Select value={item.freshness} onValueChange={(val: string) => updateItem(idx, "freshness", val)}>
                        <SelectTrigger className="bg-white">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Segar">Segar</SelectItem>
                          <SelectItem value="Sedang">Sedang</SelectItem>
                          <SelectItem value="Buruk">Buruk</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Estimasi Kadaluwarsa (Hari)</Label>
                      <Input
                        type="number"
                        value={item.expiry_days}
                        onChange={(e) => updateItem(idx, "expiry_days", parseInt(e.target.value) || 0)}
                        className="bg-white"
                      />
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label>Catatan AI</Label>
                    <Input
                      value={item.note || ""}
                      onChange={(e) => updateItem(idx, "note", e.target.value)}
                      className="bg-white text-muted-foreground italic"
                    />
                  </div>
                </div>
              ))}
            </div>

            <Button
              onClick={handleSubmit}
              className="w-full bg-primary hover:bg-primary/90 text-white font-semibold rounded-lg py-6"
            >
              Simpan Persediaan
            </Button>
          </CardContent>
        </Card>
      )}
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\kitchen-search.tsx
==================================================
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { MapPin, Navigation, Building2, Phone } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"

interface SPPGLocation {
  id: number
  name: string
  address: string
  lat: number
  long: number
  phone: string
  distance_km: number
}

export default function KitchenSearch() {
  const [searchResults, setSearchResults] = useState<SPPGLocation[]>([])
  const [loading, setLoading] = useState(false)
  const [location, setLocation] = useState<{ lat: number; lon: number } | null>(null)
  const [searched, setSearched] = useState(false)

  // Manual Input State
  const [manualLat, setManualLat] = useState("-6.175392")
  const [manualLong, setManualLong] = useState("106.827153")
  const [useManual, setUseManual] = useState(false)

  const handleGetLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setLocation({
            lat: position.coords.latitude,
            lon: position.coords.longitude,
          })
          setManualLat(position.coords.latitude.toString())
          setManualLong(position.coords.longitude.toString())
        },
        (error) => {
          if (!error.message.includes("secure origin")) {
            console.error("Error getting location:", error)
          }
          // Fallback to Monas, Jakarta
          setLocation({
            lat: -6.175392,
            lon: 106.827153,
          })
        },
      )
    }
  }

  const handleSearch = async () => {
    // Use manual coordinates if toggled or if GPS not active
    let lat = -6.175392
    let lon = 106.827153

    if (useManual) {
      lat = parseFloat(manualLat)
      lon = parseFloat(manualLong)
    } else if (location) {
      lat = location.lat
      lon = location.lon
    }

    setLoading(true)
    setSearched(true)
    try {
      const params = new URLSearchParams({
        lat: lat.toString(),
        long: lon.toString(),
      })

      const response = await fetch(`/api/sppg/search?${params}`, {
        method: "GET",
      })
      const data = await response.json()
      console.log("[v0] SPPG Search results:", data)
      setSearchResults(data.data || [])
    } catch (error) {
      console.error("Error searching SPPG:", error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <MapPin className="w-5 h-5 text-emerald-600" />
            Cari SPPG Terdekat
          </CardTitle>
          <CardDescription>Temukan Kitchen Hub (Dapur Umum) terdekat untuk menyetor bahan</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-2 gap-4 mb-4">
            <div className="space-y-2">
              <label className="text-sm font-medium">Latitude</label>
              <input
                type="text"
                value={manualLat}
                onChange={(e) => {
                  setManualLat(e.target.value)
                  setUseManual(true)
                }}
                className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
              />
            </div>
            <div className="space-y-2">
              <label className="text-sm font-medium">Longitude</label>
              <input
                type="text"
                value={manualLong}
                onChange={(e) => {
                  setManualLong(e.target.value)
                  setUseManual(true)
                }}
                className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"
              />
            </div>
          </div>

          <div className="flex flex-col sm:flex-row gap-4">
            <Button
              onClick={handleGetLocation}
              variant="outline"
              className="flex items-center gap-2"
            >
              <Navigation className="w-4 h-4" />
              {location ? "Lokasi Terdeteksi" : "Aktifkan GPS"}
            </Button>

            <Button
              onClick={handleSearch}
              disabled={loading}
              className="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white"
            >
              {loading ? "Mencari..." : "Cari SPPG Terdekat"}
            </Button>
          </div>

          {location && !useManual && (
            <p className="text-sm text-muted-foreground">
              GPS: {location.lat.toFixed(4)}, {location.lon.toFixed(4)}
            </p>
          )}
        </CardContent>
      </Card>

      {/* Results */}
      {searchResults.length > 0 && (
        <Card>
          <CardHeader>
            <CardTitle>Hasil Pencarian ({searchResults.length})</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {searchResults.map((item) => (
                <div key={item.id} className="border border-border rounded-lg p-4 hover:bg-muted transition-colors">
                  <div className="flex justify-between items-start">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <Building2 className="w-4 h-4 text-emerald-600" />
                        <p className="font-semibold text-foreground">{item.name}</p>
                      </div>
                      <p className="text-sm text-muted-foreground ml-6 mb-2">{item.address}</p>
                      <div className="flex items-center gap-2 ml-6">
                        <Phone className="w-3 h-3 text-muted-foreground" />
                        <p className="text-xs text-muted-foreground">{item.phone}</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <p className="text-lg font-bold text-emerald-600">{item.distance_km.toFixed(1)} km</p>
                      <span className="text-xs text-muted-foreground">dari lokasi anda</span>
                    </div>
                  </div>
                  <div className="mt-4 flex gap-2 justify-end">
                    <Button size="sm" variant="outline">Lihat Peta</Button>
                    <Button size="sm" className="bg-emerald-600 hover:bg-emerald-700 text-white">Hubungi</Button>
                  </div>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      )}

      {!loading && searched && searchResults.length === 0 && (
        <Alert>
          <AlertDescription>Tidak ditemukan SPPG di sekitar lokasi ini.</AlertDescription>
        </Alert>
      )}
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\order-list.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { AlertCircle, CheckCircle, Clock } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"

interface Order {
  id: number
  supply_name: string
  qty_ordered: number
  buyer_name: string
  status: "pending" | "confirmed" | "completed"
  created_at: string
}

export default function OrderList() {
  const [orders, setOrders] = useState<Order[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchOrders = async () => {
      try {
        const response = await fetch("/api/orders/umkm")
        const data = await response.json()
        console.log("[v0] Orders:", data)
        setOrders(data.orders || [])
      } catch (error) {
        console.error("Error fetching orders:", error)
      } finally {
        setLoading(false)
      }
    }

    fetchOrders()
  }, [])

  const handleUpdateStatus = async (orderId: number, newStatus: string) => {
    try {
      const response = await fetch(`/api/orders/${orderId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status: newStatus }),
      })
      const result = await response.json()
      console.log("[v0] Update result:", result)
      setOrders(orders.map((o) => (o.id === orderId ? { ...o, status: newStatus as any } : o)))
    } catch (error) {
      console.error("Error updating order:", error)
    }
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "confirmed":
        return <CheckCircle className="w-5 h-5 text-green-500" />
      case "pending":
        return <Clock className="w-5 h-5 text-yellow-500" />
      case "completed":
        return <CheckCircle className="w-5 h-5 text-blue-500" />
      default:
        return <AlertCircle className="w-5 h-5 text-muted-foreground" />
    }
  }

  const getStatusBadge = (status: string) => {
    switch (status) {
      case "pending":
        return "bg-yellow-100 text-yellow-800"
      case "confirmed":
        return "bg-blue-100 text-blue-800"
      case "completed":
        return "bg-green-100 text-green-800"
      default:
        return "bg-muted text-muted-foreground"
    }
  }

  if (loading) {
    return (
      <Card>
        <CardContent className="pt-6">
          <p className="text-center text-muted-foreground">Memuat pesanan...</p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle>Pesanan Masuk</CardTitle>
          <CardDescription>Daftar pesanan dari SPPG untuk persediaan Anda</CardDescription>
        </CardHeader>
        <CardContent>
          {orders.length === 0 ? (
            <Alert>
              <AlertCircle className="h-4 w-4" />
              <AlertDescription>Tidak ada pesanan saat ini</AlertDescription>
            </Alert>
          ) : (
            <div className="space-y-3">
              {orders.map((order) => (
                <div key={order.id} className="border border-border rounded-lg p-4 space-y-3">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        {getStatusIcon(order.status)}
                        <p className="font-semibold text-foreground">{order.supply_name}</p>
                      </div>
                      <p className="text-sm text-muted-foreground">Dari: {order.buyer_name}</p>
                      <p className="text-sm text-muted-foreground">Jumlah: {order.qty_ordered} unit</p>
                    </div>
                    <span className={`text-xs px-3 py-1 rounded-full font-semibold ${getStatusBadge(order.status)}`}>
                      {order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                    </span>
                  </div>

                  {order.status === "pending" && (
                    <Button
                      size="sm"
                      onClick={() => handleUpdateStatus(order.id, "confirmed")}
                      className="bg-green-500 text-white hover:bg-green-600"
                    >
                      Konfirmasi
                    </Button>
                  )}
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\quick-insights.tsx
==================================================
"use client"

import {
  BarChart,
  Bar,
  PieChart,
  Pie,
  Cell,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from "recharts"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"

interface QuickInsightsProps {
  data?: {
    expiry_risk: any[]
    top_sales: any[]
  }
}

export default function QuickInsights({ data }: QuickInsightsProps) {
  const expiryData = data?.expiry_risk || [
    { name: "Aman", value: 0, fill: "#10B981" },
    { name: "Peringatan", value: 0, fill: "#F59E0B" },
    { name: "Kadaluwarsa", value: 0, fill: "#EF4444" },
  ]

  const salesData = data?.top_sales || []
  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      {/* Expiry Risk Chart */}
      <Card className="bg-white border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200">
        <CardHeader className="border-b border-gray-50 pb-4">
          <CardTitle className="text-base font-bold text-gray-800 flex items-center gap-2">
            <span className="w-1 h-4 bg-emerald-500 rounded-full"></span>
            Resiko Kadaluwarsa
          </CardTitle>
        </CardHeader>
        <CardContent className="pt-6">
          <ResponsiveContainer width="100%" height={300}>
            <PieChart>
              <Pie
                data={expiryData}
                cx="50%"
                cy="50%"
                innerRadius={60}
                outerRadius={100}
                paddingAngle={4}
                dataKey="value"
                stroke="none"
              >
                {expiryData.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.fill} />
                ))}
              </Pie>
              <Tooltip
                contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
              />
              <Legend verticalAlign="bottom" height={36} iconType="circle" />
            </PieChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>

      {/* Top Sales Chart */}
      <Card className="bg-white border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200">
        <CardHeader className="border-b border-gray-50 pb-4">
          <CardTitle className="text-base font-bold text-gray-800 flex items-center gap-2">
            <span className="w-1 h-4 bg-emerald-500 rounded-full"></span>
            Paling Laku Minggu Ini
          </CardTitle>
        </CardHeader>
        <CardContent className="pt-6">
          <ResponsiveContainer width="100%" height={300}>
            <BarChart data={salesData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" vertical={false} />
              <XAxis
                dataKey="name"
                stroke="#9ca3af"
                fontSize={12}
                tickLine={false}
                axisLine={false}
                dy={10}
              />
              <YAxis
                stroke="#9ca3af"
                fontSize={12}
                tickLine={false}
                axisLine={false}
                dx={-10}
              />
              <Tooltip
                cursor={{ fill: '#f9fafb' }}
                contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                formatter={(value) => [`${value} kg/pcs`, 'Terjual']}
              />
              <Bar dataKey="value" fill="#10B981" radius={[6, 6, 0, 0]} maxBarSize={60} />
            </BarChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\sppg-search.tsx
==================================================
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { MapPin, Navigation, Search } from "lucide-react"
import { Alert, AlertDescription } from "@/components/ui/alert"

interface SppgLocation {
    id: number
    name: string
    address: string
    distance_km: number
    lat: number
    long: number
    phone: string
}

export default function SppgSearch() {
    const [loading, setLoading] = useState(false)
    const [results, setResults] = useState<SppgLocation[]>([])
    const [locationError, setLocationError] = useState<string | null>(null)

    const handleSearchNearest = () => {
        setLoading(true)
        setLocationError(null)

        if (!navigator.geolocation) {
            setLocationError("Geolocation is not supported by your browser")
            setLoading(false)
            return
        }

        navigator.geolocation.getCurrentPosition(
            async (position) => {
                try {
                    const { latitude, longitude } = position.coords
                    const response = await fetch(`/api/sppg/search?lat=${latitude}&long=${longitude}`)
                    const data = await response.json()

                    if (data.status === "success") {
                        setResults(data.data)
                    } else {
                        setLocationError("Gagal mencari SPPG terdekat")
                    }
                } catch (error) {
                    console.error("Error searching SPPG:", error)
                    setLocationError("Terjadi kesalahan koneksi")
                } finally {
                    setLoading(false)
                }
            },
            (error) => {
                if (!error.message.includes("secure origin")) {
                    console.error("Geolocation error:", error)
                }
                // Fallback to Monas, Jakarta for Demo/Dev
                const fallbackLat = -6.175392
                const fallbackLong = 106.827153

                // Auto-search with fallback
                fetch(`/api/sppg/search?lat=${fallbackLat}&long=${fallbackLong}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === "success") {
                            setResults(data.data)
                            setLocationError("Lokasi tidak terdeteksi (Non-HTTPS). Menggunakan lokasi default: Monas, Jakarta.")
                        }
                    })
                    .catch(() => setLocationError("Gagal mencari SPPG terdekat"))
                    .finally(() => setLoading(false))
            }
        )
    }

    const openGoogleMaps = (lat: number, long: number) => {
        window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${long}`, "_blank")
    }

    return (
        <Card className="w-full">
            <CardHeader>
                <CardTitle className="flex items-center gap-2">
                    <MapPin className="w-5 h-5 text-emerald-600" />
                    Cari SPPG Terdekat (Drop Point)
                </CardTitle>
                <CardDescription>
                    Temukan lokasi Kitchen Hub terdekat untuk mengantar stok bahan makanan Anda.
                </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
                <Button
                    onClick={handleSearchNearest}
                    disabled={loading}
                    className="w-full bg-emerald-600 hover:bg-emerald-700 text-white"
                >
                    {loading ? (
                        "Mencari Lokasi..."
                    ) : (
                        <>
                            <Search className="w-4 h-4 mr-2" />
                            Cari SPPG Terdekat
                        </>
                    )}
                </Button>

                {locationError && (
                    <Alert variant="destructive">
                        <AlertDescription>{locationError}</AlertDescription>
                    </Alert>
                )}

                {results.length > 0 && (
                    <div className="space-y-3 mt-4">
                        <h3 className="text-sm font-medium text-muted-foreground">Hasil Pencarian:</h3>
                        {results.map((sppg) => (
                            <div key={sppg.id} className="border border-border rounded-lg p-4 hover:bg-muted transition-colors">
                                <div className="flex justify-between items-start">
                                    <div className="space-y-1">
                                        <p className="font-semibold text-foreground">{sppg.name}</p>
                                        <p className="text-sm text-muted-foreground">{sppg.address}</p>
                                        <p className="text-xs text-emerald-600 font-medium">{sppg.phone}</p>
                                    </div>
                                    <div className="text-right">
                                        <div className="flex items-center justify-end gap-1 text-emerald-600 mb-2">
                                            <MapPin className="w-4 h-4" />
                                            <span className="font-bold">{sppg.distance_km} km</span>
                                        </div>
                                        <Button
                                            size="sm"
                                            variant="outline"
                                            onClick={() => openGoogleMaps(sppg.lat, sppg.long)}
                                            className="text-xs h-8"
                                        >
                                            <Navigation className="w-3 h-3 mr-1" />
                                            Rute
                                        </Button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </CardContent>
        </Card>
    )
}


==================================================
FILENAME: .\frontend_next\components\vendor\vendor-dashboard.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import VendorNavbar from "./vendor-navbar"
import VendorSidebar from "./vendor-sidebar"
import ConnectionStatus from "./connection-status"
import InventoryHealth from "./inventory-health"
import QuickInsights from "./quick-insights"
import InventoryList from "@/components/common/inventory-list"
import InventoryUpload from "./inventory-upload"
import OrderList from "./order-list"
import SppgSearch from "./sppg-search"

interface VendorDashboardProps {
  onLogout: () => void
}

export default function VendorDashboard({ onLogout }: VendorDashboardProps) {
  const [activeTab, setActiveTab] = useState<"dashboard" | "upload" | "orders" | "sppg" | "history" | "settings">("dashboard")
  const [sidebarOpen, setSidebarOpen] = useState(false)
  const [analytics, setAnalytics] = useState<any>(null)

  useEffect(() => {
    const fetchAnalytics = async () => {
      try {
        const response = await fetch("/api/analytics/vendor")
        const data = await response.json()
        setAnalytics(data)
      } catch (error) {
        console.error("Error fetching vendor analytics:", error)
      }
    }
    fetchAnalytics()
  }, [])

  const renderContent = () => {
    switch (activeTab) {
      case "upload":
        return <InventoryUpload />
      case "orders":
        return <OrderList />
      case "sppg":
        return <SppgSearch />
      case "history":
        return (
          <div className="bg-white rounded-lg border border-gray-200 p-6 text-center text-muted-foreground">
            <p>Fitur riwayat transaksi akan segera tersedia.</p>
          </div>
        )
      case "settings":
        return (
          <div className="bg-white rounded-lg border border-gray-200 p-6 text-center text-muted-foreground">
            <p>Pengaturan akun akan segera tersedia.</p>
          </div>
        )
      case "dashboard":
        return (
          <div className="space-y-6 animate-in fade-in duration-500">
            <ConnectionStatus />
            <InventoryHealth data={analytics?.inventory_health} />
            <QuickInsights data={analytics} />
            <InventoryList role="vendor" />
          </div>
        )
    }
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <VendorNavbar vendorName="Pak Asep" onLogout={onLogout} onMenuToggle={setSidebarOpen} />

      <div className="flex">
        <VendorSidebar
          activeTab={activeTab}
          onTabChange={setActiveTab as any}
          isOpen={sidebarOpen}
          onClose={() => setSidebarOpen(false)}
        />

        {/* Main Content */}
        <main className="flex-1 bg-gray-50/50 min-h-[calc(100vh-64px)]">
          <div className="w-full px-6 py-8">{renderContent()}</div>
        </main>
      </div>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\vendor-inventory-overview.tsx
==================================================
"use client"

import { useState, useEffect } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from "recharts"
import { Warehouse, TrendingUp } from "lucide-react"

interface VendorSupply {
  name: string
  quantity: number
  unit: string
  freshness: string
}

export default function VendorInventoryOverview() {
  const [supplies, setSupplies] = useState<VendorSupply[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchSupplies = async () => {
      try {
        const response = await fetch("/api/supplies/vendor")
        const data = await response.json()
        setSupplies(data.supplies || [])
      } catch (error) {
        console.error("Error fetching vendor supplies:", error)
      } finally {
        setLoading(false)
      }
    }

    fetchSupplies()
  }, [])

  const barChartData = supplies.map((s) => ({
    name: s.name.substring(0, 8),
    quantity: s.quantity,
  }))

  const freshnessData = [
    {
      name: "Segar",
      value: supplies.filter((s) => s.freshness === "Segar").length,
    },
    {
      name: "Sedang",
      value: supplies.filter((s) => s.freshness === "Sedang").length,
    },
    {
      name: "Buruk",
      value: supplies.filter((s) => s.freshness === "Buruk").length,
    },
  ].filter((f) => f.value > 0)

  const COLORS = ["#2D7A3E", "#D97E1A", "#EF4444"]

  if (loading) {
    return (
      <Card>
        <CardContent className="pt-6">
          <p className="text-center text-muted-foreground">Memuat persediaan...</p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      {/* Summary Cards */}
      <div className="grid md:grid-cols-3 gap-4">
        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20 pb-3">
            <CardTitle className="text-sm flex items-center gap-2">
              <Warehouse className="w-4 h-4 text-primary" />
              Total Item
            </CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-foreground">{supplies.length}</div>
            <p className="text-xs text-muted-foreground mt-1">item tersedia</p>
          </CardContent>
        </Card>

        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-secondary/10 to-amber-50 border-b border-secondary/20 pb-3">
            <CardTitle className="text-sm flex items-center gap-2">
              <TrendingUp className="w-4 h-4 text-secondary" />
              Total Kuantitas
            </CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-foreground">{supplies.reduce((sum, s) => sum + s.quantity, 0)}</div>
            <p className="text-xs text-muted-foreground mt-1">unit seluruh persediaan</p>
          </CardContent>
        </Card>

        <Card className="border-0 shadow-md">
          <CardHeader className="bg-gradient-to-r from-emerald-50 to-blue-50 border-b border-primary/20 pb-3">
            <CardTitle className="text-sm">Kondisi Terbaik</CardTitle>
          </CardHeader>
          <CardContent className="pt-4">
            <div className="text-3xl font-bold text-primary">
              {supplies.filter((s) => s.freshness === "Segar").length}
            </div>
            <p className="text-xs text-muted-foreground mt-1">item segar</p>
          </CardContent>
        </Card>
      </div>

      {/* Charts */}
      <div className="grid md:grid-cols-2 gap-6">
        {/* Bar Chart */}
        {barChartData.length > 0 && (
          <Card className="border-0 shadow-md">
            <CardHeader className="bg-gradient-to-r from-primary/10 to-emerald-50 border-b border-primary/20">
              <CardTitle>Persediaan per Item</CardTitle>
              <CardDescription>Jumlah stok untuk setiap bahan</CardDescription>
            </CardHeader>
            <CardContent className="pt-6">
              <ResponsiveContainer width="100%" height={300}>
                <BarChart data={barChartData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="hsl(var(--border))" />
                  <XAxis dataKey="name" stroke="hsl(var(--muted-foreground))" />
                  <YAxis stroke="hsl(var(--muted-foreground))" />
                  <Tooltip
                    contentStyle={{
                      backgroundColor: "hsl(var(--background))",
                      border: "1px solid hsl(var(--border))",
                      borderRadius: "8px",
                    }}
                  />
                  <Bar dataKey="quantity" fill="#2D7A3E" radius={[8, 8, 0, 0]} />
                </BarChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        )}

        {/* Pie Chart */}
        {freshnessData.length > 0 && (
          <Card className="border-0 shadow-md">
            <CardHeader className="bg-gradient-to-r from-secondary/10 to-amber-50 border-b border-secondary/20">
              <CardTitle>Distribusi Kesegaran</CardTitle>
              <CardDescription>Kondisi kesegaran persediaan</CardDescription>
            </CardHeader>
            <CardContent className="pt-6 flex justify-center">
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={freshnessData}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ name, value }) => `${name}: ${value}`}
                    outerRadius={80}
                    fill="#8884d8"
                    dataKey="value"
                  >
                    {freshnessData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\vendor-navbar.tsx
==================================================
"use client"

import { LogOut, Menu } from "lucide-react"
import { Button } from "@/components/ui/button"

interface VendorNavbarProps {
  vendorName: string
  onLogout: () => void
  onMenuToggle: (open: boolean) => void
}

export default function VendorNavbar({ vendorName, onLogout, onMenuToggle }: VendorNavbarProps) {
  return (
    <header className="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <div className="flex items-center gap-3">
          <Button variant="ghost" size="icon" className="lg:hidden" onClick={() => onMenuToggle(true)}>
            <Menu className="w-5 h-5" />
          </Button>
          <div>
            <h1 className="text-2xl font-bold text-emerald-800">Bekal Bangsa</h1>
          </div>
        </div>

        <div className="flex items-center gap-4">
          <div className="text-right hidden sm:block">
            <p className="font-semibold text-foreground">{vendorName}</p>
            <p className="text-xs text-muted-foreground">UMKM Vendor</p>
          </div>
          <div className="w-10 h-10 rounded-full bg-emerald-200 flex items-center justify-center font-bold text-emerald-800">
            {vendorName.charAt(0)}
          </div>
          <Button
            variant="ghost"
            size="sm"
            onClick={onLogout}
            className="text-red-600 hover:text-red-700 hover:bg-red-50"
          >
            <LogOut className="w-4 h-4 mr-2" />
            <span className="hidden sm:inline">Logout</span>
          </Button>
        </div>
      </div>
    </header>
  )
}


==================================================
FILENAME: .\frontend_next\components\vendor\vendor-sidebar.tsx
==================================================
"use client"

import { Home, Camera, Package, History, Settings, X, MapPin } from "lucide-react"
import { Button } from "@/components/ui/button"

interface VendorSidebarProps {
  activeTab: string
  onTabChange: (tab: string) => void
  isOpen: boolean
  onClose: () => void
}

const menuItems = [
  { id: "dashboard", label: "Dashboard", icon: Home },
  { id: "upload", label: "Upload Stok", icon: Camera },
  { id: "orders", label: "Pesanan Masuk", icon: Package },
  { id: "sppg", label: "Cari SPPG", icon: MapPin },
  { id: "history", label: "Riwayat Transaksi", icon: History },
  { id: "settings", label: "Pengaturan", icon: Settings },
]

export default function VendorSidebar({ activeTab, onTabChange, isOpen, onClose }: VendorSidebarProps) {
  return (
    <>
      {/* Mobile Overlay */}
      {isOpen && <div className="fixed inset-0 bg-black/50 z-40 lg:hidden" onClick={onClose} />}

      {/* Sidebar */}
      <aside
        className={`fixed left-0 top-16 w-64 h-[calc(100vh-64px)] bg-white border-r border-gray-100 shadow-sm overflow-y-auto transition-transform lg:translate-x-0 z-40 ${isOpen ? "translate-x-0" : "-translate-x-full"
          }`}
      >
        <div className="p-4 lg:hidden flex justify-between items-center border-b border-gray-100">
          <h2 className="font-semibold text-gray-800">Menu</h2>
          <Button variant="ghost" size="icon" onClick={onClose}>
            <X className="w-5 h-5" />
          </Button>
        </div>

        <nav className="p-4 space-y-1">
          {menuItems.map((item) => {
            const Icon = item.icon
            const isActive = activeTab === item.id
            return (
              <Button
                key={item.id}
                onClick={() => {
                  onTabChange(item.id)
                  onClose()
                }}
                variant="ghost"
                className={`w-full justify-start gap-3 px-3 py-6 relative transition-all duration-200 ${isActive
                    ? "bg-emerald-50 text-emerald-700 font-medium"
                    : "text-gray-600 hover:bg-gray-50 hover:text-gray-900"
                  }`}
              >
                {isActive && (
                  <div className="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-emerald-600 rounded-r-full" />
                )}
                <Icon className={`w-5 h-5 ${isActive ? "text-emerald-600" : "text-gray-400 group-hover:text-gray-600"}`} />
                {item.label}
              </Button>
            )
          })}
        </nav>
      </aside>

      {/* Desktop sidebar placeholder - visible only on lg */}
      <div className="hidden lg:block w-64 flex-shrink-0" />
    </>
  )
}


==================================================
FILENAME: .\frontend_next\hooks\use-location.ts
==================================================
"use client"

import { useState, useCallback } from "react"

export interface Location {
  latitude: number
  longitude: number
}

export function useLocation() {
  const [location, setLocation] = useState<Location | null>(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const getLocation = useCallback(async () => {
    setLoading(true)
    setError(null)

    if (!navigator.geolocation) {
      setError("Geolocation tidak tersedia di browser ini")
      setLoading(false)
      return
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        setLocation({
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
        })
        setLoading(false)
      },
      (err) => {
        setError(err.message)
        setLoading(false)
      },
    )
  }, [])

  return { location, loading, error, getLocation }
}


==================================================
FILENAME: .\frontend_next\hooks\use-mobile.ts
==================================================
import * as React from 'react'

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener('change', onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener('change', onChange)
  }, [])

  return !!isMobile
}


==================================================
FILENAME: .\frontend_next\hooks\use-toast.ts
==================================================
'use client'

// Inspired by react-hot-toast library
import * as React from 'react'

import type { ToastActionElement, ToastProps } from '@/components/ui/toast'

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: 'ADD_TOAST',
  UPDATE_TOAST: 'UPDATE_TOAST',
  DISMISS_TOAST: 'DISMISS_TOAST',
  REMOVE_TOAST: 'REMOVE_TOAST',
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType['ADD_TOAST']
      toast: ToasterToast
    }
  | {
      type: ActionType['UPDATE_TOAST']
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType['DISMISS_TOAST']
      toastId?: ToasterToast['id']
    }
  | {
      type: ActionType['REMOVE_TOAST']
      toastId?: ToasterToast['id']
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: 'REMOVE_TOAST',
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'ADD_TOAST':
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case 'UPDATE_TOAST':
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t,
        ),
      }

    case 'DISMISS_TOAST': {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t,
        ),
      }
    }
    case 'REMOVE_TOAST':
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, 'id'>

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: 'UPDATE_TOAST',
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })

  dispatch({
    type: 'ADD_TOAST',
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),
  }
}

export { useToast, toast }


==================================================
FILENAME: .\frontend_next\lib\api.ts
==================================================
export const API_BASE = process.env.NEXT_PUBLIC_API_BASE || "http://localhost:8000/api"

export interface ApiResponse<T = any> {
  success: boolean
  data?: T
  error?: string
  message?: string
}

export async function apiCall<T = any>(endpoint: string, options?: RequestInit): Promise<ApiResponse<T>> {
  try {
    const url = `${API_BASE}${endpoint}`
    const response = await fetch(url, {
      headers: {
        "Content-Type": "application/json",
        ...options?.headers,
      },
      ...options,
    })

    const data = await response.json()

    if (!response.ok) {
      console.error(`[v0] API Error (${response.status}):`, data)
      return {
        success: false,
        error: data.error || data.message || "API call failed",
      }
    }

    return {
      success: true,
      data,
    }
  } catch (error) {
    console.error("[v0] API Error:", error)
    return {
      success: false,
      error: error instanceof Error ? error.message : "Unknown error",
    }
  }
}

// Specific API calls
export const API = {
  // Upload & Analyze
  uploadImage: (file: File) => {
    const formData = new FormData()
    formData.append("file", file)
    return fetch(`${API_BASE}/upload`, { method: "POST", body: formData })
  },

  analyzeImage: (file: File) => {
    const formData = new FormData()
    formData.append("file", file)
    return fetch(`${API_BASE}/analyze`, { method: "POST", body: formData })
  },

  // Supplies
  saveSupplies: (items: any[]) => apiCall("/supplies", { method: "POST", body: JSON.stringify(items) }),

  getSupplies: () => apiCall("/supplies"),

  searchSuppliers: (query: string, lat?: number, long?: number) =>
    apiCall(`/suppliers/search?q=${query}${lat ? `&lat=${lat}` : ""}${long ? `&long=${long}` : ""}`),

  // Menu
  getMenuRecommendations: (ingredients: string[]) =>
    apiCall("/recommend-menu", { method: "POST", body: JSON.stringify({ ingredients }) }),

  // Orders
  getVendorOrders: () => apiCall("/orders/umkm"),

  updateOrder: (orderId: number, status: string) =>
    apiCall(`/orders/${orderId}`, { method: "PUT", body: JSON.stringify({ status }) }),

  // Kitchen
  startCooking: (menuName: string, qtyProduced: number, ingredientIds: number[]) =>
    apiCall("/kitchen/cook", {
      method: "POST",
      body: JSON.stringify({ menu_name: menuName, qty_produced: qtyProduced, ingredients_ids: ingredientIds }),
    }),

  // IoT
  getIoTLogs: () => apiCall("/iot/logs"),

  // Notifications
  triggerNotifications: () => apiCall("/notifications/trigger", { method: "POST" }),
}


==================================================
FILENAME: .\frontend_next\lib\utils.ts
==================================================
import { clsx, type ClassValue } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


==================================================
FILENAME: .\frontend_next\styles\globals.css
==================================================
@import 'tailwindcss';
@import 'tw-animate-css';

@custom-variant dark (&:is(.dark *));

:root {
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

@theme inline {
  --font-sans: 'Geist', 'Geist Fallback';
  --font-mono: 'Geist Mono', 'Geist Mono Fallback';
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}


==================================================
FILENAME: .\frontend_streamlit\Home.py
==================================================
import streamlit as st
import subprocess
import sys
import os

# Konfigurasi Halaman (Wajib di baris pertama)
st.set_page_config(
    page_title="Bekal Bangsa",
    page_icon="üç±",
    layout="wide"
)

# --- AUTO-START IOT SIMULATOR ---
@st.cache_resource
def start_iot_simulator():
    """
    Menjalankan IoT Simulator secara otomatis di background.
    Menggunakan st.cache_resource agar hanya dijalankan SEKALI per sesi server.
    """
    # Cek apakah script ada
    script_path = "backend/iot_simulator.py"
    if os.path.exists(script_path):
        # Jalankan sebagai subprocess non-blocking
        # Gunakan sys.executable untuk memastikan python yang sama
        try:
            process = subprocess.Popen([sys.executable, script_path], cwd=os.getcwd())
            return process
        except Exception as e:
            st.error(f"Gagal menjalankan simulator: {e}")
            return None
    return None

# Panggil fungsi start
simulator_process = start_iot_simulator()
if simulator_process:
    st.toast("üå°Ô∏è IoT Simulator berjalan di background!", icon="‚úÖ")

# --- CSS Styling (Biar warnanya Emerald & Gold) ---
st.markdown("""
<style>
    .stApp {
        background-color: #f8f9fa;
    }
    .main-header {
        font-size: 3rem;
        color: #064e3b; /* Emerald Dark */
        text-align: center;
        font-weight: bold;
        margin-bottom: 0;
    }
    .sub-header {
        font-size: 1.5rem;
        color: #d97706; /* Amber/Gold */
        text-align: center;
        margin-bottom: 3rem;
        font-weight: 500;
    }
    .card {
        background-color: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        text-align: center;
        height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border: 1px solid #e5e7eb;
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
        border: 2px solid #064e3b;
    }
    .emoji-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
</style>
""", unsafe_allow_html=True)

# --- Hero Section ---
st.markdown('<div class="main-header">Bekal Bangsa</div>', unsafe_allow_html=True)
st.markdown('<div class="sub-header">Menjaga Gizi, dari UMKM untuk Negeri üáÆüá©</div>', unsafe_allow_html=True)

# --- Role Selection ---
col1, col2 = st.columns(2)

with col1:
    st.markdown("""
    <div class="card">
        <div class="emoji-icon">üè™</div>
        <h2 style="color:#064e3b;">Mitra Pedagang</h2>
        <p style="color:#4b5563;">Upload stok dagangan pasar, cek kualitas dengan AI, dan jual langsung ke SPPG terdekat.</p>
    </div>
    """, unsafe_allow_html=True)
    
    st.write("") # Spacer
    if st.button("Masuk sebagai Pedagang ‚û°Ô∏è", type="primary", use_container_width=True):
        st.switch_page("pages/1_upload.py")

with col2:
    st.markdown("""
    <div class="card">
        <div class="emoji-icon">üèõÔ∏è</div>
        <h2 style="color:#064e3b;">Dapur SPPG</h2>
        <p style="color:#4b5563;">Monitoring stok pangan nasional, cari supplier terdekat, dan rekomendasi menu gizi.</p>
    </div>
    """, unsafe_allow_html=True)
    
    st.write("") # Spacer
    if st.button("Masuk sebagai Admin SPPG ‚û°Ô∏è", use_container_width=True):
        st.switch_page("pages/2_dashboard_sppg.py")

# --- Footer ---
st.write("---")
st.markdown(
    """
    <div style="text-align: center; color: #6b7280; font-size: 0.8rem;">
    ¬© 2025 Bekal Bangsa Team. Built for Hackathon with FastAPI & Claude Sonnet 4.5.
    </div>
    """, 
    unsafe_allow_html=True
)

==================================================
FILENAME: .\frontend_streamlit\pages\1_upload.py
==================================================
import streamlit as st
import requests
import pandas as pd
from datetime import date

# Konfigurasi API
API_URL = "http://127.0.0.1:8000/api"

st.set_page_config(page_title="Upload Stok - Bekal Bangsa", page_icon="üì∏")

st.title("üì∏ Upload Stok Pedagang")
st.info("Foto barang dagangan Anda untuk didata otomatis oleh AI.")

# 1. Input Data Diri (Simulasi Login)
with st.expander("üë§ Identitas Pedagang", expanded=True):
    owner_name = st.text_input("Nama Pedagang", value="Pak Asep")
    location = st.text_input("Lokasi Pasar", value="Pasar Induk Cianjur")
    
    # Input GPS Manual (Simulasi)
    c_lat, c_long = st.columns(2)
    latitude = c_lat.number_input("Latitude (GPS)", value=-6.175392, format="%.6f")
    longitude = c_long.number_input("Longitude (GPS)", value=106.827153, format="%.6f")

# 2. Ambil Foto (Pilih Metode)
st.write("---")
st.subheader("üì∏ Masukkan Gambar Barang")

tab1, tab2, tab3 = st.tabs(["üì∏ Kamera Langsung", "üìÇ Upload File", "üîç Cari SPPG Terdekat"])
img_file = None

with tab1:
    camera_file = st.camera_input("Jepret Foto")
    if camera_file: img_file = camera_file
with tab2:
    uploaded_file = st.file_uploader("Pilih foto dari galeri/komputer", type=['jpg', 'jpeg', 'png'])
    if uploaded_file: img_file = uploaded_file

with tab3:
    st.subheader("üîç Cari Kitchen Hub (SPPG) Terdekat")
    st.info("Temukan lokasi drop-off bahan makanan terdekat dari lokasi Anda.")
    
    if st.button("Cari SPPG Terdekat", type="primary"):
        with st.spinner("Mencari lokasi..."):
            try:
                # Panggil API Search SPPG
                res = requests.get(f"{API_URL}/sppg/search", params={"lat": latitude, "long": longitude})
                if res.status_code == 200:
                    data = res.json()
                    results = data.get("data", [])
                    
                    if results:
                        st.success(f"Ditemukan {len(results)} SPPG terdekat!")
                        for sppg in results:
                            with st.container(border=True):
                                c1, c2 = st.columns([3, 1])
                                with c1:
                                    st.markdown(f"### üè¢ {sppg['name']}")
                                    st.write(f"üìç {sppg['address']}")
                                    st.caption(f"üìû {sppg['phone']}")
                                with c2:
                                    st.metric("Jarak", f"{sppg['distance_km']} km")
                                    st.button("Hubungi", key=f"btn_sppg_{sppg['id']}")
                    else:
                        st.warning("Tidak ada SPPG ditemukan.")
                else:
                    st.error(f"Gagal mencari: {res.text}")
            except Exception as e:
                st.error(f"Error koneksi: {e}")

# Inisialisasi variabel data
photo_url = None
items_data = []

if img_file:
    # Tampilkan spinner loading
    with st.spinner("ü§ñ AI sedang menganalisis gambar & mengupload..."):
        try:
            # --- STEP A: UPLOAD FOTO KE STORAGE ---
            img_file.seek(0)
            files_upload = {"file": ("upload.jpg", img_file, "image/jpeg")}
            resp_upload = requests.post(f"{API_URL}/upload", files=files_upload)
            if resp_upload.status_code != 200:
                st.error(f"Gagal upload foto: {resp_upload.text}")
                st.stop()
            photo_url = resp_upload.json().get("url")
            
            # --- STEP B: ANALISIS AI (VISION) ---
            img_file.seek(0)
            files_analyze = {"file": ("analyze.jpg", img_file, "image/jpeg")}
            resp_analyze = requests.post(f"{API_URL}/analyze", files=files_analyze)
            if resp_analyze.status_code != 200:
                st.error("Gagal analisis AI. Coba foto ulang.")
                st.stop()
                
            ai_result = resp_analyze.json()
            if ai_result.get("status") != "success":
                st.warning("AI tidak menemukan barang. Coba foto lebih jelas.")
                st.stop()
                
            items_data = ai_result.get("data", [])
            if not items_data:
                st.warning("Tidak ada barang terdeteksi.")
                st.stop()

            # --- üî• FIX PENTING: UPDATE MEMORI STREAMLIT üî• ---
            # Kita paksa update session_state dengan data baru dari API
            # agar widget form di bawah mau berubah nilainya.
            # --- üî• FIX PENTING: UPDATE MEMORI STREAMLIT üî• ---
            for i, item in enumerate(items_data):
                st.session_state[f"name_{i}"] = item['name']
                
                # FIX: Pastikan qty minimal 1 biar gak crash
                raw_qty = int(item['qty'])
                st.session_state[f"qty_{i}"] = raw_qty if raw_qty > 0 else 1
                
                st.session_state[f"unit_{i}"] = item['unit']
                st.session_state[f"fresh_{i}"] = item['freshness']
                
                # FIX: Pastikan expiry minimal 0 (jangan minus)
                raw_exp = int(item['expiry'])
                st.session_state[f"exp_{i}"] = raw_exp if raw_exp >= 0 else 0

            st.success("‚úÖ Analisis Selesai!")
            
        except Exception as e:
            st.error(f"Terjadi kesalahan sistem: {str(e)}")
            st.stop()

# --- STEP C: PREVIEW & EDIT (FORMULIR) ---
# Bagian ini ditaruh di luar blok 'if img_file:' agar tetap muncul setelah interaksi
if items_data and photo_url:
    st.subheader("üìù Verifikasi Data")
    st.image(photo_url, caption="Preview Upload", use_column_width=True)
    
    final_items = []
    
    # Loop setiap barang yang dideteksi
    for i, item in enumerate(items_data):
        with st.container(border=True):
            st.markdown(f"**Barang #{i+1} (Deteksi AI: {item['name']})**")
            c1, c2, c3 = st.columns(3)
            
            # --- PERUBAHAN DI SINI: Hapus parameter 'value=' ---
            # Kita hapus 'value=...' karena nilainya sekarang otomatis diambil 
            # dari st.session_state[key] yang sudah kita update di atas.
            new_name = c1.text_input(f"Nama", key=f"name_{i}")
            new_qty = c2.number_input(f"Jumlah", min_value=1, key=f"qty_{i}")
            new_unit = c3.text_input(f"Satuan", key=f"unit_{i}")
            
            c4, c5 = st.columns(2)
            # Pastikan opsi freshness sama persis dengan output AI/backend
            freshness_options = ["Sangat Segar", "Segar", "Cukup", "Layum", "Busuk"]
            # Fallback jika output AI tidak ada di opsi
            try:
                idx = freshness_options.index(st.session_state[f"fresh_{i}"])
            except ValueError:
                idx = 0

            new_freshness = c4.selectbox(f"Kualitas", freshness_options, index=idx, key=f"fresh_{i}")
            new_expiry = c5.number_input(f"Sisa Umur (Hari)", key=f"exp_{i}")
            
            st.caption(f"ü§ñ Catatan AI: {item.get('note', '-')}")
            
            # Masukkan ke list final
            final_items.append({
                "name": new_name,
                "qty": new_qty,
                "unit": new_unit,
                "freshness": new_freshness,
                "expiry_days": new_expiry,
                "note": item.get('note'),
                "photo_url": photo_url,
                "owner_name": owner_name,
                "location": location,
                "latitude": latitude,
                "longitude": longitude
            })

    # --- STEP D: SIMPAN KE DATABASE ---
    if st.button("üöÄ SIMPAN SEMUA KE GUDANG", type="primary", use_container_width=True):
        with st.spinner("Menyimpan ke database..."):
            try:
                resp_save = requests.post(f"{API_URL}/supplies", json=final_items)
                if resp_save.status_code == 200:
                    st.balloons()
                    st.success(f"Berhasil menyimpan {len(final_items)} jenis barang!")
                    # Opsional: Clear data setelah simpan biar form bersih lagi
                    # st.experimental_rerun() 
                else:
                    st.error(f"Gagal menyimpan: {resp_save.text}")
            except Exception as e:
                st.error(f"Gagal connect ke backend: {e}")

==================================================
FILENAME: .\frontend_streamlit\pages\2_dashboard_sppg.py
==================================================
import streamlit as st
import requests
import pandas as pd
import plotly.express as px

API_URL = "http://127.0.0.1:8000/api"

st.set_page_config(page_title="Dashboard SPPG - Bekal Bangsa", page_icon="üìä", layout="wide")

st.title("üìä Command Center SPPG")
st.markdown("Pantau ketersediaan pangan lokal & Rencanakan menu bergizi.")

# --- TABS FITUR ---
tab1, tab2, tab3, tab4, tab5 = st.tabs(["üìä Stok Nasional", "üîç Cari Supplier (Matching)", "üçΩÔ∏è Rekomendasi Menu (AI Chef)", "üå°Ô∏è Smart Storage (IoT)", "üîî Notification Center"])

# ==========================================
# TAB 1: MONITORING STOK (GET /api/supplies)
# ==========================================
with tab1:
    st.subheader("Real-time Inventory")
    
    # Tombol Refresh
    if st.button("üîÑ Refresh Data", key="btn_refresh_stok"):
        st.rerun()

    try:
        # 1. Ambil Data dari API
        resp = requests.get(f"{API_URL}/supplies")
        data = resp.json()
        
        if data:
            df = pd.DataFrame(data)
            
            # 2. Tampilkan Metrics Atas
            c1, c2, c3 = st.columns(3)
            c1.metric("Total Item Terdata", f"{len(df)} Item")
            c2.metric("Total Kuantitas", f"{df['quantity'].sum()} Unit")
            # Hitung yg mau expired (< 3 hari)
            warning_count = len(df[df['expiry_days'] <= 3])
            c3.metric("Perlu Segera Digunakan", f"{warning_count} Item", delta=-warning_count, delta_color="inverse")
            
            # 3. Grafik Sebaran (Biar Keren di Mata Juri)
            col_chart1, col_chart2 = st.columns(2)
            
            with col_chart1:
                st.caption("Komposisi Stok Barang")
                fig_pie = px.pie(df, names='item_name', values='quantity', hole=0.4)
                st.plotly_chart(fig_pie, use_container_width=True)
                
            with col_chart2:
                st.caption("Kualitas Barang")
                fig_bar = px.bar(df, x='item_name', y='quantity', color='quality_status')
                st.plotly_chart(fig_bar, use_container_width=True)

            # 4. Tabel Detail
            st.dataframe(
                df[['item_name', 'quantity', 'unit', 'quality_status', 'expiry_days', 'location', 'owner_name']],
                use_container_width=True,
                hide_index=True
            )
        else:
            st.info("Belum ada data stok masuk. Silakan upload di menu Pedagang.")
            
    except Exception as e:
        st.error(f"Gagal mengambil data: {e}")

# ==========================================
# TAB 2: PENCARIAN / MATCHING (GET Search)
# ==========================================
with tab2:
    st.header("üîç Cari Supplier Terdekat")
    
    # Input Lokasi User (Simulasi SPPG Jakarta Pusat)
    c_lat, c_long = st.columns(2)
    user_lat = c_lat.number_input("Latitude Saya", value=-6.175392, format="%.6f")
    user_long = c_long.number_input("Longitude Saya", value=106.827153, format="%.6f")
    
    keyword = st.text_input("Cari bahan (misal: Bawang, Telur)", "")
    
    if st.button("Cari Supplier", key="btn_cari_supplier"):
        if keyword:
            with st.spinner(f"Mencari '{keyword}' terdekat..."):
                try:
                    # Panggil API Search dengan Lat/Long
                    res = requests.get(f"{API_URL}/suppliers/search", params={
                        "q": keyword,
                        "lat": user_lat,
                        "long": user_long
                    })
                    
                    if res.status_code == 200:
                        results = res.json()
                        if results.get("data"): # Handle format return baru
                            items = results["data"]
                            st.success(f"Ditemukan {len(items)} supplier!")
                            
                            for item in items:
                                with st.container(border=True):
                                    c1, c2 = st.columns([3, 1])
                                    with c1:
                                        st.subheader(item['item_name']) # Fix key name
                                        st.write(f"üìç **Jarak: {item.get('distance_km', '?')} km**")
                                        st.write(f"üë§ {item['owner_name']} | üè† {item['location']}")
                                        st.write(f"üì¶ Stok: {item['quantity']} {item['unit']} | ‚è≥ Exp: {item['expiry_days']} hari")
                                        if item.get('latitude'):
                                            st.caption(f"GPS: {item['latitude']}, {item['longitude']}")
                                        else:
                                            st.caption("GPS: Simulasi (Data Vendor belum lengkap)")
                                            
                                    with c2:
                                        if st.button("Pesan", key=f"btn_pesan_{item['id']}"):
                                            # Simulasi masuk keranjang (Session State)
                                            if 'cart' not in st.session_state:
                                                st.session_state['cart'] = []
                                            st.session_state['cart'].append(item)
                                            st.toast("Masuk keranjang!")
                        else:
                            st.warning("Tidak ada supplier ditemukan.")
                    else:
                        st.error(f"Error API: {res.text}")
                except Exception as e:
                    st.error(f"Gagal koneksi: {e}")

# ==========================================
# TAB 3: REKOMENDASI MENU (AI Chef)
# ==========================================
with tab3:
    st.header("üçΩÔ∏è AI Menu Planner (Program Makan Bergizi Gratis)")
    st.info("Dapatkan rekomendasi menu masakan berdasarkan stok bahan yang tersedia.")
    
    # Ambil list item unik dari stok
    try:
        resp = requests.get(f"{API_URL}/supplies")
        if resp.status_code == 200:
            stock_data = resp.json()
            if stock_data:
                df_stock = pd.DataFrame(stock_data)
                unique_items = df_stock['item_name'].unique().tolist()
                
                selected_ingredients = st.multiselect("Pilih Bahan Baku Tersedia:", unique_items)
                
                if st.button("üë®‚Äçüç≥ Buat Rekomendasi Menu", type="primary"):
                    if not selected_ingredients:
                        st.warning("Pilih minimal 1 bahan baku.")
                    else:
                        with st.spinner("Koki AI sedang meracik resep..."):
                            try:
                                payload = {"ingredients": selected_ingredients}
                                res_menu = requests.post(f"{API_URL}/recommend-menu", json=payload)
                                
                                if res_menu.status_code == 200:
                                    menu = res_menu.json()
                                    
                                    st.success("‚úÖ Menu Siap Disajikan!")
                                    
                                    with st.container(border=True):
                                        st.subheader(f"üç≤ {menu.get('menu_name')}")
                                        st.write(f"**Deskripsi:** {menu.get('description')}")
                                        st.write(f"**Alasan:** {menu.get('reason')}")
                                        
                                        st.divider()
                                        
                                        col_ing, col_steps = st.columns(2)
                                        with col_ing:
                                            st.markdown("#### üõí Bahan Diperlukan")
                                            for ing in menu.get('ingredients_needed', []):
                                                st.markdown(f"- {ing}")
                                                
                                        with col_steps:
                                            st.markdown("#### üë®‚Äçüç≥ Langkah Memasak")
                                            for i, step in enumerate(menu.get('cooking_steps', []), 1):
                                                st.markdown(f"**{i}.** {step}")
                                        
                                        st.divider()
                                        st.markdown("#### üìä Informasi Gizi")
                                        nut = menu.get('nutrition', {})
                                        c1, c2, c3, c4, c5 = st.columns(5)
                                        c1.metric("Kalori", nut.get('calories', 'N/A'))
                                        c2.metric("Protein", nut.get('protein', 'N/A'))
                                        c3.metric("Karbo", nut.get('carbs', 'N/A'))
                                        c4.metric("Lemak", nut.get('fats', 'N/A'))
                                        c5.metric("Vitamin", nut.get('vitamins', 'N/A'))
                                            
                                    st.json(menu) # Debug view
                                else:
                                    st.error(f"Gagal: {res_menu.text}")
                            except Exception as e:
                                st.error(f"Error: {e}")
            else:
                st.warning("Data stok kosong.")
    except Exception as e:
        st.error(f"Gagal load stok: {e}")

# ==========================================
# TAB 4: SMART STORAGE (IoT Monitoring)
# ==========================================
with tab4:
    st.header("üå°Ô∏è Smart Storage Monitoring")
    st.info("Data sensor real-time dari gudang penyimpanan (IoT).")
    
    # Tombol Refresh Manual (Ganti Autorefresh)
    if st.button("üîÑ Refresh Sensor", key="btn_refresh_iot"):
        st.rerun()
    
    try:
        res = requests.get(f"{API_URL}/iot/logs")
        if res.status_code == 200:
            logs = res.json()
            if logs:
                df_iot = pd.DataFrame(logs)
                df_iot['created_at'] = pd.to_datetime(df_iot['created_at']) # Fix column name timestamp -> created_at
                
                # Metric Cards
                latest = df_iot.iloc[0]
                m1, m2, m3 = st.columns(3)
                m1.metric("Suhu Saat Ini", f"{latest['temperature']} ¬∞C", delta="Normal")
                m2.metric("Kelembaban", f"{latest['humidity']} %", delta="Stabil")
                m3.metric("Status Device", "ONLINE üü¢")
                
                # Charts
                st.subheader("Grafik Suhu & Kelembaban")
                st.line_chart(df_iot.set_index('created_at')[['temperature', 'humidity']])
            else:
                st.warning("Belum ada data sensor. Jalankan 'iot_simulator.py' di backend.")
        else:
            st.error("Gagal ambil data IoT.")
    except Exception as e:
        st.error(f"Koneksi IoT Error: {e}")

# ==========================================
# TAB 5: NOTIFICATION CENTER
# ==========================================
with tab5:
    st.header("üîî Notification Center (WhatsApp Simulation)")
    st.info("Simulasi pesan WhatsApp yang dikirim ke Vendor & SPPG saat ada stok kritis.")
    
    if st.button("üîÑ Jalankan Pengecekan Harian (Daily Check)", type="primary", key="btn_daily_check"):
        with st.spinner("ü§ñ AI sedang mengecek expiry date & menghitung jarak..."):
            try:
                res = requests.post(f"{API_URL}/notifications/trigger")
                if res.status_code == 200:
                    data = res.json()
                    msgs = data.get("data", [])
                    
                    if not msgs:
                        st.success("‚úÖ Semua stok aman! Tidak ada notifikasi yang perlu dikirim.")
                    else:
                        st.warning(f"‚ö†Ô∏è Ditemukan {len(msgs)} isu stok!")
                        for i, msg in enumerate(msgs):
                            with st.chat_message(msg.get('role', 'System'), avatar="üì±"):
                                st.write(f"**To: {msg.get('to', 'User')}**")
                                st.markdown(f"_{msg.get('message', '')}_")
                                if "RECIPE" in msg.get('type', ''):
                                    st.caption("üí° AI Recommendation included")
                else:
                    st.error(f"Gagal trigger notifikasi: {res.text}")
            except Exception as e:
                st.error(f"Error: {e}")

==================================================
FILENAME: .\frontend_streamlit\pages\3_pesanan_masuk.py
==================================================
import streamlit as st
import requests

API_URL = "http://127.0.0.1:8000/api"

st.set_page_config(page_title="Pesanan Masuk", page_icon="üì¶")
st.title("üì¶ Pesanan Masuk")
st.caption("Kelola pesanan dari pemerintah di sini.")

if st.button("üîÑ Refresh"):
    st.rerun()

try:
    # Ambil data order
    resp = requests.get(f"{API_URL}/orders/umkm")
    
    # 1. Cek Status Code Dulu!
    if resp.status_code != 200:
        st.error(f"Gagal mengambil data pesanan. Server Error: {resp.text}")
        st.stop()
        
    orders = resp.json()

    # 2. Cek apakah formatnya benar-benar List []
    if not isinstance(orders, list):
        st.error(f"Format data salah dari server. Diterima: {type(orders)}")
        st.write(orders) # Tampilkan biar tau isinya apa
        st.stop()

    if not orders:
        st.info("Belum ada pesanan masuk.")
    else:
        for order in orders:
            # Validasi isi order biar gak crash
            if not isinstance(order, dict):
                continue
                
            # Data Barang ada di dalam key 'supplies' (karena join)
            barang = order.get('supplies', {})
            
            # Handle kalau barangnya udah dihapus tapi ordernya masih ada
            if not barang: 
                item_name = "Barang Terhapus"
                unit = "Unknown"
            else:
                item_name = barang.get('item_name', 'Tanpa Nama')
                unit = barang.get('unit', 'Pcs')

            with st.container(border=True):
                c1, c2, c3 = st.columns([2, 1, 1])
                
                # Kolom 1: Info Barang
                with c1:
                    st.markdown(f"### {item_name}")
                    st.text(f"Pemesan: {order.get('buyer_name', '-')}")
                    tgl = order.get('created_at', '')[:10]
                    st.caption(f"Tanggal: {tgl}")

                # Kolom 2: Info Status
                with c2:
                    st.metric("Jumlah", f"{order.get('qty_ordered', 0)} {unit}")
                    
                    status = order.get('status', 'pending')
                    if status == "pending":
                        st.warning("‚è≥ Menunggu Konfirmasi")
                    elif status == "confirmed":
                        st.success("‚úÖ Siap Kirim")
                    elif status == "completed":
                        st.info("üèÅ Selesai")

                # Kolom 3: Aksi (Tombol)
                with c3:
                    st.write("") # Spacer
                    if status == "pending":
                        if st.button("‚úÖ Terima", key=f"acc_{order['id']}"):
                            requests.put(f"{API_URL}/orders/{order['id']}", json={"status": "confirmed"})
                            st.rerun()
                    
                    elif status == "confirmed":
                        if st.button("üöö Kirim", key=f"ship_{order['id']}"):
                            requests.put(f"{API_URL}/orders/{order['id']}", json={"status": "completed"})
                            st.rerun()

except Exception as e:
    st.error(f"Terjadi kesalahan aplikasi: {e}")

==================================================
FILENAME: .\frontend_streamlit\pages\4_dapur_produksi.py
==================================================
import streamlit as st
import requests
from datetime import datetime, timedelta
import pandas as pd

API_URL = "http://127.0.0.1:8000/api"

st.set_page_config(page_title="Dapur Produksi", page_icon="üç≥", layout="wide")
st.title("üç≥ Dapur & Quality Control")

tab1, tab2, tab3 = st.tabs(["üî• Mulai Masak", "üç± Scan Makanan Jadi (QC)", "‚è±Ô∏è Monitor Expired"])

# --- TAB 1: MASAK (PENGURANGAN STOK) ---
with tab1:
    st.subheader("Catat Produksi Masakan")
    
    # Ambil stok gudang
    try:
        stok = requests.get(f"{API_URL}/supplies").json()
        if stok:
            df = pd.DataFrame(stok)
            # Multiselect bahan yg mau dipake
            bahan_terpilih = st.multiselect(
                "Pilih Bahan yang Dimasak (Akan dihapus dari gudang):", 
                options=df['id'].tolist(),
                format_func=lambda x: df[df['id'] == x]['item_name'].values[0]
            )
            
            menu_name = st.text_input("Nama Menu Masakan", "Nasi Kotak Ayam")
            qty = st.number_input("Jumlah Porsi", 100)
            
            if st.button("üî• Masak Sekarang"):
                payload = {
                    "menu_name": menu_name,
                    "qty_produced": qty,
                    "ingredients_ids": bahan_terpilih
                }
                with st.spinner("Koki AI sedang memasak & menghitung gizi..."):
                    try:
                        res = requests.post(f"{API_URL}/kitchen/cook", json=payload)
                        if res.status_code == 200:
                            data = res.json()
                            st.success(f"‚úÖ {data.get('message', 'Produksi tercatat!')}")
                            
                            # Display Nutrition
                            nut = data.get('nutrition_estimate', {})
                            if nut:
                                st.markdown("#### üìä Estimasi Nutrisi per Porsi")
                                c1, c2, c3, c4 = st.columns(4)
                                c1.metric("Kalori", nut.get('calories', '-'))
                                c2.metric("Protein", nut.get('protein', '-'))
                                c3.metric("Karbo", nut.get('carbs', '-'))
                                c4.metric("Lemak", nut.get('fats', '-'))
                                
                            with st.expander("‚ÑπÔ∏è Info Keamanan Pangan"):
                                safety = data.get('safety_analysis', {})
                                st.write(f"**Tips:** {safety.get('storage_tips', '-')}")
                                st.write(f"**Tahan Suhu Ruang:** {safety.get('room_temp_hours')} jam")
                                
                        else:
                            st.error(f"Gagal mencatat produksi: {res.text}")
                    except Exception as e:
                        st.error(f"Error: {e}")
        else:
            st.info("Gudang kosong.")
    except:
        st.error("Gagal konek server.")

# --- TAB 2: MEAL SCANNER (VISION) ---
with tab2:
    st.subheader("üõ°Ô∏è Quality Control Makanan Jadi")
    st.info("Scan sampel makanan sebelum dibagikan ke anak-anak.")
    
    img = st.camera_input("Foto Makanan Matang")
    if img:
        with st.spinner("AI mencicipi secara visual..."):
            files = {"file": img}
            res = requests.post(f"{API_URL}/kitchen/scan-meal", files=files)
            data = res.json()
            
            c1, c2 = st.columns(2)
            with c1:
                st.image(img, width=300)
            with c2:
                if data.get('is_safe'):
                    st.success(f"‚úÖ AMAN DIMAKAN: {data.get('visual_quality')}")
                else:
                    st.error(f"‚õî BAHAYA / BASI: {data.get('visual_quality')}")
                
                st.write("**Estimasi Gizi:**")
                st.json(data.get('nutrition_estimate'))
                
                if data.get('spoilage_signs'):
                    st.warning(f"Tanda kerusakan: {data.get('spoilage_signs')}")

# --- TAB 3: MONITOR EXPIRED (REAL TIME) ---
with tab3:
    st.subheader("‚è±Ô∏è Jadwal Basi (Expiry Countdown)")
    
    # (Disini nanti request GET ke tabel meal_productions)
    # Mockup Data biar cepet:
    now = datetime.now()
    meals = [
        {"menu": "Nasi Ayam (Batch 1)", "exp": now + timedelta(hours=2)},
        {"menu": "Tumis Sayur (Batch 1)", "exp": now + timedelta(minutes=30)},
    ]
    
    for m in meals:
        sisa = m['exp'] - now
        # Logic warna: Merah kalau < 1 jam
        color = "red" if sisa.total_seconds() < 3600 else "green"
        st.markdown(f"""
        <div style="padding:10px; border:1px solid #ddd; border-radius:5px; margin-bottom:10px; border-left: 5px solid {color}">
            <h3>{m['menu']}</h3>
            <p>Harus habis sebelum: <b>{m['exp'].strftime('%H:%M')}</b></p>
            <p style="color:{color}; font-weight:bold">Sisa Waktu: {str(sisa).split('.')[0]}</p>
        </div>
        """, unsafe_allow_html=True)

==================================================
FILENAME: .\scripts\API_IoT.py
==================================================
import serial
import requests
import json
import time

# --- KONFIGURASI ---
# Ganti dengan Port Arduino kamu (Cek di Arduino IDE > Tools > Port)
# Di Windows biasanya COM3, COM4, dst. Di Mac/Linux /dev/tty...
SERIAL_PORT = 'COM3' 
BAUD_RATE = 9600
API_URL = 'https://contoh-api-kamu.com/endpoint' # Ganti dengan link API tujuan

# --- SETUP SERIAL ---
try:
    ser = serial.Serial(SERIAL_PORT, BAUD_RATE, timeout=1)
    print(f"Terhubung ke {SERIAL_PORT}")
except:
    print(f"Gagal membuka {SERIAL_PORT}. Cek apakah port benar atau sedang dipakai aplikasi lain.")
    exit()

# --- LOOP UTAMA ---
while True:
    try:
        # 1. Baca data dari Arduino (baris per baris)
        if ser.in_waiting > 0:
            line = ser.readline().decode('utf-8').strip()
            
            if line:
                print(f"Data dari Arduino: {line}")
                
                # 2. Kirim ke API
                try:
                    # Kita anggap Arduino mengirim JSON valid
                    payload = json.loads(line) 
                    
                    # Kirim POST Request
                    response = requests.post(API_URL, json=payload)
                    
                    print(f"Status API: {response.status_code}")
                    print("-" * 20)
                    
                except json.JSONDecodeError:
                    print("Format data dari Arduino bukan JSON valid.")
                except requests.exceptions.RequestException as e:
                    print(f"Gagal kirim ke API: {e}")

    except KeyboardInterrupt:
        print("Program dihentikan.")
        ser.close()
        break
